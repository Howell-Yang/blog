<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Using WireGuard on macOS - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Using WireGuard on macOS - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Using WireGuard on macOS - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2021/04/01/using-wireguard-on-macos/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Using WireGuard on macOS</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 19 May 1011 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;675 words (estimated 4 minutes to read)</span>
  <p>A short while ago I published a post on <a href="/2021/02/22/setting-up-wireguard-for-aws-vpc-access/">setting up WireGuard for AWS VPC access</a>. In that post, I focused on the use of Linux on both the server side (on an EC2 instance in your AWS VPC) as well as on the client side (using the GNOME Network Manager interface). However, <a href="https://www.wireguard.com/">WireGuard</a> is not limited to Linux, and I recently configured one of my macOS systems to take advantage of this WireGuard infrastructure for access to the private subnets in my AWS VPC. In this post, I&rsquo;ll walk readers through configuring macOS to use WireGuard.</p>
<p>The first step is installing WireGuard on macOS. This is remarkably easy; just go to the App Store and install the WireGuard app for macOS. (Hopefully <a href="https://apps.apple.com/us/app/wireguard/id1451685025?mt=12">this link</a> will take you directly there if you&rsquo;re on a macOS-based system.)</p>
<p>Once the app is installed, the next step is to configure the WireGuard tunnels. I found this to be a bit confusing at first, but only because I wasn&rsquo;t clear on the relationship between the WireGuard app and the Network pane in System Preferences. In this case, you need to use the WireGuard app to create the tunnels, which will show up as connections (interfaces) in the Network pane of System Preferences.</p>
<p>Running the WireGuard app will put an icon on your menu bar, and should bring up the &ldquo;Manage WireGuard Tunnels&rdquo; window. If not, select &ldquo;Manage Tunnels&rdquo; from the WireGuard menu icon; this will open the &ldquo;Manage WireGuard Tunnels&rdquo; window. From there, you can select the small plus in the lower left corner and select &ldquo;Add Empty Tunnel&hellip;&rdquo; from the menu. This displays a dialog box something like this:</p>
<p><img src="/public/img/add-empty-tunnel.png" alt="Add Empty Tunnel dialog box"></p>
<p>This will automatically create a new set of public and private keys, and auto-populate the start of a new WireGuard interface configuration. (Don&rsquo;t worry; these keys aren&rsquo;t valid for any interfaces/connections.) It&rsquo;s up to you to finish the configuration by adding directives such as <code>Endpoint</code>, <code>AllowedIPs</code>, and <code>Address</code>. It&rsquo;s an interesting sort of mismatch to have such a well-designed graphical application, but <em>not</em> provide any guidance or structure to the user on how to configure the interface/tunnel.</p>
<p>Ultimately, you&rsquo;d need the configuration to look something like this:</p>
<pre tabindex="0"><code>[Interface]
PrivateKey = &lt;some private key here&gt;
Address = &lt;IP address of WireGuard interface&gt;

[Peer]
PublicKey = &lt;public key of WireGuard peer interface&gt;
AllowedIPs = &lt;IP addresses or CIDR ranges to be routed across the tunnel&gt;
Endpoint = &lt;peer endpoint IP and port&gt;
</code></pre><p>If you&rsquo;re behind a NAT, you may also want to add the <code>PersistentKeepalive = 25</code> value to the configuration as well (see the &ldquo;NAT and Firewall Traversal Persistence&rdquo; section of <a href="https://www.wireguard.com/quickstart/">this page</a>). Next you&rsquo;ll need to configure the peer with the appropriate configuration. If the peer is Linux-based, you can use the information in <a href="/2021/02/22/setting-up-wireguard-for-aws-vpc-access/">my earlier blog post</a>; if the peer is macOS, then use the instructions in this post. For anything else, refer to <a href="https://www.wireguard.com/">the WireGuard web site</a>.</p>
<p>Once both sides of the connection are configured, then you should be able to activate the tunnel and start passing traffic. If traffic won&rsquo;t pass successfully, then check the interface configuration on both sides, and make sure any firewalls along the path allow the traffic. The WireGuard connection will look like this in the Network pane of the System Preferences app (IP addresses have been blacked out):</p>
<p><img src="/public/img/wireguard-interface-network-pane.png" alt="Network pane"></p>
<p>Repeat this process to add more tunnels/connections; each of them will show up as a menu item in the WireGuard menu icon, and you can select them to activate/deactivate the connection. Also note that selecting the &ldquo;On-Demand&rdquo; option when creating the tunnel will let WireGuard automatically establish the tunnel when you start passing traffic (assuming both ends are configured).</p>
<p>I hope this information helps. I found the interface to be a bit unintuitive, but after working with it for a little while it doesn&rsquo;t feel so awkward now. Hopefully this walkthrough will make getting WireGuard set up and configured on macOS a bit easier for others. Thanks for reading, and hit <a href="https://twitter.com/scott_lowe">me on Twitter</a> if you have any questions, comments, or other feedback!</p>

  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/encryption">Encryption</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/macos">macOS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vpn">VPN</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2021/03/19/adding-a-machinehealthcheck-with-kustomize/">Adding a MachineHealthCheck using Kustomize</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2021/04/02/technology-short-take-139/">Technology Short Take 139</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2021%2f04%2f01%2fusing-wireguard-on-macos%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2021%2f04%2f01%2fusing-wireguard-on-macos%2f&text=Using%20WireGuard%20on%20macOS" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2021%2f04%2f01%2fusing-wireguard-on-macos%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2021/01/15/technology-short-take-136/">Technology Short Take 136</a> <span class="post-date-list">159 May 151515</span></li><li><a href="/2021/02/22/setting-up-wireguard-for-aws-vpc-access/">Setting up WireGuard for AWS VPC Access</a> <span class="post-date-list">229 May 222222</span></li><li><a href="/2020/06/19/technology-short-take-128/">Technology Short Take 128</a> <span class="post-date-list">199 May 191919</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
