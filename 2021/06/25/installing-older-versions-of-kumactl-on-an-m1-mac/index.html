<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Installing Older Versions of Kumactl on an M1 Mac - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Installing Older Versions of Kumactl on an M1 Mac - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Installing Older Versions of Kumactl on an M1 Mac - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2021/06/25/installing-older-versions-of-kumactl-on-an-m1-mac/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Installing Older Versions of Kumactl on an M1 Mac</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 259 May 252525 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;925 words (estimated 5 minutes to read)</span>
  <p>The Kuma community <a href="https://kuma.io/blog/2021/kuma-1-2-0/">recently released version 1.2.0</a> of the open source Kuma service mesh, and along with it a corresponding version of <code>kumactl</code>, the command-line utility for interacting with Kuma. To make it easy for macOS users to get <code>kumactl</code>, the Kuma community maintains a <a href="https://brew.sh">Homebrew</a> formula for the CLI utility. That includes providing M1-native (ARM64) macOS binaries for <code>kumactl</code>. Unfortunately, installing an earlier version of <code>kumactl</code> on an M1-based Mac using Homebrew is somewhat less than ideal. Here&rsquo;s one way&mdash;probably not the only way&mdash;to work around some of the challenges.</p>
<p>Note that this post really only applies to users of M1-based Macs; users of Intel-based Macs can extract the <code>kumactl</code> binary from the release archive available linked from <a href="https://kuma.io/docs/1.2.0/installation/macos/">the Kuma install docs</a>. (The same goes for users of Linux distributions running on Intel-based hardware.) On the Kuma website, simply select the desired version of Kuma from the drop-down in the upper left, check the page for the direct download link, and off you go. This doesn&rsquo;t work for M1-based Macs because at the time this post was written, the Kuma community was not providing ARM64 binaries. This leaves Homebrew as the only way (aside from building it yourself from source) to get a native ARM64 binary of <code>kumactl</code> for an M1-based Mac.</p>
<p>There are a couple of things to point out&mdash;caveats, if you will&mdash;about this workaround before I get into the details.</p>
<ol>
<li>It seems (based what I&rsquo;ve observed regarding Homebrew&rsquo;s behavior) that the ability to have multiple versions installed via Homebrew relies on what I&rsquo;m calling &ldquo;versioned formulas,&rdquo; like <code>terraform@0.13</code> (where the version number is embedded in the name of the formula).</li>
<li>Although you can have multiple versions of a formula present on the disk in the correct locations, that doesn&rsquo;t necessarily mean that Homebrew will recognize them as &ldquo;installed.&rdquo;</li>
<li>Without Homebrew recognizing the packages as &ldquo;installed,&rdquo; then using commands like <code>brew unlink</code> or <code>brew link</code> will be severely limited. This is particularly impactful in this situation.</li>
</ol>
<p>With these limitations in mind, let&rsquo;s look at the workaround I&rsquo;ve found. It&rsquo;s based on information from a variety of sources; <a href="https://flaviocopes.com/homebrew-install-older-version/">this one</a> and <a href="https://itnext.io/how-to-install-an-older-brew-package-add141e58d32">this one</a> are good examples. It was <a href="https://gist.github.com/sawant/6ea10e45de7d09e966a1dc6afea3bffb">this GitHub gist</a>, however, that finally got me to success. The approaches that describe using a remote URL failed with a Homebrew error for me (this is using Homebrew 3.2.0).</p>
<p>Here&rsquo;s the steps that worked for me, based very largely on the referenced GitHub gist:</p>
<ol>
<li>Navigate to the directory where the Homebrew formulas are stored. On my M1-based system, that location was <code>/opt/homebrew/Library/Taps/homebrew/homebrew-core/Formula</code>. You can use <code>brew --prefix</code> to determine the base location where Homebrew is installed; the rest of the path should be the same.</li>
<li>As it turns out, the directory where Homebrew is installed is a giant Git repository. Thus, we can &ldquo;roll back&rdquo; to the state of the repository when the previous version of the formula you want is available. To figure that out for <code>kumactl</code>, use <code>git log --follow kumactl.rb</code>. Examine the output to determine the correct Git commit that will get you the desired version. I needed version 1.1.6 of <code>kumactl</code>, so the Git commit I needed was <code>89b6866</code>.</li>
<li>Run <code>git checkout -b kumactl-1.1.6 89b6866</code> to create a new branch at that commit hash.</li>
<li>Reinstall the older version with <code>brew reinstall ./kumactl.rb</code>.</li>
<li>If you have a newer version installed, this command <em>will remove the newer version.</em></li>
</ol>
<p>If you only needed to roll back to a previous <code>kumactl</code> version, then you&rsquo;re good to go. If you need multiple versions, read on. The following steps will help you get multiple copies installed (with some limitations):</p>
<ol>
<li>Copy the <code>/opt/homebrew/Cellar/kumactl/&lt;version&gt;</code> directory to a backup location on disk somewhere. You can replace <code>/opt/homebrew</code> with <code>$(brew --prefix)</code> if you&rsquo;re not sure where Homebrew is installed.</li>
<li>Assuming you&rsquo;re still inside the <code>/opt/homebrew/Library/Taps/homebrew/homebrew-core/Formula</code> directory, run <code>git checkout master</code> to switch out of the branch you created earlier in order to install the older version.</li>
<li>Run <code>brew install kumactl</code> to install the latest version. <em>This will remove the earlier version.</em></li>
<li>Copy the <code>&lt;version&gt;</code> directory from step 1 from the backup location to <code>/opt/homebrew/Cellar/kumactl</code>. In my example, this meant I had both a <code>1.1.6</code> and a <code>1.2.0</code> directory in <code>/opt/homebrew/Cellar/kumactl</code>.</li>
</ol>
<p>You now have multiple versions installed. <strong>However</strong>, due to the caveats/limitations listed earlier, Homebrew doesn&rsquo;t recognize both versions as &ldquo;installed.&rdquo; This is in spite of the fact that <code>brew info kumactl</code> shows that it recognizes both versions are present on the disk. Since both versions aren&rsquo;t recognized as &ldquo;installed,&rdquo; this means you <em>cannot</em> use <code>brew unlink</code> or <code>brew link</code> to switch between versions. (Some of the articles I found also referenced a <code>brew switch</code> command, which apparently does the same function but appears to have been removed from the latest versions of Homebrew.)</p>
<p>So what to do? Probably the easiest thing to do is this:</p>
<pre><code>ln -s $HOME/bin/kumactl-1.1.6 /opt/homebrew/Cellar/kumactl/1.1.6/bin/kumactl
</code></pre>
<p>Replace <code>$HOME/bin</code> with the path of your choice, preferably something already in <code>$PATH</code>. This allows you to run the older version by specifying the binary (via symbolic link) with the version in the name, and running the latest version by just using the binary&rsquo;s name. It&rsquo;s not a great solution, but it works.</p>
<p>I hope this (somewhat limited) workaround is useful. There are discussions happening in the Kuma community about what, if anything, the community can do to help solve this problem. Join <a href="https://chat.kuma.io">the Kuma community Slack</a> and have your opinions heard&mdash;or, even better, offer to help! In the meantime, feel free to hit <a href="https://twitter.com/scott_lowe">me on Twitter</a> if you have any questions, or if you have a better solution to this problem.</p>

  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/macos">macOS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/kong">Kong</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/kuma">Kuma</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2021/06/22/making-wireguard-from-homebrew-work-on-an-m1-mac/">Making WireGuard from Homebrew Work on an M1 Mac</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2021/06/28/using-wireguard-on-mac-via-cli/">Using WireGuard on macOS via the CLI</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2021%2f06%2f25%2finstalling-older-versions-of-kumactl-on-an-m1-mac%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2021%2f06%2f25%2finstalling-older-versions-of-kumactl-on-an-m1-mac%2f&text=Installing%20Older%20Versions%20of%20Kumactl%20on%20an%20M1%20Mac" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2021%2f06%2f25%2finstalling-older-versions-of-kumactl-on-an-m1-mac%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2021/06/22/making-wireguard-from-homebrew-work-on-an-m1-mac/">Making WireGuard from Homebrew Work on an M1 Mac</a> <span class="post-date-list">229 May 222222</span></li><li><a href="/2020/07/17/technology-short-take-129/">Technology Short Take 129</a> <span class="post-date-list">179 May 171717</span></li><li><a href="/2020/07/08/working-around-docker-desktops-outdated-kubernetes-version/">Working Around Docker Desktop&#39;s Outdated Kubernetes Version</a> <span class="post-date-list">89 May 8088</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
