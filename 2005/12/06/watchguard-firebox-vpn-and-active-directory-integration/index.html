<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>WatchGuard Firebox VPN and Active Directory Integration - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="WatchGuard Firebox VPN and Active Directory Integration - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="WatchGuard Firebox VPN and Active Directory Integration - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2005/12/06/watchguard-firebox-vpn-and-active-directory-integration/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">WatchGuard Firebox VPN and Active Directory Integration</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 69 May 6066 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;738 words (estimated 4 minutes to read)</span>
  <p>A short while back, I posted an article on <a href="/2005/11/22/cisco-pix-vpn-and-active-directory-integration/">Cisco PIX VPN and Active Directory integration</a>. Now, I&rsquo;d like to follow that article up with a version looking at integration between Active Directory and <a href="http://www.watchguard.com/">WatchGuard</a> Firebox VPNs.</p>
<p>As with the PIX-AD integration document, this article assumes that you have some basic knowledge of how to work with the WatchGuard Firebox series of firewalls. This article was written using version 6.2 of the WatchGuard Firebox System software and Windows Server 2003; other versions of either the firewall software or Windows should be similar.</p>
<h3 id="configuring-the-firebox">Configuring the Firebox</h3>
<p>First, we&rsquo;ll need to setup the Firebox. Use the Firebox software (Policy Manager, specifically) to perform the following configuration tasks:</p>
<ul>
<li>
<p>Add the server that is running IAS (or will be running IAS; see below) as a RADIUS server in the Authentication Servers dialog box (found on the Setup menu). Here, you&rsquo;ll need to specify the server&rsquo;s IP address, port number (the default of 1645 will be fine), and the shared secret.</p>
</li>
<li>
<p>Instruct the firewall to use RADIUS by going to Setup &gt; Firewall Authentication and selecting &ldquo;RADIUS&rdquo; as the authentication type.</p>
</li>
<li>
<p>Configure the firewall&rsquo;s Remote User VPN (on the Network menu) to use RADIUS by checking the &ldquo;Use RADIUS to authenticate remote users&rdquo; check box.</p>
</li>
</ul>
<p>Once this is done, proceed with configuring PPTP-based remote user VPNs as usual. Be sure to add a rule allowing traffic to/from the pptp_users group; otherwise, VPN users will be subject to the same traffic restrictions as Internet users.</p>
<h3 id="configuring-internet-authentication-service">Configuring Internet Authentication Service</h3>
<p>Before doing anything else, create a new global security group in Active Directory. Call it &ldquo;pptp_users&rdquo;, just like the name of the group on the Firebox. This is an important part of the glue that will bind the Firebox together with Active Directory.</p>
<p>If IAS is not already installed, install IAS using the Add/Remove Programs icon in Control Panel.</p>
<p>Once it has been installed, launch it from the Administrative Tools folder on the Start Menu and we&rsquo;ll proceed with configuring it for authenticating VPN connections to the Firebox.</p>
<p>First, we need to grant IAS permission to read dial-in properties from user accounts in Active Directory. To do this, right-click on the &ldquo;Internet Authentication Service (Local)&rdquo; and select &ldquo;Register Server in Active Directory&rdquo;. Select Yes (or OK) if prompted to confirm. Note that if IAS was already installed, it may have already been registered with Active Directory as well.</p>
<p>With that done, we can now configure the Firebox as a RADIUS client. Right-click on RADIUS Clients and select New RADIUS Client. In the wizard, specify the IP address (or DNS name) of the Firebox&rsquo;s trusted interface and the shared secret. Note that this shared secret is the same secret key specified when configuring the RADIUS server in the Firebox previously. RADIUS clients use this to authenticate to RADIUS servers, so make it a reasonably strong password.</p>
<p>Now create a new remote access policy. Right-click on Remote Access Policies and select New Remote Access Policy. In the wizard, specify a name, select to create a custom policy, and then add the following conditions to the policy:</p>
<ul>
<li>
<p>NAS-IP-Address: This will be the IP address of the Firebox&rsquo;s trusted interface. This helps to ensure that this policy only applies to VPN requests from this firewall and not from any other RADIUS client.</p>
</li>
<li>
<p>Windows-Groups: This should be the &ldquo;pptp_users&rdquo; security group created earlier. Any user that should be allowed to authenticate on a VPN connection will need to be a member of this group.</p>
</li>
</ul>
<p>Of course, this policy should grant access. On the next screen, select &ldquo;Edit Profile&rdquo; to edit the remote access profile. This is important because we&rsquo;ll need to verify that the RADIUS server is passing the correct information to the Firebox.</p>
<p>On the Advanced tab, remove all the attributes listed there (Service-Type and Framed-Protocol are there by default) and then add the Filter-Id attribute. To this attribute, add the string value &ldquo;pptp_users&rdquo;. Click OK to save these changes to the profile and then finish creating the policy.</p>
<p>Make this policy the first policy (using the Move Up/Move Down commands in the IAS console), add a user to the group created earlier, and then test your connection. Remote systems attempting to connect via PPTP should now be able to authenticate the VPN connection using their Active Directory usernames and passwords.</p>
<p><strong>UPDATE:</strong> I&rsquo;ve updated this entry to correct some errors pointed out in the comments. Thanks for the feedback!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/activedirectory">ActiveDirectory</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/encryption">Encryption</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/security">Security</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/windows">Windows</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/interoperability">Interoperability</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2005/12/04/some-weblog-updates/">Some Weblog Updates</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2005/12/08/mass-password-changes-in-active-directory/">Mass Password Changes in Active Directory</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2005%2f12%2f06%2fwatchguard-firebox-vpn-and-active-directory-integration%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2005%2f12%2f06%2fwatchguard-firebox-vpn-and-active-directory-integration%2f&text=WatchGuard%20Firebox%20VPN%20and%20Active%20Directory%20Integration" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2005%2f12%2f06%2fwatchguard-firebox-vpn-and-active-directory-integration%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2005/11/22/cisco-pix-vpn-and-active-directory-integration/">Cisco PIX VPN and Active Directory Integration</a> <span class="post-date-list">229 May 222222</span></li><li><a href="/2005/12/02/certificate-conversion-using-openssl/">Certificate Conversion Using OpenSSL</a> <span class="post-date-list">29 May 2022</span></li><li><a href="/2005/08/16/funky-active-directory-issue/">Funky Active Directory Issue</a> <span class="post-date-list">169 May 161616</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
