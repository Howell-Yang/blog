<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Learning NSX, Part 9: Adding a Gateway Service - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Learning NSX, Part 9: Adding a Gateway Service - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Learning NSX, Part 9: Adding a Gateway Service - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2014/02/26/learning-nsx-part-9-adding-a-gateway-service/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Learning NSX, Part 9: Adding a Gateway Service</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 269 May 262626 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;994 words (estimated 5 minutes to read)</span>
  <p>Welcome to part 9 in the Learning NVP/NSX blog series, in which I&rsquo;ll discuss adding a gateway service to a logical network.</p>
<p>If you are just now joining me for this series, let me bring you up to speed real quick:</p>
<ul>
<li>
<p>Part 1 provided a <a href="/2013/05/21/learning-nvp-part-1-high-level-architecture/">high-level overview of NVP/NSX</a> and its core components. (Reminder: NVP&rsquo;s core components are much the same as NSX&rsquo;s core components in multi-hypervisor environments.)</p>
</li>
<li>
<p>Part 2 showed you how to <a href="/2013/08/16/learning-nvp-part-2-nvp-controllers/">build NVP/NSX controllers and configure them into a controller cluster</a>.</p>
</li>
<li>
<p>Part 3 walked you through the process to <a href="/2013/08/19/learning-nvp-part-3-nvp-manager/">install and configure NVP/NSX Manager</a>, a web-based GUI that you can use to configure certain aspects of NVP/NSX.</p>
</li>
<li>
<p>Part 4 took you through the process of <a href="/2013/08/22/learning-nvp-part-4-adding-hypervisors-to-nvp/">adding hypervisors to NVP/NSX</a>.</p>
</li>
<li>
<p>Part 5 showed you how to <a href="/2013/09/06/learning-nvp-part-5-creating-a-logical-network/">create a logical network</a> that could be used to connect VMs to each other independent of the underlying physical network topology.</p>
</li>
<li>
<p>Part 6 stepped through <a href="/2013/10/28/learning-nvp-part-6-adding-an-nvp-gateway/">adding an NVP/NSX gateway appliance</a> to your environment, setting the stage for you to later add L2/L3 connectivity in and out of your logical networks.</p>
</li>
<li>
<p><a href="/2013/11/01/learning-nvp-part-7-handling-the-nvp-to-nsx-transition/">Part 7</a> and <a href="/2013/12/05/learning-nvp-part-8-an-update-on-the-nvp-to-nsx-transition/">part 8</a> focused on the transition of this blog series from NVP to NSX; no substantially new information was shared.</p>
</li>
</ul>
<p>This installation in the series builds upon all the previous articles; in particular, I assume that you have a logical network created and configured and that you have an NSX gateway appliance up running and added to the NSX domain. In this post, I&rsquo;ll show you how to add a logical gateway service to your network so that you can provide routed (layer 3) connectivity into and out of your logical network.</p>
<p>Before I start, I think it&rsquo;s important to distinguish between a gateway appliance and a gateway service. A <em>gateway appliance</em> is a physical installation (or a VM; it&rsquo;s supported as a VM in certain configurations) of the NSX gateway software; this is what I showed you how to set up in <a href="/2013/10/28/learning-nvp-part-6-adding-an-nvp-gateway/">part 6</a> of the series. A <em>gateway service</em>, on the other hand, is a logical construct. Typically, you would have multiple gateway appliances. Then you would create a gateway service that would be instantiated across multiple gateway appliances for redundancy and availability. Gateway services can be either layer 2 (provided bridged connectivity between a logical network and VLANs on the physical network) or layer 3 (providing routed&mdash;with or without NAT&mdash;connectivity between a logical network and the physical network).</p>
<p>It&rsquo;s also important to understand the distinction between a gateway service and a logical router. A gateway service is an NSX construct; a <em>logical router</em>, on the other hand, is usually a construct of the cloud management platform (like OpenStack). A single gateway service can host many logical routers.</p>
<p>In this series, I&rsquo;m only going to focus on layer 3 gateway services (primarily because I have limited resources in my environment and can&rsquo;t run both layer 2 and layer 3 gateway services).</p>
<p>To create a layer 3 gateway service, you&rsquo;ll follow these steps from within NSX Manager (formerly NVP Manager, which I showed you how to set up in <a href="/2013/08/19/learning-nvp-part-3-nvp-manager/">part 3</a>):</p>
<ol>
<li>
<p>From the menu across the top of the NSX Manager page, select Network Components &gt; Services &gt; Gateway Services. This will take you to a page titled &ldquo;Network Components Query Results,&rdquo; where NSX Manager has precreated and executed a query for the list of gateway services. Your list will be empty, naturally.</p>
</li>
<li>
<p>Click the Add button. This will open the Create Gateway Service dialog.</p>
</li>
<li>
<p>Select &ldquo;L3 Gateway Service&rdquo; from the list. Other options in this list include &ldquo;L2 Gateway Service&rdquo; (to create a layer 2 gateway service) and &ldquo;VTEP L2 Gateway Service&rdquo; (to integrate a third-party top-of-rack [ToR] switch into NSX). Click Next, or click on the &ldquo;2. Basics&rdquo; button on the left.</p>
</li>
<li>
<p>Provide a display name for the new layer 3 gateway service, then click Next (or click on &ldquo;3. Transport Nodes&rdquo; on the left). You can optionally add tags here as well, in case you wanted to associate additional metadata with this logical object in NSX.</p>
</li>
<li>
<p>On the Transport Nodes screen, click Add Gateway to select a gateway appliance (which is classified as a transport node within NSX; hypervisors are also transport nodes) to host this layer 3 gateway service.</p>
</li>
<li>
<p>From the Edit Gateway dialog box that pops up, you&rsquo;ll need to select a transport node, a device ID, and a failure zone ID. The first option, the transport node, is pretty straightforward; this is a gateway appliance on which to host this gateway service. The device ID is the bridge (recall that NSX gateway appliances, by default, create OVS bridges to map to their interfaces) connected to the external network. The failure zone ID lets you &ldquo;group&rdquo; gateway appliances with regard to their relationship to the gateway service. For example, you could choose to host a gateway service on a gateway from failure zone 1 as well as failure zone 2. (Failure zones are intended to help represent different failure domains within your data center.)</p>
</li>
<li>
<p>Once you&rsquo;ve added at least two gateway appliances as transport nodes for your gateway service, click Save to create the gateway service and return to NSX Manager. That&rsquo;s it&mdash;you&rsquo;re done!</p>
</li>
</ol>
<p>Note that this is more of an implementation task than an operational task. In other words, you&rsquo;d generally deploy your gateway services when you first set up NSX and your cloud management platform, or when you are adding capacity to your environment. This isn&rsquo;t something that you have to do when a cloud tenant (customer) needs a logical router; that&rsquo;s handled automatically through the integration between NSX and the cloud management platform. As I mentioned earlier, a single layer 3 gateway service could host many logical routers.</p>
<p>In the next installation of the series, I&rsquo;ll walk you through setting up an NSX service node to offload packet replication (for broadcast, unknown unicast, and multicast traffic).</p>
<p>As always, your feedback is welcome and encouraged, so feel free to speak up in the comments below.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nsx">NSX</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nvp">NVP</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2014/02/19/using-curl-to-interact-with-a-restful-api/">Using Curl to Interact with a RESTful API</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2014/02/27/learning-nsx-part-10-adding-a-service-node/">Learning NSX, Part 10: Adding a Service Node</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2014%2f02%2f26%2flearning-nsx-part-9-adding-a-gateway-service%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2014%2f02%2f26%2flearning-nsx-part-9-adding-a-gateway-service%2f&text=Learning%20NSX%2c%20Part%209%3a%20Adding%20a%20Gateway%20Service" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2014%2f02%2f26%2flearning-nsx-part-9-adding-a-gateway-service%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2013/12/05/learning-nvp-part-8-an-update-on-the-nvp-to-nsx-transition/">Learning NVP, Part 8: An Update on the NVP to NSX Transition</a> <span class="post-date-list">59 May 5055</span></li><li><a href="/2014/02/06/technology-short-take-38/">Technology Short Take #38</a> <span class="post-date-list">69 May 6066</span></li><li><a href="/2013/12/11/talking-network-virtualization-on-runas-radio/">Talking Network Virtualization on RunAs Radio</a> <span class="post-date-list">119 May 111111</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
