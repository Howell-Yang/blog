<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Learning NSX, Part 15: NSX Gateways, Gateway Services, and Logical Routers - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Learning NSX, Part 15: NSX Gateways, Gateway Services, and Logical Routers - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Learning NSX, Part 15: NSX Gateways, Gateway Services, and Logical Routers - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2014/07/16/learning-nsx-part-15-nsx-gateways-gateway-services-and-logical-routers/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Learning NSX, Part 15: NSX Gateways, Gateway Services, and Logical Routers</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 169 May 161616 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;886 words (estimated 5 minutes to read)</span>
  <p>This is part 15 of my Learning NSX blog series, in which I will spend some time diving a bit deeper into some of the components involved in the logical routing process I described in part 14. Specifically, I&rsquo;ll be taking a deeper look at gateway appliances, gateway services, and logical routers, and the relationships among these various components.</p>
<p>If you haven&rsquo;t read any of the prior posts in this series, it would be ideal to read all of them before continuing; you can find links on <a href="/learning-nvp-nsx/">my Learning NVP/NSX page</a>. In particular, I&rsquo;d suggest reading <a href="/2013/10/28/learning-nvp-part-6-adding-an-nvp-gateway/">part 6</a> (on adding a gateway appliance), <a href="/2014/02/26/learning-nsx-part-9-adding-a-gateway-service/">part 9</a> (on adding a gateway service), and <a href="/2014/06/20/learning-nsx-part-14-using-logical-routing/">part 14</a> (on logical routing and logical routers).</p>
<p>Just for the sake of completeness and to reinforce what was introduced in those posts I referenced, let&rsquo;s start with some terminology:</p>
<ul>
<li>
<p><em>Gateway (or gateway appliance):</em> When I use the terms <em>gateway</em> or <em>gateway appliance</em>, I&rsquo;m referring to the NSX software gateway that acts as the &ldquo;on-ramp/off-ramp&rdquo; to and from logical networks. What makes this confusing is that we also use the term &ldquo;gateway&rdquo; (in particular, &ldquo;IP gateway&rdquo; or &ldquo;default gateway&rdquo;) to refer to a Layer 3 router that acts as the next hop for a aystem. I&rsquo;ll do my best to make sure that I&rsquo;m clearly distinguishing between these ambiguous uses.</p>
</li>
<li>
<p><em>Gateway service:</em> A <em>gateway service</em> is a logical construct within NSX that allows you to group together multiple <em>gateway appliances</em>. For example, in an L2 gateway service, you can combine two gateway appliances so that you have redundancy in providing L2 bridging functionality between a logical network and a physical network. In an L3 gateway service, you can combine up to 10 gateway appliances together for redundancy and scale-out performance.</p>
</li>
<li>
<p><em>Logical router:</em> As you might recall from part 14, a logical router is a logical construct within NSX that provides Layer 3 routing functionality, typically (but not always) on a per-tenant basis.</p>
</li>
</ul>
<p>I have a few more terms I&rsquo;ll introduce in this post, but that should be enough for now.</p>
<p>This diagram contains the bulk of what I&rsquo;d like to discuss in this post&mdash;the relationship between gateway services, gateway appliances, and logical routers:</p>
<p><img src="/public/img/part-15-gws-gwa-lr.png" alt="Gateway service, gateway appliance, and logical router relationships"></p>
<p>As I walk you through the details of this diagram, hopefully I&rsquo;ll clarify the relationships between these components.</p>
<ul>
<li>
<p>In this example, there are four gateway appliances combined into a single Layer 3 gateway service. As illustrated in the diagram, gateway services can contain more than one gateway appliance (the minimum recommended is two, for reasons to be explained shortly). Gateway services may be either Layer 2 (bridging/switching) or Layer 3 (routing), but not both.</p>
</li>
<li>
<p>A gateway appliance may be a member of only one gateway service at a time; therefore, a gateway appliance is either L2 or L3, but not both.</p>
</li>
<li>
<p>When adding a gateway appliance to a gateway service, the administrator or operator has the ability to specify a <em>failure zone ID</em>. The idea behind the failure zone ID is to help model fault domains within a single gateway service. For example, if GW Appliance 1 is in a different fault domain&mdash;say, a different rack&mdash;then the administrator or operator could assign a different failure zone ID to GW Appliance 1, indicating that GW Appliance 1 is in a different fault domain. The significance of this functionality will be made clear in a moment.</p>
</li>
<li>
<p>Note that gateway services, gateway appliances, and failure zone IDs are <strong>not</strong> visible to tenants. Further, the configuration or management of these entities is handled through NSX (via API or NSX Manager), and isn&rsquo;t tenant-specific. The CMP&mdash;OpenStack, for example&mdash;doesn&rsquo;t get involved here.</p>
</li>
<li>
<p>The example diagram shows four different logical routers spread across three tenants. Each of these logical routers acts as an IP gateway (default gateway/default route) for the associated (or connected) logical network(s). Thus, a logical router <strong>is</strong> visible to a tenant.</p>
</li>
<li>
<p>Creating, managing, and configuring logical routers is handled by the CMP. With OpenStack, for example, you&rsquo;d use the OpenStack Dashboard or the Neutron command-line client.</p>
</li>
<li>
<p>For redundancy, you&rsquo;ll note that each logical router is instantiated on 2 different gateway appliances within the gateway service (hence why a minimum of 2 gateway appliances within a gateway service is recommended). This is completely invisible to the tenant and is handled automatically by NSX. If failure zone IDs&mdash;indicating different fault domains&mdash;are configured on the gateway appliances, then NSX will instantiate the logical router on gateway appliances <em>in different failure zones</em>. This is an attempt to minimize downtime by spreading the logical router across fault domains.</p>
</li>
</ul>
<p>So far, everything I&rsquo;ve shared with you has been true for centralized logical routers. For distributed logical routers, things are only <em>slightly</em> different. Distributed logical routers are normally instantiated on the hypervisors; a gateway service and its associated gateway appliances only gets involved when you set the uplink for the distributed logical router (using the &ldquo;Set Gateway&rdquo; button in OpenStack Dashboard, for example). If you never set an uplink for the logical router, it will remain instantiated only on the hypervisors, and not on the gateway service/gateway appliances.</p>
<p>I hope this information helps in understanding the routing aspects of VMware NSX. Feel free to post any questions, clarifications, or thoughts in the comments below. Any input on other topics you&rsquo;d like to see in the Learning NSX blog series are welcome as well!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/neutron">Neutron</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nsx">NSX</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nvp">NVP</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/openstack">OpenStack</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2014/07/14/examining-the-needs-of-a-policy-solution/">Examining the Needs of a Policy Solution</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2014/07/18/fix-for-strange-issue-booting-kvm-guests/">Fix for Strange Issue Booting KVM Guests</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2014%2f07%2f16%2flearning-nsx-part-15-nsx-gateways-gateway-services-and-logical-routers%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2014%2f07%2f16%2flearning-nsx-part-15-nsx-gateways-gateway-services-and-logical-routers%2f&text=Learning%20NSX%2c%20Part%2015%3a%20NSX%20Gateways%2c%20Gateway%20Services%2c%20and%20Logical%20Routers" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2014%2f07%2f16%2flearning-nsx-part-15-nsx-gateways-gateway-services-and-logical-routers%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2014/06/20/learning-nsx-part-14-using-logical-routing/">Learning NSX, Part 14: Using Logical Routing</a> <span class="post-date-list">209 May 202020</span></li><li><a href="/2014/04/28/learning-nsx-part-13-revisiting-logical-networking/">Learning NSX, Part 13: Revisiting Logical Networking</a> <span class="post-date-list">289 May 282828</span></li><li><a href="/2014/04/25/learning-nsx-part-12-integrating-vmware-nsx-with-openstack/">Learning NSX, Part 12: Integrating VMware NSX with OpenStack</a> <span class="post-date-list">259 May 252525</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
