<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Fix for Strange Issue Booting KVM Guests - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Fix for Strange Issue Booting KVM Guests - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Fix for Strange Issue Booting KVM Guests - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2014/07/18/fix-for-strange-issue-booting-kvm-guests/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Fix for Strange Issue Booting KVM Guests</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 189 May 181818 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;536 words (estimated 3 minutes to read)</span>
  <p>This issue describes a fix I found for an issue I had when booting KVM guest domains on the Ubuntu/KVM hypervisors in my home lab. I&rsquo;d been struggling with this issue for quite some time now, but only recently found what I believe to be the final fix for the problem.</p>
<p>First, allow me to provide a bit of background. Some time ago&mdash;I&rsquo;d say around August 2012, when I left the vSpecialist team at EMC to join an OpenStack-focused team in another part of EMC&mdash;I moved my home lab over completely to Ubuntu 12.04 LTS with the KVM hypervisor. This was an important step in educating myself on Linux, KVM, libvirt, and Open vSwitch (OVS), all of which are critical core components in most installations of OpenStack.</p>
<p>Ever since making that change&mdash;particularly after adding some new hardware, a pair of Dell C6100 servers, to my home lab&mdash;I would experience intermittent problems booting a KVM guest. The guest would appear to boot properly, but then hang shortly after a message about activating swap space and fsck reporting that the file system was clean. Sometimes, rebooting the guest would work; many times, rebooting the guest didn&rsquo;t work. Re-installing the guest sometimes worked, but sometimes it didn&rsquo;t. There didn&rsquo;t appear to be any consistency with regard to the host (the issue occurred on all hosts) or guest configuration. The only consistency appeared to be with Ubuntu, as virtually (no pun intended) all my KVM guests were running Ubuntu.</p>
<p>Needless to say, this was quite frustrating. I tried all the troubleshooting I could imagine&mdash;deleting and recreating swap space, manually checking the file system(s), various different installation routines&mdash;and nothing seemed to make any difference.</p>
<p>Finally, just in the last few weeks, I stumbled across <a href="http://forum.proxmox.com/threads/17997-ubuntu-12-04-KVM-Error-during-boot-never-finishing-boot-from-console">this page</a>, which indicated that adding &ldquo;nomodeset&rdquo; to the grub command line fixed the problem. This was a standard part of my build (it kept the console from getting too large when using VNC to connect to the guest), but it required that I was able to successfully boot the VM first. I&rsquo;d noted that once I had been able to successfully boot a guest and add &ldquo;nomodeset&rdquo; to the grub configuration, I didn&rsquo;t have any further issues with that particular guest; however, I explained that away by saying that the intermittent boot issue must have been some sort of first-time boot issue.</p>
<p>In any case, that page linked to <a href="http://serverfault.com/questions/561286/why-is-my-machine-not-showing-anything-when-booting">this ServerFault entry</a>, which also indicated that the use of &ldquo;nomodeset&rdquo; helped fix some (seemingly) random boot problems. The symptoms described there&mdash;recovery mode worked fine, booting normally after booting into recovery mode resulted in an &ldquo;initctl: event failed&rdquo; error&mdash;were consistent with what I&rsquo;d been seeing as well.</p>
<p>So, I took one of the VMs that was experiencing this problem, booted it into recovery mode, edited the <code>/etc/default/grub</code> file to include &ldquo;nomodeset&rdquo; on the <code>GRUB_CMDLINE_LINUX_DEFAULT</code> line, and rebooted. The KVM guest booted without any issues. Problem fixed (apparently).</p>
<p>Thus far, this has fixed the intermittent boot issue on every KVM guest I&rsquo;ve tried, so I&rsquo;m relatively comfortable recommending it as a potential change you should explore if you experience the same problem/symptoms. I can&rsquo;t guarantee it will work, but it has worked for me so far.</p>
<p>Good luck!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/kvm">KVM</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2014/07/16/learning-nsx-part-15-nsx-gateways-gateway-services-and-logical-routers/">Learning NSX, Part 15: NSX Gateways, Gateway Services, and Logical Routers</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2014/07/21/spousetivities-at-vmworld-2014/">Spousetivities at VMworld 2014</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2014%2f07%2f18%2ffix-for-strange-issue-booting-kvm-guests%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2014%2f07%2f18%2ffix-for-strange-issue-booting-kvm-guests%2f&text=Fix%20for%20Strange%20Issue%20Booting%20KVM%20Guests" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2014%2f07%2f18%2ffix-for-strange-issue-booting-kvm-guests%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2014/02/06/technology-short-take-38/">Technology Short Take #38</a> <span class="post-date-list">69 May 6066</span></li><li><a href="/2013/12/02/connecting-bare-metal-workloads-using-gre-tunnels-and-ovs/">Connecting Bare Metal Workloads Using GRE Tunnels and OVS</a> <span class="post-date-list">29 May 2022</span></li><li><a href="/2013/09/10/adjusting-vnc-console-access-via-libvirt-xml/">Adjusting VNC Console Access via Libvirt XML</a> <span class="post-date-list">109 May 101010</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
