<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Building a VMware-Formatted Cumulus VX Vagrant Box - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Building a VMware-Formatted Cumulus VX Vagrant Box - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Building a VMware-Formatted Cumulus VX Vagrant Box - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2016/05/04/building-vmw-cumulus-vx-box/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Building a VMware-Formatted Cumulus VX Vagrant Box</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 49 May 4044 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;685 words (estimated 4 minutes to read)</span>
  <p>In this post, I&rsquo;m going to walk you through the process I used to build a <a href="https://www.vagrantup.com/">Vagrant</a> box for <a href="https://cumulusnetworks.com/cumulus-vx/">Cumulus VX</a> that will work with VMware desktop hypervisors (like <a href="http://www.vmware.com/products/fusion/">VMware Fusion</a> or <a href="http://www.vmware.com/products/workstation/">VMware Workstation</a>). Although Cumulus Networks offers several different versions of Cumulus VX to download, they do not (strangely enough) offer a Vagrant box that will work with VMware&rsquo;s desktop hypervisors.</p>
<p>If you&rsquo;re not familiar with Cumulus VX, it&rsquo;s a virtual appliance version of <a href="https://cumulusnetworks.com/cumulus-linux/overview/">Cumulus Linux</a>. This allows you to test Cumulus Linux without needing compatible network hardware. This is really handy for testing configuration management tools against Cumulus Linux, for testing complex topologies before you implement them in production, or just for getting a feel for how Cumulus Linux works.</p>
<p>Naturally, this sounds like a perfect fit to use with Vagrant, so if you&rsquo;re interested&mdash;as I am/was&mdash;in running Cumulus VX with Vagrant using a VMware desktop hypervisor, then the process described below should get you all fixed up.</p>
<p>First, you&rsquo;ll want to get a hold of the VMware version of Cumulus VX. Navigate over to <a href="https://cumulusnetworks.com/cumulus-vx/download/">the Cumulus VX download page</a> (a free registration is required), and download the VMware version. This will download an OVA file. <em>Don&rsquo;t</em> download the Vagrant box; this is formatted for VirtualBox and won&rsquo;t work (at least, it didn&rsquo;t work for me).</p>
<p>OVA files are just TAR files, so after it has finished downloaded unpack the OVA file into separate files (the filename might be slightly different for you):</p>
<pre><code>tar xvzf CumulusVX-2.5.6-4048c0a8213324c0-vmware.ova
</code></pre>
<p>You&rsquo;ll end up with a VMware virtual disk (VMDK) file and an OVF manifest.</p>
<p>Next, using your VMware desktop hypervisor, import the OVF file. I tested this with VMware Fusion, but it should work very similarly with Workstation. This will create a &ldquo;native&rdquo; VMware VM.</p>
<p>Once the VM is imported, boot the VM. The Cumulus VX user guide provides the default username and password; after it has booted up, go ahead and log into the VM. You&rsquo;ll also want to make sure the VM has connectivity to the Internet.</p>
<p>Now it&rsquo;s time to configure the Cumulus VX instance to support Vagrant. The first step will be to copy the Vagrant default insecure SSH key into the Cumulus VX VM. Cumulus VX has <code>wget</code> installed by default, so you could use this command:</p>
<pre><code>wget https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant.pub
</code></pre>
<p>Then install the Vagrant insecure SSH key you just downloaded into the VM&rsquo;s <code>authorized_keys</code> file:</p>
<pre><code>cat vagrant.pub &gt;&gt; ~/.ssh/authorized_keys
chmod 0600 ~/.ssh/authorized_keys
</code></pre>
<p>That&rsquo;s it for changes to the Cumulus VX instance; you can go ahead and shut down the VM.</p>
<p>In the same directory where the VM&rsquo;s files are located, create a file named <code>metadata.json</code> with these contents:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;provider&#34;</span>: <span style="color:#e6db74">&#34;vmware_desktop&#34;</span>}
</span></span></code></pre></div><p>In the same directory as <code>metadata.json</code> and the rest of the VM&rsquo;s files, create another file named <code>Vagrantfile</code> with these contents:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># -*- mode: ruby -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vi: set ft=ruby</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Vagrant</span><span style="color:#f92672">.</span>configure(<span style="color:#e6db74">&#34;2&#34;</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Set the SSH username</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>ssh<span style="color:#f92672">.</span>username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cumulus&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Use the default Vagrant insecure key</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>ssh<span style="color:#f92672">.</span>insert_key <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Disable the VMware Fusion GUI</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provider <span style="color:#e6db74">&#39;vmware_fusion&#39;</span> <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>v, override<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>    v<span style="color:#f92672">.</span>gui <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span> <span style="color:#75715e"># config.vm.provider</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#75715e"># Vagrant.configure</span>
</span></span></code></pre></div><p>Finally, remove any <code>*.plist</code> files from the directory with the VM&rsquo;s files, and also trash any log files.</p>
<p>Now you&rsquo;re ready to package it all up. Vagrant boxes, like OVA files, are just TAR files, so create the Vagrant box with this command:</p>
<pre><code>tar cvzf cumulus-vx.box ./*
</code></pre>
<p>After that command completes, add the new Vagrant box so that Vagrant can start using it:</p>
<pre><code>vagrant box add cumulus-vx-2.5.6 cumulus-vx.box
</code></pre>
<p>While you&rsquo;re at the CLI, add the <code>vagrant-cumulus</code> plugin you&rsquo;ll need as well:</p>
<pre><code>vagrant plugin install vagrant-cumulus
</code></pre>
<p>You can now start creating Vagrant environments that include Cumulus VX instances.</p>
<p>One final note: it looks like the <code>vagrant-cumulus</code> Vagrant plugin may have a bug that prevents it from correctly setting the hostname of Cumulus VX instances, so you&rsquo;ll get an error when you run <code>vagrant up</code>. Despite the error, everything <em>seems</em> to work well, so I think you&rsquo;re safe to ignore the error for now. I don&rsquo;t have a workaround for that yet, but when I find one I&rsquo;ll update this post with more information.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/fusion">Fusion</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cumulus">Cumulus</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2016/04/30/installing-ansible-in-virtualenv/">Installing Ansible 2.x in a Python Virtualenv on OS X</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2016/05/06/using-terraform-etcd2-openstack/">Using Terraform to Build an etcd2 Cluster on OpenStack</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2016%2f05%2f04%2fbuilding-vmw-cumulus-vx-box%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2016%2f05%2f04%2fbuilding-vmw-cumulus-vx-box%2f&text=Building%20a%20VMware-Formatted%20Cumulus%20VX%20Vagrant%20Box" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2016%2f05%2f04%2fbuilding-vmw-cumulus-vx-box%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2016/04/04/technology-short-take-64/">Technology Short Take #64</a> <span class="post-date-list">49 May 4044</span></li><li><a href="/2016/03/09/technology-short-take-62/">Technology Short Take #62</a> <span class="post-date-list">99 May 9099</span></li><li><a href="/2016/01/29/technology-short-take-60/">Technology Short Take #60</a> <span class="post-date-list">299 May 292929</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
