<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Using Vagrant with AWS - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Using Vagrant with AWS - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Using Vagrant with AWS - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2016/09/15/using-vagrant-with-aws/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Using Vagrant with AWS</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 159 May 151515 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;891 words (estimated 5 minutes to read)</span>
  <p>In this post, I&rsquo;d like to describe how to use <a href="https://www.vagrantup.com">Vagrant</a> with <a href="https://aws.amazon.com">AWS</a>, as well as provide a brief description of why this combination of technologies may make sense for some use cases. In some respects, this post is similar to my posts on <a href="/2015/09/24/using-docker-machine-with-openstack/">using Docker Machine with OpenStack</a> and <a href="/2015/09/28/using-vagrant-with-openstack/">using Vagrant with OpenStack</a> in that combining Vagrant with AWS creates another clean &ldquo;provider/consumer&rdquo; model that makes it easy for users to consume infrastructure.</p>
<p>If you aren&rsquo;t already familiar with Vagrant, I&rsquo;d highly recommend first taking a look at my <a href="/2014/09/12/a-quick-introduction-to-vagrant/">introduction to Vagrant</a>, which provides an overview of the tool and how it&rsquo;s used.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Naturally, you&rsquo;ll need to first ensure that you have Vagrant installed. This is really well-documented already, so I won&rsquo;t go over it here. Next, you&rsquo;ll need to install the AWS provider for Vagrant, which you can handle using this command:</p>
<pre><code>vagrant plugin install vagrant-aws
</code></pre>
<p>Once you&rsquo;ve installed the <code>vagrant-aws</code> plugin, you&rsquo;ll next need to install a box that Vagrant can use. Here, the use of Vagrant with AWS is a bit different than the use of Vagrant with a provider like <a href="https://www.virtualbox.org">VirtualBox</a> or <a href="http://www.vmware.com/products/fusion.html">VMware Fusion</a>/<a href="http://www.vmware.com/products/workstation.html">VMware Workstation</a>. In those cases, the box is a VM template that is then cloned/copied to instantiate running VMs. When using Vagrant with AWS, you&rsquo;ll leverage AWS&rsquo; Amazon Machine Images (AMIs), and so the role of the Vagrant box is really nothing more than a formality. In fact, Mitchell Hashimoto (the author of Vagrant and the <code>vagrant-aws</code> plugin) has a &ldquo;dummy&rdquo; box you can add:</p>
<pre><code>vagrant box add aws-dummy https://github.com/mitchellh/vagrant-aws/raw/master/dummy.box
</code></pre>
<p>You can name this box whatever you like; in the command above, I&rsquo;ve called it &ldquo;aws-dummy&rdquo;.</p>
<p>Once you&rsquo;ve gotten the AWS plugin and the dummy box installed, you&rsquo;re ready to start spawning AWS instances via Vagrant.</p>
<h2 id="launching-aws-instances-via-vagrant">Launching AWS Instances via Vagrant</h2>
<p>In my use of Vagrant, I prefer to keep the Vagrant configuration (stored in the file named <code>Vagrantfile</code>) as clean as possible, and separate details into a separate data file (typically using YAML). I outlined this approach <a href="/2014/10/22/multi-machine-vagrant-with-yaml/">here</a> and <a href="/2016/01/14/improved-way-yaml-vagrant/">here</a>. For the purposes of this post, however, I&rsquo;ll just embed the details directly into the Vagrant configuration to make it easier to understand. I have examples of using a YAML data file with Vagrant and AWS in the &ldquo;Additional Resources&rdquo; section below.</p>
<p>Here&rsquo;s a snippet of a <code>Vagrantfile</code> you could use to instantiate AWS instances using Vagrant:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#75715e"># Require the AWS provider plugin</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;vagrant-aws&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create and configure the AWS instance(s)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Vagrant</span><span style="color:#f92672">.</span>configure(<span style="color:#e6db74">&#39;2&#39;</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Use dummy AWS box</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;aws-dummy&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Specify AWS provider configuration</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provider <span style="color:#e6db74">&#39;aws&#39;</span> <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>aws, override<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Read AWS authentication information from environment variables</span>
</span></span><span style="display:flex;"><span>    aws<span style="color:#f92672">.</span>access_key_id <span style="color:#f92672">=</span> <span style="color:#66d9ef">ENV</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;AWS_ACCESS_KEY_ID&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>    aws<span style="color:#f92672">.</span>secret_access_key <span style="color:#f92672">=</span> <span style="color:#66d9ef">ENV</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;AWS_SECRET_ACCESS_KEY&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Specify SSH keypair to use</span>
</span></span><span style="display:flex;"><span>    aws<span style="color:#f92672">.</span>keypair_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ssh-keypair-name&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Specify region, AMI ID, and security group(s)</span>
</span></span><span style="display:flex;"><span>    aws<span style="color:#f92672">.</span>region <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;us-west-2&#39;</span>
</span></span><span style="display:flex;"><span>    aws<span style="color:#f92672">.</span>ami <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ami-20be7540&#39;</span>
</span></span><span style="display:flex;"><span>    aws<span style="color:#f92672">.</span>security_groups <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;default&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Specify username and private key path</span>
</span></span><span style="display:flex;"><span>    override<span style="color:#f92672">.</span>ssh<span style="color:#f92672">.</span>username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ubuntu&#39;</span>
</span></span><span style="display:flex;"><span>    override<span style="color:#f92672">.</span>ssh<span style="color:#f92672">.</span>private_key_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;~/.ssh/ssh-keypair-file&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>Naturally, this is a very generic configuration, so you&rsquo;d need to supply the specific details you want use. In particular, you&rsquo;d need to supply the following details:</p>
<ul>
<li>The SSH keypair in AWS you want to use</li>
<li>The AWS region you want to use</li>
<li>The AMI ID you want to use</li>
<li>The name(s) of the security group(s) you want applied to the instance(s)</li>
<li>The username that should be used to access the instances (this will vary based on the AMI)</li>
<li>The path to the private key file for the specified keypair</li>
</ul>
<p>Also, you&rsquo;ll note that the <code>Vagrantfile</code> assumes you&rsquo;ve set the <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> environment variables with the appropriate values, so be sure to do that before you try to run <code>vagrant up</code> (Vagrant will report an error otherwise).</p>
<p>With the right configuration details in place, simply run <code>vagrant up</code> from the same directory where the Vagrant configuration (in <code>Vagrantfile</code>) is stored. Vagrant will communicate with AWS (using the values in the corresponding environment variables) and instantiate the instance(s) per the details provided.</p>
<p>Once the instances are up, the &ldquo;standard&rdquo; Vagrant workflow applies:</p>
<ul>
<li>Use <code>vagrant ssh &lt;name&gt;</code> to log into one of the instances.</li>
<li>Use <code>vagrant provision</code> to apply any provisioning instructions (i.e., to copy files across or run a configuration management tool).</li>
<li>Use <code>vagrant destroy</code> to kill/terminate the instances.</li>
</ul>
<p>All in all, it makes using AWS instances feel a lot like working with local VMs.</p>
<h2 id="why-use-vagrant-with-aws">Why Use Vagrant with AWS?</h2>
<p>The idea behind Vagrant&mdash;as I understand it&mdash;is to help simplify the creation of temporary environments to be used for testing, software development, etc. The ability to quickly and easily spin up instances on AWS makes using Vagrant with AWS a natural fit for these sorts of use cases, in my mind. It also keeps a consistent workflow for users: <code>vagrant up</code> creates local VMs or instantiates AWS instances, as appropriate.</p>
<p>In situations where you are creating more &ldquo;permanent&rdquo; infrastructure&mdash;such as deploying production applications onto AWS infrastructure&mdash;then I would say that Vagrant is <em>not</em> the right fit. In those cases, using a tool like <a href="https://www.terraform.io/">Terraform</a> (see <a href="/2015/11/25/intro-to-terraform/">my introductory post</a>) or <a href="https://aws.amazon.com/cloudformation/">AWS CloudFormation</a> would be more appropriate.</p>
<h2 id="additional-resources">Additional Resources</h2>
<p>To help make using Vagrant with AWS easier, I&rsquo;ve created a couple learning environments that are part of <a href="https://github.com/scottslowe/learning-tools">my GitHub &ldquo;learning-tools&rdquo; repository</a>. Specifically, see the <code>vagrant-aws</code> and <code>vagrant-aws-multi</code> directories for sample Vagrant configurations.</p>
<p>Additionally, see the documentation for <a href="https://github.com/mitchellh/vagrant-aws">the <code>vagrant-aws</code> plugin on GitHub</a> for more details.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vagrant">Vagrant</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/aws">AWS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2016/09/13/ssh-bastion-host-follow-up/">A Follow Up on SSH Bastion Hosts</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2016/09/20/spousetivities-in-barcelona/">Spousetivities in Barcelona</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2016%2f09%2f15%2fusing-vagrant-with-aws%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2016%2f09%2f15%2fusing-vagrant-with-aws%2f&text=Using%20Vagrant%20with%20AWS" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2016%2f09%2f15%2fusing-vagrant-with-aws%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2016/03/25/docker-swarm-aws-docker-machine/">Docker Swarm on AWS using Docker Machine</a> <span class="post-date-list">259 May 252525</span></li><li><a href="/2016/03/22/using-docker-machine-with-aws/">Using Docker Machine with AWS</a> <span class="post-date-list">229 May 222222</span></li><li><a href="/2016/03/21/vagrant-ubuntu-wily-networking-problem/">Vagrant, Ubuntu &#34;Wily Werewolf,&#34; and Networking</a> <span class="post-date-list">219 May 212121</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
