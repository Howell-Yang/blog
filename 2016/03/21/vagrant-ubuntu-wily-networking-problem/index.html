<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Vagrant, Ubuntu &#34;Wily Werewolf,&#34; and Networking - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Vagrant, Ubuntu &#34;Wily Werewolf,&#34; and Networking - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Vagrant, Ubuntu &#34;Wily Werewolf,&#34; and Networking - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2016/03/21/vagrant-ubuntu-wily-networking-problem/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Vagrant, Ubuntu &#34;Wily Werewolf,&#34; and Networking</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 219 May 212121 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;548 words (estimated 3 minutes to read)</span>
  <p>In what has been a fairly classic <a href="http://projects.csail.mit.edu/gsb/old-archive/gsb-archive/gsb2000-02-11.html">&ldquo;yak shaving&rdquo;</a> exercise, I&rsquo;ve been working on getting <a href="https://wiki.ubuntu.com/WilyWerewolf/ReleaseNotes">Ubuntu 15.10 &ldquo;Wily Werewolf&rdquo;</a> running with <a href="https://www.vagrantup.com/">Vagrant</a> so that I can perform some testing with some other technologies that need a Linux kernel version of at least 4.2 (which comes with Ubuntu 15.10 by default). Along the way, I ran smack into a problem with Ubuntu 15.10&rsquo;s networking configuration when used with Vagrant, and in this post I&rsquo;m going to explain what&rsquo;s happening here and provide a workaround.</p>
<p>The issue (described <a href="https://github.com/mitchellh/vagrant/issues/6871">here on GitHub</a>, among other places) involves a couple of changes in Ubuntu Linux (and upstream Debian GNU/Linux as well, although I haven&rsquo;t personally tested it). One of the changes is in regards to how network interfaces are named; instead of the &ldquo;old&rdquo; <code>eth0</code> or <code>eth1</code> naming convention, Ubuntu 15.10 now uses persistent interface names like <code>ens32</code> or <code>ens33</code>. Additionally, an update to the &ldquo;ifupdown&rdquo; package now returns an error where an error apparently wasn&rsquo;t returned before.</p>
<p>The end result is that when you try to create a Vagrant VM with multiple network interfaces, it fails. Using a single network interface is fine; the issue only rears its head when you want to use multiple network interfaces. I don&rsquo;t know about you, but <em>I</em> use multiple network interfaces quite frequently, so this is a real problem for me. Fortunately, there&rsquo;s a workaround.</p>
<p>As you may know, I&rsquo;m a fan of using parameterized data stored in YAML files with Vagrant (see <a href="/2014/10/22/multi-machine-vagrant-with-yaml/">here</a> and <a href="/2016/01/14/improved-way-yaml-vagrant/">here</a> for more information). So most of my Vagrant environments have this snippet of code in the <code>Vagrantfile</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> server<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;ip_addr&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>  srv<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>network <span style="color:#e6db74">&#39;private_network&#39;</span>, <span style="color:#e6db74">ip</span>: server<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;ip_addr&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#75715e"># if server[&#39;ip_addr&#39;]</span>
</span></span></code></pre></div><p>This snippet of code basically says that if a value exists for <code>ip_addr</code> in the YAML file, use that value as the IP address to be assigned to an additional private network. (Note that it doesn&rsquo;t do any validity checking on the value, so clearly there&rsquo;s room to make this more robust.) If the value is nil (there is no value), then no additional network interface is defined. This makes it easy for me to include an extra private network on a per-machine basis simply by including an IP address in the YAML file.</p>
<p>Obviously, given the issue with Vagrant and Ubuntu 15.10, this won&rsquo;t work. The workaround, then, is to simply not use Vagrant&rsquo;s network interface functionality, like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> server<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;ip_addr&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>  srv<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>network <span style="color:#e6db74">&#39;private_network&#39;</span>, <span style="color:#e6db74">auto_config</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#75715e"># if server[&#39;ip_addr&#39;]</span>
</span></span></code></pre></div><p>This modified snippet says that if a value exists for <code>ip_addr</code> in the YAML file, create an additional network interface but <em>do not configure the interface.</em> This works&mdash;Vagrant will create the VM with the additional interface, but won&rsquo;t try to configure the interface in any way, shape, form, or fashion.</p>
<p>Once the interface has been created by Vagrant, then you can configure the interface manually, using <a href="https://www.ansible.com/">Ansible</a>, or via whatever tool makes the most sense to you. I&rsquo;m still working through some methods for configuring the interface via either an ERB template or via Ansible; I&rsquo;ve run into a few snags but hope to have those worked out soon. In the meantime, if you&rsquo;re using Ubuntu 15.10 with Vagrant, keep this potential issue in mind and plan to work around the problem until a (permanent) fix is available.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ubuntu">Ubuntu</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vagrant">Vagrant</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2016/03/18/technology-short-take-63/">Technology Short Take #63</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2016/03/22/using-docker-machine-with-aws/">Using Docker Machine with AWS</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2016%2f03%2f21%2fvagrant-ubuntu-wily-networking-problem%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2016%2f03%2f21%2fvagrant-ubuntu-wily-networking-problem%2f&text=Vagrant%2c%20Ubuntu%20%22Wily%20Werewolf%2c%22%20and%20Networking" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2016%2f03%2f21%2fvagrant-ubuntu-wily-networking-problem%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2015/06/30/fix-for-ubuntu-caching-network-configuration/">A Fix for Ubuntu Apparently Caching Network Configuration</a> <span class="post-date-list">309 May 303030</span></li><li><a href="/2015/05/22/technology-short-take-51/">Technology Short Take #51</a> <span class="post-date-list">229 May 222222</span></li><li><a href="/2015/04/15/running-etcd-20-cluster/">Running an etcd 2.0 Cluster on Ubuntu 14.04</a> <span class="post-date-list">159 May 151515</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
