<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Retrieving the Kubeconfig for a Cluster API Workload Cluster - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Retrieving the Kubeconfig for a Cluster API Workload Cluster - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Retrieving the Kubeconfig for a Cluster API Workload Cluster - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2020/02/19/retrieving-kubeconfig-cluster-api-workload-cluster/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Retrieving the Kubeconfig for a Cluster API Workload Cluster</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 199 May 191919 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;453 words (estimated 3 minutes to read)</span>
  <p>Using <a href="https://github.com/kubernetes-sigs/cluster-api">Cluster API</a> allows users to create new <a href="https://kubernetes.io/">Kubernetes</a> clusters easily using manifests that define the desired state of the new cluster (also referred to as a workload cluster; see <a href="/2019/08/26/an-introduction-to-kubernetes-cluster-api/">here</a> for more terminology). But how does one go about accessing this new workload cluster once it&rsquo;s up and running? In this post, I&rsquo;ll show you how to retrieve the Kubeconfig file for a new workload cluster created by Cluster API.</p>
<p>(By the way, there&rsquo;s nothing new or revolutionary about the information in this post; I&rsquo;m simply sharing it to help folks who may be new to Cluster API.)</p>
<p>Once CAPI has created the new workload cluster, it will also create a new Kubeconfig for accessing this cluster. This Kubeconfig will be stored as a Secret (a specific type of Kubernetes object). In order to use this Kubeconfig to access your new workload cluster, you&rsquo;ll need to retrieve the Secret, decode it, and then use it with <code>kubectl</code>.</p>
<p>First, you can see the secret by running <code>kubectl get secrets</code> in the namespace where your new workload cluster was created. If the name of your workload cluster was &ldquo;workload-cluster-1&rdquo;, then the name of the Secret created by Cluster API would be &ldquo;workload-cluster-1-kubeconfig&rdquo;.</p>
<p>To retrieve the Secret and decode it, use this command:</p>
<pre><code>kubectl get secret &lt;cluster-name&gt;-kubeconfig -o jsonpath='{.data.value}' | base64 -D &gt; /path/to/saved/kubeconfig/file
</code></pre>
<p>Let me break down this command a bit. First, you&rsquo;re using the <code>-o jsonpath</code> parameter to the <code>kubectl get secret</code> command to show <em>only</em> the value of the Secret (and not include all the associated metadata). Second, the command pipes this value through to <code>base64</code>, which uses the <code>-D</code> switch to decode the base64-encoded contents of the Secret. (This command is for macOS; the command will be slightly different on Linux or Windows.) Finally, you are redirecting the output of the command into a file.</p>
<p>Once you have the Kubeconfig file decoded and saved locally, then you can use it to access the workload cluster like this:</p>
<pre><code>export KUBECONFIG=/path/to/saved/kubeconfig/file
kubectl cluster-info
</code></pre>
<p>Note that context&mdash;the user and cluster that <code>kubectl</code> will communicate with&mdash;is <em>really</em> important when working with multiple clusters, like in a Cluster API environment. I <strong>very strongly recommend</strong> using a tool that will show you your current Kubernetes context on your prompt, so that you know which cluster will receive the commands you&rsquo;re typing. Otherwise, you could end up deploying workloads to your management cluster or trying to send Cluster API manifests to a workload cluster. <a href="https://github.com/justjanne/powerline-go"><code>powerline-go</code></a> is a great option, in my opinion.</p>
<p>You should now be all set to access your new Cluster API-managed workload cluster. If you have questions, feel free to reach out <a href="https://twitter.com/scott_lowe">to me on Twitter</a>, or contact me on <a href="https://kubernetes.slack.com">the Kubernetes Slack instance</a>. Enjoy!</p>

  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/kubernetes">Kubernetes</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/capi">CAPI</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2020/02/18/setting-up-k8s-on-aws-kubeadm-manual-certificate-distribution/">Setting up K8s on AWS with Kubeadm and Manual Certificate Distribution</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2020/02/27/region-endpoint-match-in-aws-api-requests/">Region and Endpoint Match in AWS API Requests</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2020%2f02%2f19%2fretrieving-kubeconfig-cluster-api-workload-cluster%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2020%2f02%2f19%2fretrieving-kubeconfig-cluster-api-workload-cluster%2f&text=Retrieving%20the%20Kubeconfig%20for%20a%20Cluster%20API%20Workload%20Cluster" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2020%2f02%2f19%2fretrieving-kubeconfig-cluster-api-workload-cluster%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2019/11/12/using-kustomize-with-cluster-api-manifests/">Using Kustomize with Cluster API Manifests</a> <span class="post-date-list">129 May 121212</span></li><li><a href="/2019/08/27/bootstrapping-a-kubernetes-cluster-on-aws-with-clusterapi/">Bootstrapping a Kubernetes Cluster on AWS with Cluster API</a> <span class="post-date-list">279 May 272727</span></li><li><a href="/2020/02/18/setting-up-k8s-on-aws-kubeadm-manual-certificate-distribution/">Setting up K8s on AWS with Kubeadm and Manual Certificate Distribution</a> <span class="post-date-list">189 May 181818</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
