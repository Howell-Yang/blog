<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Creating an AWS Security Group using Pulumi and Go - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Creating an AWS Security Group using Pulumi and Go - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Creating an AWS Security Group using Pulumi and Go - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2020/07/01/creating-aws-security-group-using-pulumi-and-go/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Creating an AWS Security Group using Pulumi and Go</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 19 May 1011 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;607 words (estimated 3 minutes to read)</span>
  <p>In this post, I&rsquo;m going to share some examples of how to create an AWS security group using <a href="https://www.pulumi.com/">Pulumi</a> and <a href="https://golang.org/">Go</a>. I&rsquo;m sharing these examples because&mdash;as of this writing&mdash;the Pulumi site does not provide any examples on how this is done using Go. There <em>are</em> examples for the other languages supported by Pulumi, but not for Go. The syntax is, to me at least, somewhat counterintuitive, although I freely admit this could be due to the fact that I am still pretty new to Go and its syntax.</p>
<p>As a framework for providing these examples, I&rsquo;ll use the scenario that I need to create two different security groups. The first security group will allow SSH traffic from the Internet to designated bastion hosts. The second security group will need to allow SSH from those bastion hosts, as well as allow all traffic between/among members of the security group. Between these two groups, I should be able to show enough examples to cover most of the different use cases you&rsquo;ll run into.</p>
<p>Although no example was present for Go when I wrote this article, readers may still find <a href="https://www.pulumi.com/docs/reference/pkg/aws/ec2/securitygroup/">the API reference for the SecurityGroup resource</a> to be useful nevertheless.</p>
<p>First, let&rsquo;s look at the security group to allow SSH traffic to the bastion hosts. Here&rsquo;s a snippet of Go code that will create the desired group:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">sshSecGrp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">NewSecurityGroup</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;ssh-sg&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">SecurityGroupArgs</span>{
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span>:        <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;ssh-sg&#34;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">VpcId</span>:       <span style="color:#a6e22e">vpc</span>.<span style="color:#a6e22e">ID</span>(),
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Description</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;Allows SSH traffic to bastion hosts&#34;</span>),
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Ingress</span>: <span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">SecurityGroupIngressArray</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">SecurityGroupIngressArgs</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Protocol</span>:    <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ToPort</span>:      <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">22</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">FromPort</span>:    <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">22</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Description</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;Allow inbound TCP 22&#34;</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">CidrBlocks</span>:  <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">StringArray</span>{<span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>)},
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Egress</span>: <span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">SecurityGroupEgressArray</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">SecurityGroupEgressArgs</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Protocol</span>:    <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;-1&#34;</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ToPort</span>:      <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">FromPort</span>:    <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Description</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;Allow all outbound traffic&#34;</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">CidrBlocks</span>:  <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">StringArray</span>{<span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>)},
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>The tricky part, for me, was the syntax around the use of <code>ec2.SecurityGroupIngressArray</code> followed by <code>ec2.SecurityGroupIngressArgs</code> (although, in retrospect, I shouldn&rsquo;t have been thrown off by this since it follows the same pattern Pulumi uses elsewhere). The <code>CidrBlocks</code> parameter is an array (hence the use of <code>pulumi.StringArray</code>) with a single entry.</p>
<p>Now let&rsquo;s look at the second security group. This example will demonstrate multiple ingress rules, the use of the <code>Self</code> parameter, and referencing a separate security group as a source:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">nodeSecGrp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">NewSecurityGroup</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;node-sg&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">SecurityGroupArgs</span>{
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Name</span>:        <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;node-sg&#34;</span>),
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">VpcId</span>:       <span style="color:#a6e22e">vpc</span>.<span style="color:#a6e22e">ID</span>(),
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Description</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;Allows traffic between and among nodes&#34;</span>),
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Ingress</span>: <span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">SecurityGroupIngressArray</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">SecurityGroupIngressArgs</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Protocol</span>:       <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ToPort</span>:         <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">22</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">FromPort</span>:       <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">22</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Description</span>:    <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;Allow TCP 22 from bastion hosts&#34;</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">SecurityGroups</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">StringArray</span>{<span style="color:#a6e22e">sshSecGrp</span>.<span style="color:#a6e22e">ID</span>()},
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">SecurityGroupIngressArgs</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Protocol</span>:    <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;-1&#34;</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ToPort</span>:      <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">FromPort</span>:    <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Description</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;Allow all from this security group&#34;</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Self</span>:        <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Bool</span>(<span style="color:#66d9ef">true</span>),
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Egress</span>: <span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">SecurityGroupEgressArray</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ec2</span>.<span style="color:#a6e22e">SecurityGroupEgressArgs</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Protocol</span>:    <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;-1&#34;</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ToPort</span>:      <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">FromPort</span>:    <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Description</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;Allow all outbound traffic&#34;</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">CidrBlocks</span>:  <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">StringArray</span>{<span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;0.0.0.0/0&#34;</span>)},
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>A few things stand out from this second example:</p>
<ol>
<li>To create multiple ingress rules, simply include an <code>ec2.SecurityGroupIngressArgs</code> entry for each ingress rule in the <code>ec2.SecurityGroupIngressArray</code>. I don&rsquo;t know why I thought it wouldn&rsquo;t be that simple, but it is.</li>
<li>Note the use of <code>Self: pulumi.Bool(true)</code>; this is what says the source for this ingress rule should be the security group being created.</li>
<li>To reference another security group in an ingress rule, use <code>SecurityGroups: pulumi.StringArray</code> and reference the <code>.ID()</code> of the other security group. The example above uses this to allow SSH from the security group in the first example.</li>
</ol>
<p>This is all pretty straightforward once you&rsquo;ve figured it out (isn&rsquo;t everything?), but without any good examples to help guide the way for new users like myself it can be challenging to get the point where you&rsquo;ve figured it out. Hopefully these examples will help in some small way.</p>
<p>If you have any questions, corrections, or comments, please feel free to contact <a href="https://twitter.com/scott_lowe">me on Twitter</a>, or hit me up in <a href="https://pulumi-community.slack.com/">the Pulumi community Slack</a>.</p>

  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/automation">Automation</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/aws">AWS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/go">Go</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/pulumi">Pulumi</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/security">Security</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2020/06/25/adopting-default-route-table-aws-vpc-using-pulumi-go/">Adopting the Default Route Table of an AWS VPC using Pulumi and Go</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2020/07/08/working-around-docker-desktops-outdated-kubernetes-version/">Working Around Docker Desktop&#39;s Outdated Kubernetes Version</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2020%2f07%2f01%2fcreating-aws-security-group-using-pulumi-and-go%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2020%2f07%2f01%2fcreating-aws-security-group-using-pulumi-and-go%2f&text=Creating%20an%20AWS%20Security%20Group%20using%20Pulumi%20and%20Go" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2020%2f07%2f01%2fcreating-aws-security-group-using-pulumi-and-go%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2020/06/19/technology-short-take-128/">Technology Short Take 128</a> <span class="post-date-list">199 May 191919</span></li><li><a href="/2020/04/24/technology-short-take-126/">Technology Short Take 126</a> <span class="post-date-list">249 May 242424</span></li><li><a href="/2019/06/21/technology-short-take-115/">Technology Short Take 115</a> <span class="post-date-list">219 May 212121</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
