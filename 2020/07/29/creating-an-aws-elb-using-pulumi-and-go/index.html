<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Creating an AWS ELB using Pulumi and Go - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Creating an AWS ELB using Pulumi and Go - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Creating an AWS ELB using Pulumi and Go - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2020/07/29/creating-an-aws-elb-using-pulumi-and-go/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Creating an AWS ELB using Pulumi and Go</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 299 May 292929 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;451 words (estimated 3 minutes to read)</span>
  <p>In case you hadn&rsquo;t noticed, I&rsquo;ve been on a bit of a kick with <a href="https://www.pulumi.com/">Pulumi</a> and <a href="https://golang.org/">Go</a> recently. There are two reasons for this. First, I have a number of &ldquo;learning projects&rdquo; (things that I decide I&rsquo;d like to try or test) that would benefit greatly from the use of infrastructure as code. Second, I&rsquo;ve been working on getting more familiar with Go. The idea of combining both those reasons by using Pulumi with Go seemed natural. Unfortunately, examples of using Pulumi with Go seem to be more limited than examples of using Pulumi with other languages, so in this post I&rsquo;d like to share how to create an AWS ELB using Pulumi and Go.</p>
<p>Here&rsquo;s the example code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">elb</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">elb</span>.<span style="color:#a6e22e">NewLoadBalancer</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;elb&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">elb</span>.<span style="color:#a6e22e">LoadBalancerArgs</span>{
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">NamePrefix</span>:             <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">baseName</span>),
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">CrossZoneLoadBalancing</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Bool</span>(<span style="color:#66d9ef">true</span>),
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">AvailabilityZones</span>:      <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">StringArray</span>(<span style="color:#a6e22e">azNames</span>),
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Instances</span>:              <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">StringArray</span>(<span style="color:#a6e22e">cpNodeIds</span>),
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">SecurityGroups</span>:			<span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">StringArray</span>{<span style="color:#a6e22e">elbSecGrp</span>.<span style="color:#a6e22e">ID</span>()},
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">HealthCheck</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">elb</span>.<span style="color:#a6e22e">LoadBalancerHealthCheckArgs</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">HealthyThreshold</span>:   <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">3</span>),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Interval</span>:           <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">30</span>),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Target</span>:             <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;SSL:6443&#34;</span>),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">UnhealthyThreshold</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">3</span>),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Timeout</span>:            <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">15</span>),
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Listeners</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">elb</span>.<span style="color:#a6e22e">LoadBalancerListenerArray</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">elb</span>.<span style="color:#a6e22e">LoadBalancerListenerArgs</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">InstancePort</span>:     <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">6443</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">InstanceProtocol</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;TCP&#34;</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">LbPort</span>:           <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">Int</span>(<span style="color:#ae81ff">6443</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">LbProtocol</span>:       <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;TCP&#34;</span>),
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Tags</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">StringMap</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;cp-elb-%s&#34;</span>, <span style="color:#a6e22e">baseName</span>)),
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">k8sTag</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;shared&#34;</span>),
</span></span><span style="display:flex;"><span>	},
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>You can probably infer from the code above that this example creates an ELB that listens on TCP port 6443 and forwards to instances on TCP 6443 (and is therefore most likely a load balancer for the control plane of a Kubernetes cluster). Not shown above is the error handling code that would check <code>err</code> for a return error.</p>
<p>My use of <code>pulumi.StringArray</code> for the &ldquo;AvailabilityZones&rdquo; and &ldquo;Instances&rdquo; parameters is one way to do it; both <code>azNames</code> and <code>cpNodeIds</code> are arrays of type <code>[]pulumi.StringInput</code>. I took the approach above since I&rsquo;m collecting information about the various AZs in the <code>azNames</code> array using code described <a href="/2020/06/24/getting-aws-availability-zones-using-pulumi-and-go/">here</a>, and I gathered the instance IDs for a group of instances in the <code>cpNodesId</code> array.</p>
<p>You could also do something like this, if you wanted to explicitly specify values:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">AvailabilityZones</span>: <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">StringArray</span>{<span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;us-east-1&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Instances</span>:         <span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">StringArray</span>{<span style="color:#a6e22e">pulumi</span>.<span style="color:#a6e22e">String</span>(<span style="color:#e6db74">&#34;i-01234564789&#34;</span>)}
</span></span></code></pre></div><p>Note that you should probably use the &ldquo;Subnets&rdquo; argument <em>instead</em> of the &ldquo;AvailabilityZones&rdquo; argument (you can only use one or the other) if you need to attach the ELB to subnets in a particular VPC.</p>
<p>Getting the syntax for the health check and the listeners was a bit challenging until I reviewed the package documentation for each (see <a href="https://pkg.go.dev/github.com/pulumi/pulumi-aws/sdk/v2/go/aws/elb?tab=doc#LoadBalancerHealthCheckArgs">here</a> for the health check arguments and <a href="https://pkg.go.dev/github.com/pulumi/pulumi-aws/sdk/v2/go/aws/elb?tab=doc#LoadBalancerListenerArgs">here</a> for the listener arguments). I quickly realized it followed a similar pattern as the ingress and egress rules for an AWS security group (as outlined <a href="/2020/07/01/creating-aws-security-group-using-pulumi-and-go/">in this post</a>).</p>
<p>I hope this example helps. Although I&rsquo;m not a Go expert (nor am I a Pulumi expert), if you have any questions feel free to reach out to <a href="https://twitter.com/scott_lowe">me on Twitter</a>. I also do hang out in <a href="https://pulumi-community.slack.com">the Pulumi community Slack</a>, in case you&rsquo;d like to contact me there.</p>

  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/aws">AWS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/go">Go</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/pulumi">Pulumi</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2020/07/24/review-anker-powerexpand-elite-thunderbolt-3-dock/">Review: Anker PowerExpand Elite Thunderbolt 3 Dock</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2020/08/21/technology-short-take-130/">Technology Short Take 130</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2020%2f07%2f29%2fcreating-an-aws-elb-using-pulumi-and-go%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2020%2f07%2f29%2fcreating-an-aws-elb-using-pulumi-and-go%2f&text=Creating%20an%20AWS%20ELB%20using%20Pulumi%20and%20Go" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2020%2f07%2f29%2fcreating-an-aws-elb-using-pulumi-and-go%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2020/07/01/creating-aws-security-group-using-pulumi-and-go/">Creating an AWS Security Group using Pulumi and Go</a> <span class="post-date-list">19 May 1011</span></li><li><a href="/2020/06/25/adopting-default-route-table-aws-vpc-using-pulumi-go/">Adopting the Default Route Table of an AWS VPC using Pulumi and Go</a> <span class="post-date-list">259 May 252525</span></li><li><a href="/2020/06/24/getting-aws-availability-zones-using-pulumi-and-go/">Getting AWS Availability Zones using Pulumi and Go</a> <span class="post-date-list">249 May 242424</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
