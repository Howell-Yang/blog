<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Troubleshooting TLS Certificates - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Troubleshooting TLS Certificates - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Troubleshooting TLS Certificates - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2018/08/20/troubleshooting-tls-certificates/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Troubleshooting TLS Certificates</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 209 May 202020 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/education">Education</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;525 words (estimated 3 minutes to read)</span>
  <p>I was recently working on a blog post involving the use of TLS certificates for encryption and authentication, and was running into errors. I&rsquo;d checked all the &ldquo;usual suspects&rdquo;&mdash;AWS security groups, host-level firewall rules (via <code>iptables</code>), and the application configuration itself&mdash;but still couldn&rsquo;t get it to work. When I did finally find the error, I figured it was probably worth sharing the commands I used in the event others might find it helpful.</p>
<p>The error was manifesting itself in that I was able to successfully connect to the application (with TLS) on the loopback address, but not the IP address assigned to the network adapter. Using <code>ss -lnt</code>, I verified that the application was listening on all IP addresses (not just loopback), and as I mentioned earlier I had also verified that AWS security groups and host-level firewall weren&rsquo;t in play. This lead me to believe that there was something wrong with my TLS configuration.</p>
<p>Since the application&rsquo;s error message was extremely vague (and not even remotely TLS-related), I decided to try using <code>curl</code> to verify that TLS was working correctly. First I ran this command:</p>
<pre><code>curl --cacert /path/to/CA/certificate https://127.0.0.1 -v
</code></pre>
<p>After some output, <code>curl</code> reported this error:</p>
<pre><code>curl: (35) gnutls_handshake() failed: certificate is bad
</code></pre>
<p>At first, I took this to mean that something was actually wrong with the certificate, but I quickly realized this was an expected error&mdash;TLS authentication was enabled, and I hadn&rsquo;t given <code>curl</code> the correct parameters. So I tried it again, this time with the correct parameters:</p>
<pre><code>curl --cacert /path/to/CA/certificate \
--cert /path/to/client/certificate \
--key /path/to/client/certificate/key \
https://127.0.0.1 -v
</code></pre>
<p>This time the connection succeeded, and the output of the <code>curl</code> command showed that TLS encryption and authentication were in place and successful. The next step was to try it against the IP address assigned to the network adapter (where it had been failing):</p>
<pre><code>curl --cacert /path/to/CA/certificate \
--cert /path/to/client/certificate \
--key /path/to/client/certificate/key \
https://10.200.10.1 -v
</code></pre>
<p>And the output tells me, clearly, what&rsquo;s wrong:</p>
<pre><code>curl: (51) SSL: certificate subject name (ip-10-200-10-1) does not match target host name '10.200.10.1'
</code></pre>
<p>Ah, now that&rsquo;s much more informative, but unexpected&mdash;was the certificate, in fact, not configured correctly? Fortunately, it was relatively easy to double-check:</p>
<pre><code>openssl x509 -in /path/to/server/certificate -text
</code></pre>
<p>Clearly noted in the output under the &ldquo;X509v3 Extensions&rdquo; section is the answer:</p>
<pre><code>X509v3 Subject Alternative Name:
    DNS:ip-10-200-10-1, DNS:localhost, IP Address:127.0.0.1, IP Address:0:0:0:0:0:0:0:1
</code></pre>
<p>Sure enough, the certificate was missing a Subject Alternative Name (SAN) for the network adapter&rsquo;s IP address, and that was enough to cause the application (rightfully so) to fail.</p>
<p>So what are the takeaways? Well, they might be simplistic, but here&rsquo;s what I learned:</p>
<ul>
<li>Use <code>curl -v</code> to get more verbose information on SSL/TLS connections, especially when the application&rsquo;s error messages aren&rsquo;t very informative.</li>
<li>Use <code>openssl x509</code> to view certificate details so that you can verify that the certificate is configured correctly and has the right properties (not just SANs but also Extended Key Usage would be another area&mdash;is the certificate actually enabled for client authentication, for example).</li>
</ul>
<p>These takeaways may be &ldquo;common knowledge&rdquo; for a fair number of folks, but I suspect there&rsquo;s a few readers that will probably find this information handy.</p>

  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ssl">SSL</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2018/08/17/technology-short-take-103/">Technology Short Take 103</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2018/08/21/bootstrapping-etcd-cluster-with-tls-using-kubeadm/">Bootstrapping an etcd Cluster with TLS using Kubeadm</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2018%2f08%2f20%2ftroubleshooting-tls-certificates%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2018%2f08%2f20%2ftroubleshooting-tls-certificates%2f&text=Troubleshooting%20TLS%20Certificates" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2018%2f08%2f20%2ftroubleshooting-tls-certificates%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2017/02/03/technology-short-take-77/">Technology Short Take #77</a> <span class="post-date-list">39 May 3033</span></li><li><a href="/2014/10/08/technology-short-take-45/">Technology Short Take #45</a> <span class="post-date-list">89 May 8088</span></li><li><a href="/2018/07/19/cloning-all-repositories-in-a-github-organization/">Cloning All Repositories in a GitHub Organization</a> <span class="post-date-list">199 May 191919</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
