<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Exploring RHEL-OVS Integrations - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Exploring RHEL-OVS Integrations - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Exploring RHEL-OVS Integrations - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2013/02/07/exploring-rhel-ovs-integrations/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Exploring RHEL-OVS Integrations</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 79 May 7077 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;770 words (estimated 4 minutes to read)</span>
  <p>In this post, I&rsquo;m going to explore some integrations between Red Hat Enterprise Linux (RHEL)/RHEL variants and Open vSwitch (OVS). This post will lay the foundation for a future post describing OVS automation using Puppet.</p>
<p>Over the past few weeks, I&rsquo;ve been rebuilding my home lab to focus on some core projects/technologies for the upcoming year (more on that <a href="/2013/02/07/looking-ahead-my-2013-projects/">in this post</a>). As part of the rebuild effort, I&rsquo;ve rebuilt my hosts to run CentOS 6.3 x64, KVM, Libvirt, GlusterFS, and OVS, and have crafted Puppet code to help install (and configure, in some cases) most of these components. This post, as with some others, is an offshoot of the lab rebuild work.</p>
<p>(In case you were wondering, the other posts that have come out of the home lab rebuild project include <a href="/2013/01/16/building-libvirt-1-0-1-rpms-for-centos-6-3/">building Libvirt RPMs</a>, <a href="/2013/01/22/using-mock-to-build-sanlock-2-4-rpms-for-centos-6-3/">using Mock to build Sanlock RPMs</a>, <a href="/2013/01/22/using-mock-to-build-libssh2-1-4-1-rpms-for-centos-6-3/">using Mock to build libssh2 RPMs</a>, <a href="/2013/01/22/using-mock-to-build-libvirt-1-0-1-rpms-for-centos-6-3/">using Mock to build Libvirt RPMs</a>, and <a href="/2013/01/29/puppet-user-accounts-and-configuration-files/">using Puppet for user accounts and configuration files</a>. I&rsquo;m sure there will be more.)</p>
<p>The information in this post will build upon some base OVS knowledge, so if you aren&rsquo;t familiar with OVS, then you might want to go back and read some of my earlier OVS posts (these will at least get you started):</p>
<p><a href="/2012/10/04/some-insight-into-open-vswitch-configuration/">Some Insight into Open vSwitch Configuration</a></p>
<p><a href="/2012/10/19/link-aggregation-and-lacp-with-open-vswitch/">Link Aggregation and LACP with Open vSwitch</a></p>
<p><a href="/2012/10/19/vlans-with-open-vswitch-fake-bridges/">VLANs with Open vSwitch Fake Bridges</a></p>
<p><a href="/2012/10/30/running-host-management-on-open-vswitch/">Running Host Management on Open vSwitch</a></p>
<p><a href="/2012/10/31/layer-3-routing-with-open-vswitch/">Layer 3 Routing with Open vSwitch</a></p>
<p>Finally, before we get into the real meat of the information, I&rsquo;d like to point out that the information in this post builds upon the information already included in the OVS documentation (see the <code>README.RHEL</code> file in the distribution tarball). I&rsquo;m merely attempting to provide some additional context and examples on how these can be used.</p>
<p>Now that the preliminaries are out of the way&hellip;</p>
<p>The basic gist of the RHEL-OVS integration is support for the use of the scripts in <code>/etc/sysconfig/network-scripts</code> to do some configuration of OVS itself. For example, creating bridges, establishing bonds, configuring internal ports&mdash;all these tasks can be done using an <code>ifcfg-&lt;name&gt;</code> script.</p>
<p>Let&rsquo;s start with a very basic example. Let&rsquo;s say that you want to create a single OVS bridge named <code>ovsbr0</code>. To do that, you&rsquo;d create a file named <code>ifcfg-ovsbr0</code> in the <code>/etc/sysconfig/network-scripts</code> directory, and make the contents look like this:</p>
<pre><code>DEVICE=&quot;ovsbr0&quot;
ONBOOT=&quot;yes&quot;
DEVICETYPE=&quot;ovs&quot;
TYPE=&quot;OVSBridge&quot;
BOOTPROTO=&quot;none&quot;
HOTPLUG=&quot;no&quot;
</code></pre>
<p>Now let&rsquo;s say that you want to create a link aggregate on that bridge. To create a link aggregate on <code>ovsbr0</code> (the bridge you just created), create a file named <code>ifcfg-bond0</code> in the same directory, and make its contents look like this:</p>
<pre><code>DEVICE=&quot;bond0&quot;
ONBOOT=&quot;yes&quot;
DEVICETYPE=&quot;ovs&quot;
TYPE=&quot;OVSBond&quot;
OVS_BRIDGE=&quot;ovsbr0&quot;
BOOTPROTO=&quot;none&quot;
BOND_IFACES=&quot;eth0 eth1&quot;
OVS_OPTIONS=&quot;bond_mode=balance-tcp lacp=active&quot;
HOTPLUG=&quot;no&quot;
</code></pre>
<p>Note that this is an LACP-enabled link aggregate, so you&rsquo;ll also have to configure your physical switch appropriately.</p>
<p>Finally, suppose that you want to create an internal interface (it will appear as a physical interface to Linux, but is hosted on OVS) across which you can run your management traffic. No problem! Just create a file named <code>ifcfg-mgmt0</code> and make the contents of the file look like this:</p>
<pre><code>DEVICE=&quot;mgmt0&quot;
BOOTPROTO=&quot;static&quot;
ONBOOT=&quot;yes&quot;
DEVICETYPE=&quot;ovs&quot;
TYPE=&quot;OVSIntPort&quot;
IPADDR=10.11.12.13
NETMASK=255.255.255.0
OVS_BRIDGE=&quot;ovsbr0&quot;
HOTPLUG=&quot;no&quot;
</code></pre>
<p>Each of these scripts will create the corresponding structures/configurations within OVS. <strong>There is a drawback, however.</strong> In order for these changes to take effect, you must restart the network (perform a <code>service network restart</code>). This doesn&rsquo;t appear to be an OVS limitation of any sort; if you&rsquo;ve read any of the other OVS posts, you know that you can make these changes live via the <code>ovs-vsctl</code> command. Instead, it simply appears to be a limitation of the fact that these scripts are only evaluated during a network stop/start event.</p>
<p>Once these scripts have been evaluated, though, you should end up with a configuration that looks something like this (UUIDs have been changed to protect the innocent):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>542de17b-4eb5-4eff-f736-3c760e40dff3
</span></span><span style="display:flex;"><span>    Bridge &#34;ovsbr0&#34;
</span></span><span style="display:flex;"><span>        Port &#34;mgmt0&#34;
</span></span><span style="display:flex;"><span>            Interface &#34;mgmt0&#34;
</span></span><span style="display:flex;"><span>                type: internal
</span></span><span style="display:flex;"><span>        Port &#34;ovsbr0&#34;
</span></span><span style="display:flex;"><span>            Interface &#34;ovsbr0&#34;
</span></span><span style="display:flex;"><span>                type: internal
</span></span><span style="display:flex;"><span>        Port &#34;bond0&#34;
</span></span><span style="display:flex;"><span>            Interface &#34;eth0&#34;
</span></span><span style="display:flex;"><span>            Interface &#34;eth1&#34;
</span></span><span style="display:flex;"><span>    ovs_version: &#34;1.7.1&#34;
</span></span></code></pre></div><p>Given the limitation, I can imagine that a natural question to ask would be, &ldquo;Why use this integration, which requires a network restart, when you could just make the configuration changes yourself?&rdquo; Excellent question. I see this as a way of establishing a &ldquo;baseline&rdquo; configuration for OVS, upon which you could (dynamically) add all the other configurations you need. In addition, because the base OVS configuration exists as a set of files, this opens up some other interesting possibilities. I&rsquo;ll explore those possibilities in a future post.</p>
<p>As always, courteous comments are welcome, so feel free to add your questions, thoughts, corrections, or clarifications in the comments below.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ovs">OVS</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2013/02/07/looking-ahead-my-2013-projects/">Looking Ahead: My 2013 Projects</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2013/02/08/modifying-virtual-user-resources-in-puppet/">Modifying Virtual User Resources in Puppet</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2013%2f02%2f07%2fexploring-rhel-ovs-integrations%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f02%2f07%2fexploring-rhel-ovs-integrations%2f&text=Exploring%20RHEL-OVS%20Integrations" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f02%2f07%2fexploring-rhel-ovs-integrations%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2013/01/07/looking-back-2012-project-report-card/">Looking Back: 2012 Project Report Card</a> <span class="post-date-list">79 May 7077</span></li><li><a href="/2012/11/27/connecting-ovs-bridges-with-patch-ports/">Connecting OVS Bridges with Patch Ports</a> <span class="post-date-list">279 May 272727</span></li><li><a href="/2012/11/12/libvirt-ovs-integration-revisited/">Libvirt-OVS Integration Revisited</a> <span class="post-date-list">129 May 121212</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
