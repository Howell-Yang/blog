<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Learning NVP, Part 8: An Update on the NVP to NSX Transition - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Learning NVP, Part 8: An Update on the NVP to NSX Transition - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Learning NVP, Part 8: An Update on the NVP to NSX Transition - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2013/12/05/learning-nvp-part-8-an-update-on-the-nvp-to-nsx-transition/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Learning NVP, Part 8: An Update on the NVP to NSX Transition</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 59 May 5055 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;759 words (estimated 4 minutes to read)</span>
  <p>In <a href="/2013/11/01/learning-nvp-part-7-handling-the-nvp-to-nsx-transition/">part 7</a> of the Learning NVP series, I mentioned that I was planning to transition this series from NVP to NSX through an upgrade. I had an existing NVP installation running (all virtually) inside an OpenStack cloud, and I would just upgrade that to NSX 4.0.0. Here&rsquo;s a quick update on that plan and the NVP-to-NSX transition.</p>
<p>As I mentioned, I have an installation of NVP 3.1.1 running successfully in a nested (virtualized) environment. (Yes, it <em>is</em> possible to run all of NVP completely virtualized, though we don&rsquo;t support that for production environments.) Starting with NVP 3.1.<em>x</em>, NVP offered an &ldquo;Update Coordinator&rdquo; that coordinated and orchestrated the upgrade of the various components within an NVP domain. Since I was running NVP 3.1.1, I could just use the Update Coordinator to upgrade my installation and walk you (the readers) through the process along the way.</p>
<p>Using the Update Coordinator (which is built into NVP Manager), an NVP upgrade would typically look something like this:</p>
<ul>
<li>
<p>You&rsquo;d log into NVP Manager and go to the Update Coordinator screen.</p>
</li>
<li>
<p>If you hadn&rsquo;t already, you&rsquo;d upload the update files (appliance update files and OVS update files) to NVP Manager.</p>
</li>
<li>
<p>Once all the update files were uploaded, you&rsquo;d select the version to which you&rsquo;re upgrading and kick it off.</p>
</li>
<li>
<p>NVP Manager itself is upgraded first.</p>
</li>
<li>
<p>Next, the Update Coordinator pushes out the appliance update files (sometimes called NUB files because of their <code>.nub</code> extension) out to all the appliances (service node, gateways, and controllers).</p>
</li>
<li>
<p>Next, the non-hypervisor transport nodes are upgraded (this is the service nodes and gateways).</p>
</li>
<li>
<p>Following that, the hypervisors need to be upgraded, though this isn&rsquo;t handled by the Update Coordinator. (You could, of course, leverage a tool like Puppet or Chef or similar to help automate this process.)</p>
</li>
<li>
<p>After you&rsquo;ve verified that the hypervisors have been updated, then the Update Coordinator upgrades the controller nodes.</p>
</li>
<li>
<p>Following the successful upgrade of the controller nodes, there is a cleanup phase and then you&rsquo;re all set.</p>
</li>
</ul>
<p>This is really high-level and I&rsquo;m glossing over some details, naturally. Because an NVP upgrade is a pretty big deal&mdash;it could have an effect on the network connectivity of all the VMs and hypervisors within the NVP domain&mdash;it typically involves lots of planning, lots of testing, proper backups of all the components, and so on. However, since this was a lab environment and not a real production environment, just running through the Update Coordinator should have been fine.</p>
<p>As it turns out, though, I ran into a few problems&mdash;not problems with NVP, but problems with how I had deployed it. Basically, I didn&rsquo;t do my due diligence and <em>read the documentation.</em></p>
<p>When I first deployed the virtualized NVP appliances, I selected VMs that had a 10GB root disk. While this was enough to get NVP up and running, it turns out that it is <strong>not enough space to perform an upgrade</strong>. Specifically, it&rsquo;s not enough space to do an upgrade on the controllers; the transport nodes upgraded successfully. After the installation of the controllers, I was left with only a couple gigabytes of free space remaining. A fair portion of that is taken up then by the appliance update file, and this did not leave enough to actually perform the controller software upgrade.</p>
<p>Unfortunately, there was no easy workaround. Because the NVP controller cluster is scale out and highly available, I could have taken the controllers out (one at a time), rebuilt them with more disk space, and then re-joined the cluster&mdash;a rolling upgrade, if you will. However, because NVP 3.1.1 is a much older build of NVP, it wasn&rsquo;t possible to rebuild the controllers with a matching software version (not easily, anyway).</p>
<p>So, long story short: instead of wasting cycles trying to fix a deployment issue that is completely my fault (and, by the way, completely documented&mdash;had I paid closer attention to the documentation I wouldn&rsquo;t find myself in this position), I&rsquo;m simply going to rebuild my lab environment from scratch using NSX 4.0.0. I had really hoped to be able to walk you through the upgrade process, but sadly it just doesn&rsquo;t make sense to do so.</p>
<p>This will be the last post titled &ldquo;Learning NVP&rdquo;; moving forward, all future posts will be titled &ldquo;Learning NSX.&rdquo; The next post will discuss adding a gateway service to a logical network; this builds on information from <a href="/2013/09/06/learning-nvp-part-5-creating-a-logical-network/">part 5 (creating a logical network)</a> and <a href="/2013/10/28/learning-nvp-part-6-adding-an-nvp-gateway/">part 6 (adding a gateway appliance)</a>.</p>
<p>As always, your feedback is welcome and encouraged, so feel free to speak up in the comments below.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nsx">NSX</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nvp">NVP</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2013/12/04/divorcing-google/">Divorcing Google</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2013/12/06/technology-short-take-37/">Technology Short Take #37</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2013%2f12%2f05%2flearning-nvp-part-8-an-update-on-the-nvp-to-nsx-transition%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f12%2f05%2flearning-nvp-part-8-an-update-on-the-nvp-to-nsx-transition%2f&text=Learning%20NVP%2c%20Part%208%3a%20An%20Update%20on%20the%20NVP%20to%20NSX%20Transition" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f12%2f05%2flearning-nvp-part-8-an-update-on-the-nvp-to-nsx-transition%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2013/11/01/learning-nvp-part-7-handling-the-nvp-to-nsx-transition/">Learning NVP, Part 7: Handling the NVP to NSX Transition</a> <span class="post-date-list">19 May 1011</span></li><li><a href="/2013/10/28/learning-nvp-part-6-adding-an-nvp-gateway/">Learning NVP, Part 6: Adding an NVP Gateway</a> <span class="post-date-list">289 May 282828</span></li><li><a href="/2013/10/23/technology-short-take-36/">Technology Short Take #36</a> <span class="post-date-list">239 May 232323</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
