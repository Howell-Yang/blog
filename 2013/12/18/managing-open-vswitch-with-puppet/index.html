<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Managing Open vSwitch with Puppet - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Managing Open vSwitch with Puppet - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Managing Open vSwitch with Puppet - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2013/12/18/managing-open-vswitch-with-puppet/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Managing Open vSwitch with Puppet</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 189 May 181818 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;581 words (estimated 3 minutes to read)</span>
  <p>In this post, I&rsquo;m going to show you how to manage <a href="http://openvswitch.org/">Open vSwitch (OVS)</a> using the popular open source configuration management tool <a href="http://www.puppetlabs.com/">Puppet</a>. This is not the first time I&rsquo;ve written about this topic; in the past I showed you how to <a href="/2013/02/26/automating-open-vswitch-configuration-with-puppet/">automate OVS configuration with Puppet</a> via a hack utilizing <a href="/2013/02/07/exploring-rhel-ovs-integrations/">some RHEL-OVS integrations</a>. This post, however, focuses on the use of an actual Puppet module that will manage the configuration of OVS, a much cleaner solution&mdash;in my view, at least&mdash;than leveraging the file-based integrations I discussed earlier.</p>
<p>The Puppet module I&rsquo;ll be using and discussing in this post is the L23Network module (found <a href="https://github.com/xenolog/l23network">here</a> on GitHub). This is an extremely flexible and useful module, capable of not only configuring and managing network interfaces but also capable of managing the configuration of OVS. The latter functionality&mdash;managing the configuration of OVS&mdash;will be the primary focus of this article (with one exception).</p>
<p>The L23Network module is pretty well-documented, so I won&rsquo;t bother regurgitating the documentation here. Instead, I&rsquo;ll just try to provide some specific examples, and tie those examples back to some of the various OVS configurations I&rsquo;ve shown you in earlier posts.</p>
<p>First, let&rsquo;s get &ldquo;the one exception&rdquo; I mentioned earlier out of the way. In OVS environments, you&rsquo;ll often need to bring up a physical interface without assigning that interface an IP address. For example, consider a physical interface that is providing bridged connectivity to guest domains (VMs) on an OVS bridge. You&rsquo;ll want the interface to be up, but the interface does not need an IP address. Using the L23Network module, you can accomplish that with this piece of code in your manifest:</p>
<pre><code>l23network::l3::ifconfig {'eth1': ipaddr =&gt; 'none'}
</code></pre>
<p>Now that <code>eth1</code> is up, you could create a bridge to which to attach it with this code:</p>
<pre><code>l23network::l2::bridge {'br-ex': }
</code></pre>
<p>And then you could actually attach <code>eth1</code> like this:</p>
<pre><code>l23network::l2::port {'eth1': bridge =&gt; 'br-ex'}
</code></pre>
<p>You could then provide multi-VLAN bridged connectivity to guest domains via libvirt as I explained in my post on <a href="/2012/11/07/using-vlans-with-ovs-and-libvirt/">using VLANs with libvirt and OVS</a>. (Or, if you are <a href="/2013/12/03/connecting-lxc-to-open-vswitch-using-libvirt/">using LXC with libvirt and OVS</a>, you could provide multi-VLAN bridged connectivity to containers.)</p>
<p>The L23Network module can also work with other types of interfaces, not just physical interfaces. Want to create an internal interface, perhaps to use as a tunnel endpoint for GRE tunnel as I described <a href="/2013/05/07/using-gre-tunnels-with-open-vswitch/">here</a>? Use this snippet of Puppet code:</p>
<pre><code>l23network::l2::port {'tep0': bridge =&gt; 'br-tun', type =&gt; 'internal'}
</code></pre>
<p>You could then assign the newly-created <code>tep0</code> interface an IP address on your transport network like this:</p>
<pre><code>l23network::l3::ifconfig {'tep0': ipaddr =&gt; '10.1.1.1/24'}
</code></pre>
<p>(In theory, you could also use the L23Network module to create an internal interface so as to <a href="/2012/10/30/running-host-management-on-open-vswitch/">run host management through OVS</a>, but then you could run into issues communicating with the Puppet server over the same interfaces the Puppet server is configuring.)</p>
<p>I haven&rsquo;t yet used L23Network to create/manage patch ports or GRE ports, but the documentation indicates the module is capable of doing so. This is an area that I plan to explore in a bit more detail in the near future (in my copious free time).</p>
<p>Based on the snippets I&rsquo;ve given you above, it should be pretty straightforward how to combine these various pieces together to fully configure and manage OVS instances across a large number of systems. However, if you have any questions, feel free to post them in the comments below. I also welcome all other courteous feedback; you are encouraged to start (or join) the conversation.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/automation">Automation</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/libvirt">Libvirt</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/lxc">LXC</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ovs">OVS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/puppet">Puppet</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2013/12/17/updating-ubuntu-cloud-archive-support-with-puppet/">Updating Ubuntu Cloud Archive Support with Puppet</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2013/12/20/reducing-the-friction-training-a-spam-filter/">Reducing the Friction: Training a Spam Filter</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2013%2f12%2f18%2fmanaging-open-vswitch-with-puppet%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f12%2f18%2fmanaging-open-vswitch-with-puppet%2f&text=Managing%20Open%20vSwitch%20with%20Puppet" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f12%2f18%2fmanaging-open-vswitch-with-puppet%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2013/12/03/connecting-lxc-to-open-vswitch-using-libvirt/">Connecting LXC to Open vSwitch Using Libvirt</a> <span class="post-date-list">39 May 3033</span></li><li><a href="/2013/11/27/linux-containers-via-lxc-and-libvirt/">Linux Containers via LXC and Libvirt</a> <span class="post-date-list">279 May 272727</span></li><li><a href="/2013/10/14/installing-open-vswitch-on-ubuntu-with-puppet/">Installing Open vSwitch on Ubuntu with Puppet</a> <span class="post-date-list">149 May 141414</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
