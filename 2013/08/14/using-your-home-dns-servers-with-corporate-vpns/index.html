<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Using Your Home DNS Servers with Corporate VPNs - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Using Your Home DNS Servers with Corporate VPNs - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Using Your Home DNS Servers with Corporate VPNs - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2013/08/14/using-your-home-dns-servers-with-corporate-vpns/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Using Your Home DNS Servers with Corporate VPNs</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 149 May 141414 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;913 words (estimated 5 minutes to read)</span>
  <p>Among IT pros, it&rsquo;s quite common these days to have a home lab/home network complete with DNS, DHCP, hypervisors, storage, etc. As IT pros, it&rsquo;s also quite common to have to use a virtual private network (VPN) solution to connect back to our employers&rsquo; corporate networks in order to get work done. In this post, I&rsquo;ll show you how you can reconcile these two (sometimes conflicting) situations with a relatively little-known feature in OS X. (This post builds upon an article on this same feature that I <a href="/2006/01/04/mac-os-x-and-local-domains/">published in 2006</a>.)</p>
<p>Like many other IT pros, I have my own home network, and I use a custom domain name for that home network. Since this custom domain name doesn&rsquo;t exist outside my home network, I also have DNS servers on the home network, and I configure the systems on my home network to use these internal DNS servers via DHCP (or static assignment). No big deal, right?</p>
<p>It&rsquo;s not a big deal until it comes time to connect to the corporate network via VPN. Like many other corporate VPN solutions, my employer&rsquo;s VPN solution changes the DNS configuration on systems that connect so that these remote systems perform DNS queries via the corporate DNS servers. This is what allows access to the usual <code>server.internal.dept.company.com</code> systems, whether those are wikis, web portals, expense reporting systems, or whatever else. Clearly this is a necessary piece, as without being able to resolve internal corporate DNS queries we&rsquo;d be unable to access the systems we need to access. The unfortunate drawback is that it breaks the home DNS configuration&mdash;which means now you (typically) lose access to internal home systems.</p>
<p>Fortunately for OS X users, there is a workaround. (This workaround might also work for Linux and other BSD-derived systems; I haven&rsquo;t tested it there yet. I don&rsquo;t know of any similar functionality for Windows.)</p>
<p>The workaround involves taking advantage of what is known as multi-client support in the OS X resolver. (See <a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man5/resolver.5.html">this online copy</a> of the <code>resolver (5)</code> man page for more details.) Basically, what this means is that you have the ability to create domain-specific DNS configurations. So, you could have a &ldquo;default&rdquo; DNS configuration&mdash;this would be stored in <code>/etc/resolv.conf</code> and maintained automatically by OS X via changes in the Network panel of the System Preferences tool&mdash;as well as a series of domain-specific DNS configurations. When the DNS resolver client needs to resolve a name to an IP address, it will consult the hierarchy of domain-specific configurations, falling back to the default configuration if it doesn&rsquo;t find any matches.</p>
<p>Let&rsquo;s take a look at a specific example, and I&rsquo;ll walk you through how to configure your OS X system. For the purposes of this example, I&rsquo;ll assume that your internal home domain name is homedomain.net. As you work through these configuration steps, substitute the correct domain name as needed.</p>
<ol>
<li>
<p>Open a terminal (I use <a href="http://www.iterm2.com/#/section/home">iTerm 2</a>).</p>
</li>
<li>
<p>If your everyday user account isn&rsquo;t an administrative user (mine isn&rsquo;t), then use the <code>su</code> command to switch to an administrative user. For example, if your administrative user was named george, then you&rsquo;d use <code>su - george</code> and supply the correct password for that account.</p>
</li>
<li>
<p>Create the right directory structure with the command <code>sudo mkdir /etc/resolver</code>. You&rsquo;ll be prompted for the password of the administrative user again. This directory structure is hard-coded into the DNS resolver client, so be sure to name the directory <code>resolver</code> and ensure that it is in the <code>/etc</code> directory.</p>
</li>
<li>
<p>Create the resolver configuration for your domain name using the command <code>sudo touch /etc/resolver/homedomain.net</code>. The name of the file has to match your internal domain name, so modify it accordingly. If you ran the previous command within a couple of minutes of running this one, you won&rsquo;t be prompted for the password again.</p>
</li>
<li>
<p>Edit the resolver configuration with <code>sudo vi /etc/resolver/homedomain.net</code>. (No <code>vi</code> versus <code>nano</code> arguments here, please. Use the tool you prefer.) The contents of this document leverage standard <code>resolv.conf</code> statements, like <code>domain homedomain.net</code> and <code>nameserver 192.168.1.10</code> (substituting the appropriate domain names and DNS server addresses, naturally).</p>
</li>
<li>
<p>Save the domain-specific file and exit the editor, log out of the administrative user account, and (optionally) close your terminal window. (Personally, I almost always have a terminal window open anyway.) That&rsquo;s it&mdash;you&rsquo;re done!</p>
</li>
</ol>
<p>You can test this by logging into your corporate VPN. You&rsquo;ll note that once you&rsquo;ve logged into your corporate VPN, the values inside <code>/etc/resolv.conf</code>&ndash;which is the &ldquo;default&rdquo; DNS resolver configuration used when no domain-specific configuration file is found&mdash;will have been modified to use corporate values. However, the domain-specific file in <code>/etc/resolver</code> (whose filename matches your internal domain name&mdash;you did make sure of that, right?) will remain unchanged, and <strong>that&rsquo;s</strong> the configuration OS X will use when attempting to resolve fully-qualified domain names in your home domain. Go ahead, try it. Pretty cool, eh?</p>
<p>I use this configuration myself, and I haven&rsquo;t run into any problems with it. The one drawback I see is that the domain-specific configuration file is hard-coded, not managed by DHCP, so that could present some additional configuration overhead should the IP addresses of your internal DNS servers change. However, I think that is a reasonable trade-off for being able to easily access home network resources while connected to my corporate VPN.</p>
<p>Questions? Comments? Clarifications? Feel free to post them in the comments below, where courteous comments are not only welcome, but encouraged.</p>
<p><strong>UPDATE:</strong> Seven years later, someone has uncovered a Windows equivalent for this workaround. See <a href="http://www.patrickkremer.com/per-zone-dns-resolution-for-homelabs/">this post</a> for details.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/macos">macOS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vpn">VPN</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2013/08/12/introduction-to-networking-part-1-the-basics/">Introduction to Networking: Part 1, The Basics</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2013/08/16/learning-nvp-part-2-nvp-controllers/">Learning NVP, Part 2: NVP Controllers</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2013%2f08%2f14%2fusing-your-home-dns-servers-with-corporate-vpns%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f08%2f14%2fusing-your-home-dns-servers-with-corporate-vpns%2f&text=Using%20Your%20Home%20DNS%20Servers%20with%20Corporate%20VPNs" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f08%2f14%2fusing-your-home-dns-servers-with-corporate-vpns%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2013/06/04/technology-short-take-33/">Technology Short Take #33</a> <span class="post-date-list">49 May 4044</span></li><li><a href="/2013/04/08/technology-short-take-31/">Technology Short Take #31</a> <span class="post-date-list">89 May 8088</span></li><li><a href="/2013/01/10/technology-short-take-28/">Technology Short Take #28</a> <span class="post-date-list">109 May 101010</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
