<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Thinking Out Loud: DIY Network Virtualization? - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Thinking Out Loud: DIY Network Virtualization? - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Thinking Out Loud: DIY Network Virtualization? - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2013/08/30/thinking-out-loud-diy-network-virtualization/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Thinking Out Loud: DIY Network Virtualization?</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 309 May 303030 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/musing">Musing</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;756 words (estimated 4 minutes to read)</span>
  <p>Following on the heels of this week&rsquo;s VMware NSX announcement at VMworld 2013, I had someone contact me about a statement this person had heard. The statement claimed NSX was nothing more than a collection of tools, and that it was possible to get the equivalent of NSX using completely free (as in speech and as in beer) open source tools&mdash;specifically, <a href="http://www.netfilter.org">IPTables</a>, <a href="https://www.strongswan.org">StrongSwan</a>, <a href="http://openvpn.net/index.php/open-source.html">OpenVPN</a>, and <a href="http://openvswitch.org">Open vSwitch</a> (OVS). Basically, the statement was that it was possible to create do-it-yourself network virtualization.</p>
<p>That got me thinking: is it true? After considering it for a while, I&rsquo;d say it&rsquo;s probably possible; I&rsquo;m not enough of an expert with these specific tools to say it can&rsquo;t be done. I will say that it would likely be difficult, beyond the reach of most organizations and individuals, and would still suffer from a number of operational drawbacks. Here&rsquo;s why.</p>
<p>What are the core components of a network virtualization solution? In my view, there are at least three core components any network virtualization solution needs:</p>
<ol>
<li>
<p>Logically centralized knowledge of the network topology; this component should provide programmatic access to this information</p>
</li>
<li>
<p>Programmable edge virtual switches in the hypervisor</p>
</li>
<li>
<p>An encapsulation protocol to isolate logical networks from the physical network</p>
</li>
</ol>
<p>Let&rsquo;s compare this list with the DIY solution:</p>
<ol>
<li>
<p>I don&rsquo;t see any component that is capable of building and/or maintaining knowledge of the network topology, and certainly no way to programmatically access this information. This has some pretty serious implications, which I&rsquo;ll describe below.</p>
</li>
<li>
<p>OVS fills the need for a programmable edge virtual switch quite nicely, considering that it was expressly designed for this purpose (and is itself leveraged by NSX).</p>
</li>
<li>
<p>You could potentially leverage either StrongSwan or OpenVPN as an encapsulation protocol. Both of these solutions use encryption, so you&rsquo;d have to accept the computational overhead of using encryption within your data center for hypervisor-to-hypervisor connectivity, but OK&mdash;I suppose these count. Neither of these solutions provide any sort of way to distinguish or mark traffic inside the tunnel, which also has some implications we need to explore.</p>
</li>
</ol>
<p>OK, so the DIY solution is missing a couple of key components. What implications does this have?</p>
<ul>
<li>
<p>Without any centralized knowledge of the network topology, there is nothing to handle programming OVS. Therefore, every single change must be manually performed. Provisioning a new VM? You must manually configure OVS, OpenVPN, StrongSwan, and possibly IPTables to handle connectivity to and from that VM. Moving a VM from one host to another? That requires manual reconfiguration. Live migration? That will require manual reconfiguration. Terminating a VM? That will require manual reconfiguration.</p>
</li>
<li>
<p>Without programmatic access to the solution, it can&rsquo;t be integrated into any other sort of management framework. Want to use it with OpenStack? CloudStack? It&rsquo;s probably not going to work. Want to use it with a custom CMP you&rsquo;ve built? It <em>might</em> work, but only after extensive integration work (and a lot of scripts).</p>
</li>
<li>
<p>It&rsquo;s my understanding that both StrongSwan and OpenVPN will leverage standard IP routing technologies to direct traffic appropriately through the tunnels. What happens when you have multiple logical networks with overlapping IP address space? How will StrongSwan and/or OpenVPN respond? Because neither StrongSwan nor OpenVPN have any way of identifying or marking traffic inside the tunnel (think of VXLAN&rsquo;s 24-bit VNID or STT&rsquo;s 64-bit Context ID), how do we distinguish one tenant&rsquo;s traffic from another tenant&rsquo;s traffic? Can we even support multi-tenancy? Do we have to fall back to using VLANs?</p>
</li>
<li>
<p>Do you really want to incur the computational overhead of using encryption for all intra-DC traffic?</p>
</li>
</ul>
<p>Of course, this list doesn&rsquo;t even begin to address other operational concerns: multiple hypervisor support, support for multiple operating systems (or even multiple Linux distributions), support for physical workloads, physical top-of-rack (ToR) switch integration, high availability for various components, and the supportability of the overall solution.</p>
<p>As you can see, there are some pretty significant operational concerns there. Manual reconfiguration for just about any VM-related task? That doesn&rsquo;t sound like a very good approach. Sure, it might be <em>technically</em> feasible to build your own network virtualization solution, but what benefits does it bring to the business?</p>
<p>Granted, I&rsquo;m not an expert with some of the open source tools mentioned, so I could be wrong. If you <em>are</em> an expert with one of these tools, and I have misrepresented the functionality the tool is capable of providing, please speak up in the comments below. Likewise, if you feel I&rsquo;m incorrect in any of my conclusions, I&rsquo;d love to hear your feedback. Courteous comments are always welcome!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ipsec">IPSec</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vpn">VPN</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ovs">OVS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/oss">OSS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/tol">ToL</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2013/08/27/vmworld-2013-day-2-keynote/">VMworld 2013 Day 2 Keynote</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2013/09/03/technology-short-take-35/">Technology Short Take #35</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2013%2f08%2f30%2fthinking-out-loud-diy-network-virtualization%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f08%2f30%2fthinking-out-loud-diy-network-virtualization%2f&text=Thinking%20Out%20Loud%3a%20DIY%20Network%20Virtualization%3f" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f08%2f30%2fthinking-out-loud-diy-network-virtualization%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2012/11/12/libvirt-ovs-integration-revisited/">Libvirt-OVS Integration Revisited</a> <span class="post-date-list">129 May 121212</span></li><li><a href="/2012/11/07/using-vlans-with-ovs-and-libvirt/">Using VLANs with OVS and libvirt</a> <span class="post-date-list">79 May 7077</span></li><li><a href="/2012/10/22/wrapping-libvirt-virtual-networks-around-open-vswitch-fake-bridges/">Wrapping libvirt Virtual Networks Around Open vSwitch Fake Bridges</a> <span class="post-date-list">229 May 222222</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
