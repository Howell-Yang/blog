<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Accessing VNC Consoles of KVM Guests via SSH - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Accessing VNC Consoles of KVM Guests via SSH - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Accessing VNC Consoles of KVM Guests via SSH - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2013/08/21/accessing-vnc-consoles-of-kvm-guests-via-ssh/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Accessing VNC Consoles of KVM Guests via SSH</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 219 May 212121 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;969 words (estimated 5 minutes to read)</span>
  <p>About a year ago, I published an entry on <a href="/2012/08/21/working-with-kvm-guests/">working with KVM guests</a>, in which I described how to perform some common operations with KVM-based guest VMs (or guest domains). While reading that article today (I needed to refer back to the section on using <code>virt-install</code>), I realized that I hadn&rsquo;t discussed how to access the VNC console of a KVM guest. In this post, I&rsquo;ll show you how to use SSH to access the VNC console of a KVM guest domain.</p>
<p>Here are the tools you&rsquo;ll need to make this work:</p>
<ul>
<li>
<p>An SSH client. On OS X or Linux, this installs with the OS; on Windows, you&rsquo;ll need a client like <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty">PuTTY</a>.</p>
</li>
<li>
<p>A VNC client. There are a variety of clients out there; find one that works for you and run with it. On OS X, I use Chicken (formerly Chicken of the VNC).</p>
</li>
</ul>
<p>Basically, all we&rsquo;re going to do is use SSH port forwarding (additional information <a href="http://www.debianadmin.com/howto-use-ssh-local-and-remote-port-forwarding.html">here</a>) to connect your local system to the VNC port of the guest domain on the KVM host. At its simplest level, the generic command to do local port forwarding with SSH looks something like this:</p>
<pre><code>ssh &lt;username&gt;@&lt;remote host IP address or DNS name&gt; -L &lt;local port&gt;:&lt;remote IP address&gt;:&lt;remote port&gt;
</code></pre>
<p>The idea of local port forwarding via SSH is really well-known and well-documented all over the Internet, so I won&rsquo;t go into a great level of detail here.</p>
<p>Let&rsquo;s take the generic command above and turn it into a command that is specific to accessing the VNC console of a guest domain on a remote KVM host. Let&rsquo;s assume in this example that the IP address of the remote KVM host is 192.168.1.4, that your username on this remote KVM host is admin, and that there is only one guest domain running on the remote KVM host. To access that guest domain&rsquo;s VNC console, you&rsquo;d use this command:</p>
<pre><code>ssh admin@192.168.1.4 -L 5900:127.0.0.1:5900
</code></pre>
<p>Allow me to break this command down just a bit:</p>
<ul>
<li>
<p>The first part (<code>ssh admin@192.168.1.4</code>) simply establishes the SSH session to the remote KVM host at that IP address.</p>
</li>
<li>
<p>The <code>-L</code> parameter tells SSH we are doing local port forwarding. In other words, SSH will take traffic directed to the specified local port and send it to the specified remote port on the specified remote IP address.</p>
</li>
<li>
<p>The last part (<code>5900:127.0.0.1:5900</code>) is probably the part that will confuse folks who haven&rsquo;t done this before. The first port number indicates the local port number&mdash;that is, the port on your local system. The IP address indicates the remote IP address that will be contacted <em>via the remote host</em>, and the last port number indicates the destination port to which traffic will be directed. It&rsquo;s really important to remember that the IP address specified in the port forwarding specification will be contacted <em>through the SSH tunnel</em> as if the traffic were originating from the remote host. So, in this case, specifying 127.0.0.1 (the loopback address) here means we&rsquo;ll be accessing the remote host&rsquo;s loopback address, not our own.</p>
</li>
</ul>
<p>Once you have this connection established, you can point your VNC client at your <em>own loopback address</em>. If you select display 0 (the default on most clients), then traffic will be directed to port 5900, which will be redirected through the SSH tunnel to port 5900 on the loopback address on the remote system&mdash;which, incidentally, is where the VNC console of the guest domain is listening. <em>Voila</em>, you&rsquo;re all set.</p>
<p>Here are a few additional notes of which you&rsquo;ll want to be aware:</p>
<ul>
<li>
<p>The first guest domain launched (or started) on a host will listen on port 5900 of the KVM host&rsquo;s loopback address. (This is why we used those values in our command.) The second guest domain will listen on 5901, the third on 5902, and so forth.</p>
</li>
<li>
<p>You can use the command <code>sudo netstat -tunelp | grep LISTEN</code> to show listening ports on the KVM host; this will include listening VNC consoles. The last column in the output will be the process ID; use <code>ps ax | grep &lt;process ID&gt;</code> to figure out which VM is listening to a particular port (the name of the VM will be in the command&rsquo;s output).</p>
</li>
</ul>
<p>When you&rsquo;re accessing the guest domains on the remote KVM host directly, it&rsquo;s pretty straightforward. But what if you need to send traffic through an intermediate jump host first? For example, what if you have to SSH to the jump host first, then SSH from the jump host to the remote hypervisors&mdash;can you still access guest domain consoles in this sort of situation?</p>
<p><strong>Yes you can!</strong></p>
<p>It&rsquo;s a bit more complicated, but it&rsquo;s doable. Let&rsquo;s assume that our jump host is, quite imaginatively, called <code>jumphost.domain.com</code>, and that our hypervisor is called&mdash;you guessed it&mdash;<code>hypervisor.domain.com</code>. The following set of commands would allow you to gain access to the first guest domain on the remote hypervisor via the jump host.</p>
<p>First, run this command from your local system to the jump host:</p>
<pre><code>ssh user@jumphost.domain.com -L 5900:127.0.0.1:5900
</code></pre>
<p>Next, run this command from the jump host to the remote hypervisor:</p>
<pre><code>ssh user@hypervisor.domain.com -L 5900:127.0.0.1:5900 -g
</code></pre>
<p>The <code>-g</code> parameter is important here; I couldn&rsquo;t make it work without adding this parameter. Your mileage may vary, of course. Once you have both sets of port forwarding established, then just point your VNC client to port 5900 of your local loopback address. Traffic gets redirected to port 5900 on the jump host&rsquo;s loopback address, which is in turn redirected to port 5900 on the remote hypervisor&rsquo;s loopback address&mdash;which is where the guest domain&rsquo;s console is listening. Cool, huh? If you establish multiple sessions listening on different ports, you can access multiple VMs on multiple hypervisors. Very handy!</p>
<p>If you have any questions, corrections, or additional information to share, please feel free to speak up in the comments below.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/kvm">KVM</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ssh">SSH</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2013/08/21/state-of-devtest-infrastructure-survey/">State of Dev/Test Infrastructure Survey</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2013/08/22/learning-nvp-part-4-adding-hypervisors-to-nvp/">Learning NVP, Part 4: Adding Hypervisors to NVP</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2013%2f08%2f21%2faccessing-vnc-consoles-of-kvm-guests-via-ssh%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f08%2f21%2faccessing-vnc-consoles-of-kvm-guests-via-ssh%2f&text=Accessing%20VNC%20Consoles%20of%20KVM%20Guests%20via%20SSH" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f08%2f21%2faccessing-vnc-consoles-of-kvm-guests-via-ssh%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2013/05/07/using-gre-tunnels-with-open-vswitch/">Using GRE Tunnels with Open vSwitch</a> <span class="post-date-list">79 May 7077</span></li><li><a href="/2013/02/04/technology-short-take-29/">Technology Short Take #29</a> <span class="post-date-list">49 May 4044</span></li><li><a href="/2012/09/07/compiling-libvirt-0-10-1-on-ubuntu-12-04/">Compiling libvirt 0.10.1 on Ubuntu 12.04</a> <span class="post-date-list">79 May 7077</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
