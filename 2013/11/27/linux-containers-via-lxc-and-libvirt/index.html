<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Linux Containers via LXC and Libvirt - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Linux Containers via LXC and Libvirt - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Linux Containers via LXC and Libvirt - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2013/11/27/linux-containers-via-lxc-and-libvirt/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Linux Containers via LXC and Libvirt</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 279 May 272727 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;556 words (estimated 3 minutes to read)</span>
  <p>One of the cool things about <a href="http://libvirt.org/">libvirt</a> is the ability to work with multiple hypervisors and virtualization technologies, including Linux containers using <a href="http://linuxcontainers.org/">LXC</a>. In this post, I&rsquo;m going to show you how to use libvirt with LXC, including leveraging libvirt to help automate attaching containers to <a href="http://openvswitch.org/">Open vSwitch (OVS)</a>.</p>
<p>If you aren&rsquo;t familiar with Linux containers and LXC, I invite you to have a look at <a href="/2013/11/25/a-brief-introduction-to-linux-containers-with-lxc/">my introductory post on Linux containers and LXC</a>. It should give you enough background to make this post make sense.</p>
<p>To use libvirt with an LXC container, there are a couple of basic steps:</p>
<ol>
<li>
<p>Create the container using standard LXC user-space tools.</p>
</li>
<li>
<p>Create a libvirt XML definition for the container.</p>
</li>
<li>
<p>Define the libvirt container domain.</p>
</li>
<li>
<p>Start the libvirt container domain.</p>
</li>
</ol>
<p>The first part, creating the container, is pretty straightforward:</p>
<pre><code>lxc-create -t ubuntu -n cn-02
</code></pre>
<p>This creates a container using the Ubuntu template and calls it <code>cn-01</code>. As you may recall from <a href="/2013/11/25/a-brief-introduction-to-linux-containers-with-lxc/">my introductory LXC post</a>, this creates the container&rsquo;s configuration and root filesystem in <code>/var/lib/lxc</code> by default. (I&rsquo;m assuming you are using Ubuntu 12.04 LTS, as I am.)</p>
<p>Once you have the container created, you next need to get it into libvirt. Libvirt uses a standard XML-based format for defining VMs, containers, networks, etc. At first, I thought this might be the most difficult section, but thanks to <a href="https://wiki.ubuntu.com/SergeHallyn_libvirtlxc">this page</a> I was able to create a template XML configuration. I&rsquo;ve uploaded this template XML configuration to GitHub as a gist, which you can view <a href="https://gist.github.com/scottslowe/7647800">here</a>.</p>
<p>Simply take this XML template and save it as something like <code>lxc-template.xml</code> or similar. Then, after you&rsquo;ve created your container using <code>lxc-create</code> as above, you can easily take this template and turn it into a specific container configuration with only one command. For example, suppose you created a container named &ldquo;cn-02&rdquo; (as I did with the command I showed earlier). If you wanted to customize the XML template, just use this simple Unix/Linux command:</p>
<pre><code>sed 's/REPLACE/cn-02/g' lxc-template.xml &gt; cn-02.xml
</code></pre>
<p>Once you have a container-specific libvirt XML configuration, then defining it in libvirt is super-easy:</p>
<pre><code>virsh -c lxc:// define cn-02.xml
</code></pre>
<p>Then start the container:</p>
<pre><code>virsh -c lxc:// start cn-02
</code></pre>
<p>And connect to the container&rsquo;s console:</p>
<pre><code>virsh -c lxc:// console cn-02
</code></pre>
<p>When you&rsquo;re done with the container&rsquo;s console, press &ldquo;Ctrl-]&rdquo; (that&rsquo;s Control and right bracket at the same time); that will return you to your host.</p>
<p>Pretty handy, eh? Further, since you&rsquo;re now controlling your containers via libvirt, you can leverage libvirt&rsquo;s networking functionality as well&mdash;which means that you can easily create libvirt virtual networks backed by OVS and automatically attach containers to OVS for advanced networking configurations. You only need to create an OVS-backed virtual network like I describe in <a href="/2012/11/07/using-vlans-with-ovs-and-libvirt/">this post on VLANs with OVS and libvirt</a>.</p>
<p>I still need to do some additional investigation and testing to see how the networking configuration in the container&rsquo;s <code>config</code> file interacts with the networking configuration in the libvirt XML file. For example, how do you define multiple network interfaces? Can you control the name of the veth pairs that show up in the host? I don&rsquo;t have any answers for these questions (yet). If you know the answers, feel free to speak up in the comments!</p>
<p>All courteous feedback and interaction is welcome, so I invite you to start (or join) the discussion via the comments below.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/libvirt">Libvirt</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/lxc">LXC</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ovs">OVS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2013/11/26/lxc-open-vswitch-and-gre-tunnels/">LXC, Open vSwitch, and GRE Tunnels</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2013/11/28/happy-thanksgiving-2013/">Happy Thanksgiving 2013</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2013%2f11%2f27%2flinux-containers-via-lxc-and-libvirt%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f11%2f27%2flinux-containers-via-lxc-and-libvirt%2f&text=Linux%20Containers%20via%20LXC%20and%20Libvirt" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f11%2f27%2flinux-containers-via-lxc-and-libvirt%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2013/11/26/lxc-open-vswitch-and-gre-tunnels/">LXC, Open vSwitch, and GRE Tunnels</a> <span class="post-date-list">269 May 262626</span></li><li><a href="/2013/05/07/using-gre-tunnels-with-open-vswitch/">Using GRE Tunnels with Open vSwitch</a> <span class="post-date-list">79 May 7077</span></li><li><a href="/2012/11/12/libvirt-ovs-integration-revisited/">Libvirt-OVS Integration Revisited</a> <span class="post-date-list">129 May 121212</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
