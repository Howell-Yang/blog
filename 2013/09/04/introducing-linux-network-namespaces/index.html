<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Introducing Linux Network Namespaces - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Introducing Linux Network Namespaces - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Introducing Linux Network Namespaces - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2013/09/04/introducing-linux-network-namespaces/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Introducing Linux Network Namespaces</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 49 May 4044 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/education">Education</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;1348 words (estimated 7 minutes to read)</span>
  <p>In this post, I&rsquo;m going to introduce you to the concept of Linux network namespaces. While it might seem a bit esoteric right now, trust me that there is a reason why I&rsquo;m introducing you to network namespaces&mdash;if you, like me, are on a journey to better understand OpenStack, you&rsquo;ll almost certainly run into network namespaces again.</p>
<p>So what are network namespaces? Generally speaking, an installation of Linux shares a single set of network interfaces and routing table entries. You can modify the routing table entries using policy routing (<a href="/2013/05/29/a-quick-introduction-to-linux-policy-routing/">here&rsquo;s</a> an introduction I wrote and <a href="/2013/05/30/a-use-case-for-policy-routing-with-kvm-and-open-vswitch/">here&rsquo;s</a> a write-up on a potential use case for policy routing), but that doesn&rsquo;t fundamentally change the fact that the set of network interfaces and routing tables/entries are shared across the entire OS. Network namespaces change that fundamental assumption. With network namespaces, you can have different and separate instances of network interfaces and routing tables that operate independent of each other.</p>
<p>This concept is probably best illustrated through some examples. Along the way, I&rsquo;ll introduce a few new ideas as well. First, though, I need to provide some assumptions.</p>
<h2 id="assumptions">Assumptions</h2>
<p>Throughout these examples, I&rsquo;m using Ubuntu Server 12.04.3 LTS. Please note that support for network namespaces varies between Linux distributions; Ubuntu supports them but Red Hat doesn&rsquo;t. (I&rsquo;m not sure about Fedora. If you know, speak up in the comments.) If you&rsquo;re thinking about using network namespaces, be sure your Linux distribution includes support.</p>
<p>Further, I&rsquo;ll assume that you&rsquo;re either running as root, or that you will prepend <code>sudo</code> to the commands listed here as necessary.</p>
<h2 id="creating-and-listing-network-namespaces">Creating and Listing Network Namespaces</h2>
<p>Creating a network namespace is actually quite easy. Just use this command:</p>
<pre><code>ip netns add &lt;new namespace name&gt;
</code></pre>
<p>For example, let&rsquo;s say you wanted to create a namespace called &ldquo;blue&rdquo;. You&rsquo;d use this command:</p>
<pre><code>ip netns add blue
</code></pre>
<p>To verify that the network namespace has been created, use this command:</p>
<pre><code>ip netns list
</code></pre>
<p>You should see your network namespace listed there, ready for you to use.</p>
<h2 id="assigning-interfaces-to-network-namespaces">Assigning Interfaces to Network Namespaces</h2>
<p>Creating the network namespace is only the beginning; the next part is to assign interfaces to the namespaces, and then configure those interfaces for network connectivity. One thing that threw me off early in my exploration of network namespaces was that you couldn&rsquo;t assign physical interfaces to a namespace (see the update at the bottom of this post). How in the world were you supposed to use them, then?</p>
<p>It turns out you can only assign virtual Ethernet (veth) interfaces to a network namespace (incorrect; see the update at the end of this post). Virtual Ethernet interfaces are an interesting construct; they always come in pairs, and they are connected like a tube&mdash;whatever comes in one veth interface will come out the other peer veth interface. As a result, you can use veth interfaces to connect a network namespace to the outside world via the &ldquo;default&rdquo; or &ldquo;global&rdquo; namespace where physical interfaces exist.</p>
<p>Let&rsquo;s see how that&rsquo;s done. First, you&rsquo;d create the veth pair:</p>
<pre><code>ip link add veth0 type veth peer name veth1
</code></pre>
<p>I found a few sites that repeated this command to create <code>veth1</code> and link it to <code>veth0</code>, but my tests showed that both interfaces were created and linked automatically using this command listed above. Naturally, you could substitute other names for <code>veth0</code> and <code>veth1</code>, if you wanted.</p>
<p>You can verify that the veth pair was created using this command:</p>
<pre><code>ip link list
</code></pre>
<p>You should see a pair of veth interfaces (using the names you assigned in the command above) listed there. Right now, they both belong to the &ldquo;default&rdquo; or &ldquo;global&rdquo; namespace, along with the physical interfaces.</p>
<p>Let&rsquo;s say that you want to connect the global namespace to the blue namespace. To do that, you&rsquo;ll need to move one of the veth interfaces to the blue namespace using this command:</p>
<pre><code>ip link set veth1 netns blue
</code></pre>
<p>If you then run the <code>ip link list</code> command again, you&rsquo;ll see that the veth1 interface has disappeared from the list. It&rsquo;s now in the blue namespace, so to see it you&rsquo;d need to run this command:</p>
<pre><code>ip netns exec blue ip link list
</code></pre>
<p>Whoa! That&rsquo;s a bit of a complicated command. Let&rsquo;s break it down:</p>
<ul>
<li>
<p>The first part, <code>ip netns exec</code>, is how you execute commands in a different network namespace.</p>
</li>
<li>
<p>Next is the specific namespace in which the command should be run (in this case, the blue namespace).</p>
</li>
<li>
<p>Finally, you have the actual command to be executed in the remote namespace. In this case, you want to see the interfaces in the blue namespace, so you run <code>ip link list</code>.</p>
</li>
</ul>
<p>When you run that command, you should see a loopback interface and the veth1 interface you moved over earlier.</p>
<h2 id="configuring-interfaces-in-network-namespaces">Configuring Interfaces in Network Namespaces</h2>
<p>Now that veth1 has been moved to the blue namespace, we need to actually configure that interface. Once again, we&rsquo;ll use the <code>ip netns exec</code> command, this time to configure the veth1 interface in the blue namespace:</p>
<pre><code>ip netns exec blue ip addr add 10.1.1.1/24 dev veth1
ip netns exec blue ip link set dev veth1 up
</code></pre>
<p>As before, the format this command follows is:</p>
<pre><code>ip netns exec &lt;network namespace&gt; &lt;command to run against that namespace&gt;
</code></pre>
<p>In this case, you&rsquo;re using the <code>ip addr</code> to assign an IP address to the veth1 interface and the <code>ip link</code> command to bring that interface up.</p>
<p>Once the veth1 interface is up, you can verify that the network configuration of the blue namespace is completely separate by just using a few different commands. For example, let&rsquo;s assume that your &ldquo;global&rdquo; namespace has physical interfaces in the 172.16.1.0/24 range, and your veth1 interface is in a separate namespace and assigned something from the 10.1.1.0/24 range. You could verify how network namespaces keep the network configuration separate using these commands:</p>
<ul>
<li>
<p><code>ip addr list</code> in the global namespace will not show <em>any</em> 10.1.1.0/24-related interfaces or addresses.</p>
</li>
<li>
<p><code>ip netns exec blue ip addr list</code> will show <em>only</em> the 10.1.1.0/24-related interfaces and addresses, and will not show any interfaces or addresses from the global namespace.</p>
</li>
<li>
<p>Similarly, <code>ip route list</code> in each namespace will show different routing table entries, including different default gateways.</p>
</li>
</ul>
<h2 id="connecting-network-namespaces-to-the-physical-network">Connecting Network Namespaces to the Physical Network</h2>
<p>This part of it threw me for a while. I can&rsquo;t really explain why, but it did. Once I&rsquo;d figured it out, it was obvious. To connect a network namespace to the physical network, <em>just use a bridge.</em> In my case, I used an Open vSwitch (OVS) bridge, but a standard Linux bridge would work as well. Place one or more physical interfaces as well as one of the veth interfaces in the bridge, and&mdash;bam!&mdash;there you go. Naturally, if you had different namespaces, you&rsquo;d probably want/need to connect them to different physical networks or different VLANs on the physical network.</p>
<p>So there you go&mdash;an introduction to Linux network namespaces. It&rsquo;s quite likely I&rsquo;ll build on this content later, so while it seems a bit obscure right now just hang on to this knowledge. In the meantime, if you have questions, clarifications, or other information worth sharing with other readers, please feel free to speak up in the comments.</p>
<p><strong>UPDATE:</strong> As I discovered after publishing this post, it most certainly <em>is</em> possible to assign various types of network interfaces to network namespaces, including physical interfaces. (I&rsquo;m not sure why I ran into problems when I first wrote this post.) In any case, to assign a physical interface to a network namespace, you&rsquo;d use this command:</p>
<pre><code>ip link set dev &lt;device&gt; netns &lt;namespace&gt;
</code></pre>
<p>Sorry for the confusion!</p>
<p><strong>UPDATE 2:</strong> I&rsquo;ve removed the use of the <code>ifconfig</code> command as it&rsquo;s been deprecated. The article already mentioned that users could use <code>ip addr</code>, <code>ip link</code>, and <code>ip route</code> in its place, but this change makes it more obvious.</p>
<p><strong>UPDATE 3:</strong> A reader contacted me to point out that it&rsquo;s possible to create the veth pairs <em>and</em> assign one of the pairs to a network namespace all in one command:</p>
<pre><code>ip link add veth0 type veth peer name veth1 netns blue
</code></pre>
<p>Thanks to Rick van Rein for pointing this out!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2013/09/03/technology-short-take-35/">Technology Short Take #35</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2013/09/05/vendor-meetings-at-vmworld-2013/">Vendor Meetings at VMworld 2013</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2013%2f09%2f04%2fintroducing-linux-network-namespaces%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f09%2f04%2fintroducing-linux-network-namespaces%2f&text=Introducing%20Linux%20Network%20Namespaces" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2013%2f09%2f04%2fintroducing-linux-network-namespaces%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2013/05/29/a-quick-introduction-to-linux-policy-routing/">A Quick Introduction to Linux Policy Routing</a> <span class="post-date-list">299 May 292929</span></li><li><a href="/2013/05/07/using-gre-tunnels-with-open-vswitch/">Using GRE Tunnels with Open vSwitch</a> <span class="post-date-list">79 May 7077</span></li><li><a href="/2013/02/04/technology-short-take-29/">Technology Short Take #29</a> <span class="post-date-list">49 May 4044</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
