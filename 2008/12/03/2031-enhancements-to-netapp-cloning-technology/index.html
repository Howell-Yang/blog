<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>2031: Enhancements to NetApp Cloning Technology - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="2031: Enhancements to NetApp Cloning Technology - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="2031: Enhancements to NetApp Cloning Technology - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2008/12/03/2031-enhancements-to-netapp-cloning-technology/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">2031: Enhancements to NetApp Cloning Technology</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 39 May 3033 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/liveblog">Liveblog</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;734 words (estimated 4 minutes to read)</span>
  <p>This session provided information on enhancements to NetApp&rsquo;s cloning functionality. These enhancements are due to be released along with Data ONTAP 7.3.1, which is expected out in December. Of course, that date may shift, but that&rsquo;s the expected release timeframe.</p>
<p>The key focus of the session was new functionality that allows for Data ONTAP to clone individual files <em>without a backing Snapshot.</em> This new functionality is an extension of NetApp&rsquo;s deduplication functionality, and is enabled by changes within Data ONTAP that enable block sharing, i.e., the ability for a single block to appear in multiple files or in multiple places in the same file. The number of times these blocks appear is tracked using a reference count. The actual reference count is always 1 less than the number of times the block appears. A block which is not shared has no reference count; a block that is shared in two locations has a reference count of 1. The maximum reference count is 255, so that means a single block is allowed to be shared up to 256 times within a single FlexVol. Unfortunately, there&rsquo;s no way to view the reference count currently, as it&rsquo;s stored in the WAFL metadata.</p>
<p>As with other cloning technologies, the only space that is required is for incremental changes from the base. (There is small overhead for metadata as well.) This functionality is going to be incorporated into the FlexClone license and will likely be referred to as &ldquo;file-level FlexClone&rdquo;. I suppose that cloning volumes with be referred to as &ldquo;volume FlexClone&rdquo; or similar.</p>
<p>This functionality will be command-line driven, but only from advanced mode (must do a <code>priv set adv</code> in order to access the commands). The commands are described below.</p>
<p>To clone a file or a LUN (the command is the same in both cases):</p>
<pre><code>clone start &lt;src_path&gt; &lt;dst_path&gt; -n -l
</code></pre>
<p>To check the status of a cloning process or stop a cloning process, respectively:</p>
<pre><code>clone status  
clone stop
</code></pre>
<p>Existing commands for Snapshot-backed clones (<code>lun clone</code> or <code>vol clone</code>) will remain unchanged.</p>
<p>File-level cloning will integrate with Volume SnapMirror (VSM) without any problems; the destination will be an exact copy of the source, including clones. Not so for Qtree SnapMirror (QSM) and SnapVault, which will re-inflate the clones to full size. Users will need to run deduplication on the destination to try to regain the space. Dump/restores will work like QSM or SnapVault.</p>
<p>Now for the limitations, caveats and the gotchas:</p>
<ul>
<li>
<p>Users can&rsquo;t run single-file SnapRestore and a clone process at the same time.</p>
</li>
<li>
<p>Users can&rsquo;t clone a file or a LUN that exists only in a Snapshot. The file or LUN must exist in the active file system.</p>
</li>
<li>
<p>ACLs and streams are not cloned.</p>
</li>
<li>
<p>The <code>clone</code> command does not work in a vFiler context.</p>
</li>
<li>
<p>Users can&rsquo;t use synchronous SnapMirror with a volume that contains cloned files or LUNs.</p>
</li>
<li>
<p>Volume SnapRestore cannot run while cloning is in progress.</p>
</li>
<li>
<p>SnapDrive does not currently support this method of cloning. It&rsquo;s anticipated that SnapManager for Virtual Infrastructure (SMVI) will be the first to leverage this functionality.</p>
</li>
<li>
<p>File-level FlexClone will be available for NFS only at first. Although it&rsquo;s possible to clone data regions within a LUN, support is needed at the host level that isn&rsquo;t present today.</p>
</li>
<li>
<p>Because blocks can only be shared 256 times (within a file or across files), it&rsquo;s possible that some blocks in a clone will be full copies. This is especially true if there are lots of clones. Unfortunately, there is no easy way to monitor or check this. <code>df -s</code> can show space savings due to cloning, but that isn&rsquo;t very granular.</p>
</li>
<li>
<p>There can be a maximum of 16 outstanding clone operations per FlexVol.</p>
</li>
<li>
<p>There is a maximum of 16TB of shared data among all clones. Trying to clone more than that results in full copies.</p>
</li>
<li>
<p>The maximum volume size for being able to use cloning is the same as for deduplication.</p>
</li>
</ul>
<p>Obviously, VMware environments&mdash;VDI in particular&mdash;are a key use case for this sort of technology. (By the way, in case no one has yet connected the dots, this is the technology that I <a href="/2008/02/28/i-love-it-but-its-not-available/">discussed here</a>). To leverage this functionality, NetApp will update a tool known as the Rapid Cloning Utility (RCU; described in more detail in <a href="http://www.netapp.com/us/library/technical-reports/tr-3705.html">TR-3705</a>) to take full advantage of file-level FlexCloning after Data ONTAP 7.3.1 is released. Note that the RCU is available today, but it only uses volume-level FlexClone.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/deduplication">Deduplication</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/insight2008">Insight2008</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nas">NAS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/netapp">NetApp</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nfs">NFS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ontap">ONTAP</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/snapshots">Snapshots</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/storage">Storage</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/wafl">WAFL</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2008/12/03/searchmyvm-2-launched/">SearchMyVM 2 Launched</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2008/12/04/the-sites-first-sponsor/">The Site&#39;s First Sponsor</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2008%2f12%2f03%2f2031-enhancements-to-netapp-cloning-technology%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2008%2f12%2f03%2f2031-enhancements-to-netapp-cloning-technology%2f&text=2031%3a%20Enhancements%20to%20NetApp%20Cloning%20Technology" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2008%2f12%2f03%2f2031-enhancements-to-netapp-cloning-technology%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2008/12/02/storage-short-take-4/">Storage Short Take #4</a> <span class="post-date-list">29 May 2022</span></li><li><a href="/2008/03/31/quick-guide-to-setting-up-netapp-deduplication/">Quick Guide to Setting up NetApp Deduplication</a> <span class="post-date-list">319 May 313131</span></li><li><a href="/2008/12/02/falconstor-introduces-a-nas-interface/">FalconStor Introduces a NAS Interface</a> <span class="post-date-list">29 May 2022</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
