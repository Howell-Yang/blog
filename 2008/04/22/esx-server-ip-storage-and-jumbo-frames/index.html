<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>ESX Server, IP Storage, and Jumbo Frames - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="ESX Server, IP Storage, and Jumbo Frames - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="ESX Server, IP Storage, and Jumbo Frames - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2008/04/22/esx-server-ip-storage-and-jumbo-frames/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">ESX Server, IP Storage, and Jumbo Frames</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 229 May 222222 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;780 words (estimated 4 minutes to read)</span>
  <p>With the release of VMware Infrastructure version 3.5, VMware added support for <a href="http://en.wikipedia.org/wiki/Jumbo_frame">jumbo frames</a>. Although the <a href="http://www.vmware.com/support/vi3/doc/whatsnew_esx35_vc25.html">documentation</a> states that jumbo frames &ldquo;are not supported for NAS and iSCSI traffic&rdquo;, jumbo frames for NFS and iSCSI does actually work. Here&rsquo;s some information on getting it working.</p>
<h2 id="how-i-tested">How I Tested</h2>
<p>Keep in mind that this is not an &ldquo;officially supported&rdquo; configuration (see the section on the &ldquo;Official&rdquo; Support Statement below), so <strong><em>use at your own risk.</em></strong> I will not be held responsible if you blow up your production environment trying to make jumbo frames work.</p>
<p>Here&rsquo;s how I tested the use of jumbo frames for software iSCSI and NFS datastores:</p>
<ul>
<li>
<p>For the physical switch infrastructure, I used a Cisco Catalyst 3560G running Cisco IOS version 12.2(25)SEB4.</p>
</li>
<li>
<p>For the physical server hardware, I used a group of HP ProLiant DL385 G2 servers with dual-core AMD Opteron processors and a quad-port PCIe Intel Gigabit Ethernet NIC.</p>
</li>
<li>
<p>For the storage system, I used a NetApp FAS940 running Data ONTAP 7.2.4.</p>
</li>
</ul>
<p>The exact commands and/or procedures may be different for you depending upon the hardware and/or software versions that you&rsquo;re running in your environment. Keep that in mind.</p>
<h2 id="configuring-the-physical-switch">Configuring the Physical Switch</h2>
<p>Fortunately for me, the Cisco Catalyst 3560G does indeed support jumbo frames. (Naturally, you&rsquo;ll want to ensure that your switch supports jumbo frames.) Jumbo frames are not, however, enabled by default; they must be enabled using the following command in global configuration mode:</p>
<pre><code>system mtu jumbo 9000
</code></pre>
<p>Note that 9000 bytes seems to be the generally accepted size for jumbo frames, so that&rsquo;s what I used.</p>
<p>After running this command, <em>you must reboot the switch.</em> The change doesn&rsquo;t take effect until a reload. Fortunately, IOS reminds you of this after you enter the command. Once the switch has rebooted, you can verify the MTU setting with this command:</p>
<pre><code>show system mtu
</code></pre>
<p>This should report that the system jumbo MTU size is 9000 bytes, confirming that the switch is ready for jumbo frames. Now we&rsquo;re prepared to configure the storage system.</p>
<h2 id="configuring-the-storage-system">Configuring the Storage System</h2>
<p>Using FilerView, increasing the MTU on the appropriate network interfaces to 9000 bytes is as simple as going to Network &gt; Manage Interfaces and then clicking the Modify link for the interface to be changed. Set the &ldquo;MTU size&rdquo; to 9000 (from the default of 1500), click Apply, and you&rsquo;re ready to roll.</p>
<p>You can verify the settings in FilerView using Network &gt; Manage Interfaces &gt; Show All Interface Details, or by using the <code>ifconfig -a</code> command from a Data ONTAP command prompt.</p>
<h2 id="configuring-esx-server">Configuring ESX Server</h2>
<p>There is no GUI in VirtualCenter for configuring jumbo frames; all of the configuration must be done from a command line on the ESX server itself. There are two basic steps:</p>
<ol>
<li>Configure the MTU on the vSwitch.</li>
<li>Create a VMkernel interface with the correct MTU.</li>
</ol>
<p>First, we need to set the MTU for the vSwitch. This is pretty easily accomplished using esxcfg-vswitch:</p>
<pre><code>esxcfg-vswitch -m 9000 vSwitch1
</code></pre>
<p>A quick run of <code>esxcfg-vswitch -l</code> (that&rsquo;s a lowercase L) will show the vSwitch&rsquo;s MTU is now 9000; in addition, <code>esxcfg-nics -l</code> (again, a lowercase L) will show the MTU for the NICs linked to that vSwitch are now set to 9000 as well.</p>
<p>Second, we need to create a VMkernel interface. This step is a bit more complicated, because we need to have a port group in place already, and that port group needs to be on the vSwitch whose MTU we set previously:</p>
<pre><code>esxcfg-vmknic -a -i 172.16.1.1 -n 255.255.0.0 -m 9000 IPStorage
</code></pre>
<p>This creates a port group called IPStorage on vSwitch1&ndash;the vSwitch whose MTU was previously set to 9000&ndash;and then creates a VMkernel port with an MTU of 9000 on that port group. Be sure to use an IP address that is appropriate for your network when creating the VMkernel interface.</p>
<p>To test that everything is working so far, use the <code>vmkping</code> command:</p>
<pre><code>vmkping -s 9000 172.16.1.200
</code></pre>
<p>Clearly, you&rsquo;ll want to substitute the IP address of your storage system in that command.</p>
<p>That&rsquo;s it! From here you should be able to easily add an NFS datastore or connect to an iSCSI LUN using jumbo frames from the ESX server.</p>
<h2 id="official-support-statement">&ldquo;Official&rdquo; Support Statement</h2>
<p>Officially, jumbo frames are only supported by VMware for use by virtual machines. Technically, VMware does not support the use of jumbo frames for the software iSCSI initiator or for use with NFS datastores. At least, that&rsquo;s my understanding.</p>
<p>So, feel free to tinker around with jumbo frames for IP-based storage, and when VMware adds official support for it in the future&mdash;I can&rsquo;t imagine why they wouldn&rsquo;t&mdash;then you&rsquo;ll be able to hit the ground running with the configuration steps necessary to make it work.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/esx">ESX</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/iscsi">iSCSI</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/netapp">NetApp</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nfs">NFS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/storage">Storage</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2008/04/20/netapp-blog-aggregator/">NetApp Blog Aggregator?</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2008/04/22/stolen-content/">Stolen Content</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2008%2f04%2f22%2fesx-server-ip-storage-and-jumbo-frames%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2008%2f04%2f22%2fesx-server-ip-storage-and-jumbo-frames%2f&text=ESX%20Server%2c%20IP%20Storage%2c%20and%20Jumbo%20Frames" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2008%2f04%2f22%2fesx-server-ip-storage-and-jumbo-frames%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2007/10/08/full-vm-recovery-with-netapp-snapshots/">Full VM Recovery with NetApp Snapshots</a> <span class="post-date-list">89 May 8088</span></li><li><a href="/2008/04/09/keeping-thin-vmdks-using-netapp-snaprestore/">Keeping Thin VMDKs Using NetApp SnapRestore</a> <span class="post-date-list">99 May 9099</span></li><li><a href="/2007/10/08/vm-file-level-recovery-with-netapp-snapshots/">VM File-Level Recovery with NetApp Snapshots</a> <span class="post-date-list">89 May 8088</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
