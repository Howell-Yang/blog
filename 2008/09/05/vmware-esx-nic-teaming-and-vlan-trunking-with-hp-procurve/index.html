<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>VMware ESX, NIC Teaming, and VLAN Trunking with HP ProCurve - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="VMware ESX, NIC Teaming, and VLAN Trunking with HP ProCurve - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="VMware ESX, NIC Teaming, and VLAN Trunking with HP ProCurve - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2008/09/05/vmware-esx-nic-teaming-and-vlan-trunking-with-hp-procurve/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">VMware ESX, NIC Teaming, and VLAN Trunking with HP ProCurve</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 59 May 5055 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;767 words (estimated 4 minutes to read)</span>
  <p>In an earlier article about <a href="/2006/12/04/esx-server-nic-teaming-and-vlan-trunking/">VMware ESX, NIC teaming, and VLAN trunking</a>, I described what the configuration should look like if one were using these features with Cisco switch hardware. It&rsquo;s been a quite popular post, one I will probably need to update soon.</p>
<p>In this article, I&rsquo;d like to discuss how to do the same thing, but using HP ProCurve switch hardware. The article is broken into three sections: using VLANs, using link aggregation (NIC teaming), and using both together.</p>
<h2 id="using-vlan-trunking">Using VLAN Trunking</h2>
<p>To my Cisco-oriented mind, VLANs with ProCurve switches are handled quite differently. Port-based VLANs, in which individual ports are assigned to one or more VLANs, allow a switch port to participate in that VLAN as either an <em>untagged</em> fashion or in a <em>tagged</em> fashion.</p>
<p>The difference here is really simpler than it may seem: the untagged VLAN can be considered the &ldquo;native VLAN&rdquo; from the Cisco world, meaning that the VLAN tags are not added to packets traversing that port. Putting a port in a VLAN in untagged mode is essentially equivalent to making that port an access port in the Cisco IOS world. Only one VLAN can be marked as untagged, which makes sense if you think about it.</p>
<p>Any port groups that should receive traffic from the untagged VLAN need to have VLAN ID 0 (no VLAN ID, in other words) assigned.</p>
<p>A tagged VLAN, on the other hand, adds the 802.1q VLAN tags to traffic moving through the port, like a VLAN trunk. If a user wants to use VST (virtual switch tagging) to host multiple VLANs on a single VMware ESX host, then the ProCurve ports need to have those VLANs marked as tagged. This will ensure that the VLAN tags are added to the packets and that VMware ESX can direct the traffic to the correct port group based on those VLAN tags.</p>
<p>In summary:</p>
<ul>
<li>
<p>Assign VLAN ID 0 to all port groups that need to receive traffic from the untagged VLAN (remember that a port can only be marked as untagged for a single VLAN). This correlates to the discussion about <a href="/2007/11/13/esx-server-and-the-native-vlan/">VMware ESX and the native VLAN</a>, in which I reminded users that port groups intended to receive traffic for the native VLAN should not have a VLAN ID specified.</p>
</li>
<li>
<p>Be sure that ports are marked as tagged for all other VLANs that VMware ESX should see. This will enable the use of VST and multiple port groups, each configured with an appropriate VLAN ID. (By the way, if users are unclear on VST vs. EST vs. VGT, see <a href="http://searchvmware.techtarget.com/tip/0,289483,sid179_gci1283036,00.html">this article</a>.)</p>
</li>
<li>
<p>VLANs that VMware ESX should not see at all should be marked as &ldquo;No&rdquo; in the VLAN configuration of the ProCurve switch for those ports.</p>
</li>
</ul>
<h2 id="using-link-aggregation">Using Link Aggregation</h2>
<p>There&rsquo;s not a whole lot to this part. In the ProCurve configuration, users will mark the ports that should participate in link aggregation as part of a trunk (say, Trk1) and then set the trunk type. Here&rsquo;s the only real gotcha: the trunk must be configured as type &ldquo;Trunk&rdquo; and not type &ldquo;LACP&rdquo;.</p>
<p>In this context, LACP refers to dynamic LACP, which allows the switch and the server to dynamically negotiate the number of links in the bundle. VMware ESX doesn&rsquo;t support dynamic LACP, only static LACP. To do static LACP, users will need to set the trunk type to Trunk.</p>
<p>Then, as has been discussed elsewhere in great depth, configure the VMware ESX vSwitch&rsquo;s load balancing policy to &ldquo;Route based on ip hash&rdquo;. Once that&rsquo;s done, everything should work as expected. This blog entry gives the <a href="/2008/09/05/setting-vmware-esx-vswitch-load-balancing-policy-via-cli/">CLI command to set the vSwitch load balancing policy</a>, which would be necessary if configuring vSwitch0. For all other vSwitches, the changes can be made via VirtualCenter.</p>
<p>That&rsquo;s really all there is to making link aggregation work between an HP ProCurve switch and VMware ESX.</p>
<h2 id="using-vlans-and-link-aggregation-together">Using VLANs and Link Aggregation Together</h2>
<p>This section exists only to point out that when a trunk is created, the VLAN configuration for the members of that trunk disappears, and the trunk must be configured directly for VLAN support. In fact, users will note that the member ports don&rsquo;t even appear in the list of ports to be configured for VLANs; only the trunks themselves appear.</p>
<p>Key point to remember: apply your VLAN configurations <em>after</em> your trunking configuration, or else you&rsquo;ll just have to do it all over again.</p>
<p>With this information, users should now be pretty well prepared to configure HP ProCurve switches in a VMware ESX environment. Feel free to post any questions, clarifications, or corrections in the comments below, and thanks for reading!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/esx">ESX</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/hardware">Hardware</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/hp">HP</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2008/09/05/setting-vmware-esx-vswitch-load-balancing-policy-via-cli/">Setting VMware ESX vSwitch Load Balancing Policy via CLI</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2008/09/05/the-new-microsoft-seinfeld-ads/">The New Microsoft-Seinfeld Ads...</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2008%2f09%2f05%2fvmware-esx-nic-teaming-and-vlan-trunking-with-hp-procurve%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2008%2f09%2f05%2fvmware-esx-nic-teaming-and-vlan-trunking-with-hp-procurve%2f&text=VMware%20ESX%2c%20NIC%20Teaming%2c%20and%20VLAN%20Trunking%20with%20HP%20ProCurve" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2008%2f09%2f05%2fvmware-esx-nic-teaming-and-vlan-trunking-with-hp-procurve%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2008/08/28/virtualization-short-take-17/">Virtualization Short Take #17</a> <span class="post-date-list">289 May 282828</span></li><li><a href="/2008/03/11/identifying-esx-server-nics-in-blades/">Identifying ESX Server NICs in Blades</a> <span class="post-date-list">119 May 111111</span></li><li><a href="/2008/01/23/new-article-on-hp-virtualconnect/">New Article on HP VirtualConnect</a> <span class="post-date-list">239 May 232323</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
