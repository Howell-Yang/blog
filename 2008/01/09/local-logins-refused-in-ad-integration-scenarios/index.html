<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Local Logins Refused in AD Integration Scenarios - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Local Logins Refused in AD Integration Scenarios - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Local Logins Refused in AD Integration Scenarios - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2008/01/09/local-logins-refused-in-ad-integration-scenarios/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Local Logins Refused in AD Integration Scenarios</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 99 May 9099 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;448 words (estimated 3 minutes to read)</span>
  <p>A customer with whom I had worked to fully integrate their ESX Server systems into Active Directory&mdash;using <a href="/2007/07/10/esx-server-ad-integration/">my instructions here</a>&mdash;had run into a problem. The problem was that local logins were refused when the Service Console lost network connectivity. Clearly, this was a problem; if the customer couldn&rsquo;t login as root when the network is down, even locally at the console, then we have problems. So I set out today to isolate and fix the problem.</p>
<p>After much trial and error, I had determined what was <em>not</em> the cause the problem:</p>
<ul>
<li>
<p>The <code>/etc/pam.d/system-auth</code> file was not at fault; we tried numerous combinations in system-auth and there was no difference in behavior</p>
</li>
<li>
<p>The <code>/etc/ldap.conf</code> file was not at fault; we even tried adding a few additional entries (like &ldquo;bind_policy soft&rdquo;) to help with issues when LDAP was down and not responding</p>
</li>
<li>
<p>A lack of DNS resolution was not the problem; the behavior was the same whether DNS was working or not</p>
</li>
</ul>
<p>Finally, I was able to track down <a href="http://osdir.com/ml/ldap.padl.nss/2006-09/msg00012.html">this thread</a> which discusses the behavior of the nss_ldap libraries when the LDAP service is not available across the network. In <a href="http://osdir.com/ml/ldap.padl.nss/2006-09/msg00014.html">this specific message</a> in the thread, it is noted that nss_ldap will try to contact LDAP to enumerate group membership, <em>even if LDAP is down.</em> So the problem was with using LDAP for group membership, and a quick edit to <code>/etc/nsswitch.conf</code> to remove LDAP from the group line proved that to be true.</p>
<p>As shown in the message, the only workarounds are:</p>
<ul>
<li>
<p>Upgrade to v245 of nss_ldap, which allows the use of the &ldquo;nss_initgroups_ignoreusers&rdquo; directive; this instructs nss_ldap to <em>not</em> perform group enumeration for the specified users; or</p>
</li>
<li>
<p>Remove the ldap entry from the group line in <code>/etc/nsswitch.conf</code>.</p>
</li>
</ul>
<p>Unfortunately, ESX Server 3.0.2 and ESX Server 3.5.0 only supply nss_ldap v207-17, which is too early to support that directive. Of course, we can&rsquo;t really upgrade the library, either, since that&rsquo;s not supported by VMware. So the only real fix for VMware ESX Server AD integration scenarios is to not use Active Directory for group memberships. User accounts can still be managed using Active Directory&mdash;and authentication occurs against Active Directory&mdash;but groups and group membership will have to be handled locally.</p>
<p>This issue is applicable to other operating systems besides ESX Server, though, and for those operating systems an upgrade of the nss_ldap library and the use of the &ldquo;nss_initgroups_ignoreuser&rdquo; directive in <code>ldap.conf</code> may be all that is needed to fix an issue with local logins being refused when network connectivity is not present.</p>
<p><strong>UPDATE:</strong> It appears that local logins will work without network connectivity, even with full Active Directory integration, if you use the Emergency Console. Thanks to Magnus for the update!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/activedirectory">ActiveDirectory</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/esx">ESX</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/interoperability">Interoperability</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/kerberos">Kerberos</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ldap">LDAP</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2008/01/08/lacp-with-cisco-switches-and-netapp-vifs/">LACP with Cisco Switches and NetApp VIFs</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2008/01/10/esx-server-301-patch-needed-for-vc-25/">ESX Server 3.0.1 Patch Needed for VC 2.5</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2008%2f01%2f09%2flocal-logins-refused-in-ad-integration-scenarios%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2008%2f01%2f09%2flocal-logins-refused-in-ad-integration-scenarios%2f&text=Local%20Logins%20Refused%20in%20AD%20Integration%20Scenarios" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2008%2f01%2f09%2flocal-logins-refused-in-ad-integration-scenarios%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2007/07/10/esx-server-ad-integration/">ESX Server-AD Integration</a> <span class="post-date-list">109 May 101010</span></li><li><a href="/2007/01/15/active-directory-integration-index/">Active Directory Integration Index</a> <span class="post-date-list">159 May 151515</span></li><li><a href="/2006/05/16/follow-up-on-esx-server-integration/">Follow Up on ESX Server Integration</a> <span class="post-date-list">169 May 161616</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
