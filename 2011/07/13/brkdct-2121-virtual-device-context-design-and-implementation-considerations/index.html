<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>BRKDCT-2121: Virtual Device Context Design and Implementation Considerations - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="BRKDCT-2121: Virtual Device Context Design and Implementation Considerations - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="BRKDCT-2121: Virtual Device Context Design and Implementation Considerations - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2011/07/13/brkdct-2121-virtual-device-context-design-and-implementation-considerations/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">BRKDCT-2121: Virtual Device Context Design and Implementation Considerations</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 139 May 131313 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/liveblog">Liveblog</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;1332 words (estimated 7 minutes to read)</span>
  <p>I joined this session late (a last minute change from the UCS VM-FEX session). This session is on VDC design considerations with the Nexus 7000, presented by Ron Fuller, CCIE #5851 (<a href="http://twitter.com/ccie5851">@ccie5851</a> on Twitter).</p>
<p>A VDC (virtual device context) is a &ldquo;superstructure&rdquo; that encapsulates (or encompasses) both VLANs and VRFs. Each VDC maintains its own VLAN table and its own VRF instances. There are some resources that are global (not dedicated to a particular VDC); these would include things like a boot image configuration. Other resources are dedicated to a VDC. This is stuff like VLANs, Layer 2 and Layer 3 ports, and IP address space. There are some shared resources, like the out-of-band (OOB) Ethernet management port.</p>
<p>VDCs are a licensed feature within NX-OS; they are part of the Advanced license. Up to 4 VDCs are supported. (Is the VDC limit a software limit, a hardware limit, or a license limit?) Note that 120 day evaluation licenses are available in NX-OS so that you can test features like VDCs, OTV, etc.</p>
<p>There was a question about the &ldquo;Enhanced L2&rdquo; license; this refers to FabricPath (see <a href="/2011/07/12/brkdct-2081-cisco-fabricpath-technology-and-design/">my FabricPath session blog</a> for more information).</p>
<p>Note that VDCs are considered PCI compliant and are FIPS 140-2 certified.</p>
<p>Even if you don&rsquo;t buy the Advanced license, you still have a VDC: the default VDC. The default VDC is where you create other VDCs, where you perform NX-OS upgrades, where Control Plane Policing (CoPP) occurs, and where resource allocation (interfaces and memory) occurs. Any non-default VDCs are fully functional (of course), and changes in the non-default VDC (which would be VDCs 2-4) only affect that VDC (with the exception of &ldquo;cascading&rdquo; impacts due to peer adjacencies, connections, etc.). Each VDC has its own discrete configuration file, discrete RBAC, discrete TACACS, discrete SNMP, etc.</p>
<p>As of NX-OS 5.1, there are now &ldquo;module-type&rdquo; modes. This parameter defines the behavior for each VDC. This allows you to specify an <code>m1</code> mode (can contain M1 modules), <code>m1-xl</code> (can only contain M1-XL modules), or <code>f1</code> mode (can contain F1 modules). You use these modes with the <code>limit-resource module-type</code> command.</p>
<p>As of NX-OS 5.2, you can define a storage VDC. The storage VDC is a &ldquo;virtual MDS&rdquo; within the Nexus 7000. The storage VDC consumes a domain ID, participates in zoning and VSANs, FC alias, IVR, fabric binding, etc. The storage VDC also provides FCoE ISLs (VE_ports) to other FCoE switches. Only a single storage VDC is allowed, it does not require the Advanced license, but does count toward the total VDC count.</p>
<p>Keep in mind that only F1 modules support FCoE; therefore, only F1 modules would be allowed in a storage VDC.</p>
<p>NX-OS has the ability to allocate resources on demand; this allows you to allocate resources to individual VDCs based on the VDC&rsquo;s specific requirements. You can also fine-tune the resource allocation.</p>
<p>Although you can assign ports on a per-VDC basis, some modules have groups of ports that share ASICs. In those instances, you have to allocate all the ports that share an ASIC. For example, the N7K-M132XP-12 has groups of 4 ports that share an ASIC; therefore, these ports have to be allocated in groups of 4. The N7K-F132XP-15 card, on the other hand, shares an ASIC for every 2 ports, so ports are allocated to VDCs in groups of 2. The N7K-M108X2-12L card can assign ports individually. All M1 48 port line cards can have their ports allocated individually, although there is a recommendation to align port allocation in groups of 12. You also cannot split a FEX between VDCs; all the ports on a FEX belong the VDC of the uplink port into the Nexus 7000.</p>
<p>How do you allocate ports to a VDC? In config mode, use the <code>vdc &lt;Name&gt;</code> command to enter a VDC, and then use the <code>allocate interface</code> command. You can also use the <code>show vdc membership</code> command to show VDC allocation.</p>
<p>Prior to NX-OS 5.2, an interface allocated to a VDC isn&rsquo;t visible from any other VDC, including the default VDC. NX-OS 5.2 enables an exception to this to enable FCoE initiators coming in on one VDC to see targets on a storage VDC by sharing interfaces between an Ethernet VDC and a storage VDC. The Nexus 7000 automatically splits traffic based on Ethertype (0x8914 and 0x8906, FIP and FCoE, are automatically redirected to the storage VDC). Shared interfaces must be on N7K-F132XP-15 modules, and the ports must be configured as a 802.1Q trunk. Use the <code>allocate shared interface</code> command to configure shared interfaces.</p>
<p>There is no soft cross-connect over the backplane to connect VDCs; all communication has to go through ports on the front panel. There are no restrictions on module types (M1 to F1, etc.) If you are using vPC or vPC+ between VDCs, make sure the domain IDs are unique. All the interfaces in a vPC peer link must come from the same module type.</p>
<p>Creating a VDC is accomplished using the <code>vdc &lt;New Name&gt;</code> command. Add <code>type storage</code> to that command to create a storage VDC (and that will automatically limit the module types as stated earlier). The show <code>vdc &lt;New Name&gt; detail</code> will give you more details about the specified VDC.</p>
<p>To navigate between VDCs, use the <code>switchto vdc &lt;Name&gt;</code> command; to switch back to the default VDC, use the <code>switchback</code> command. Use of the <code>switchto</code> command can be regulated via RBAC (which does not stand for Rogue Badger Access Control, by the way). You can only use the <code>switchto</code> command to move from the default VDC to a non-default VDC; you can&rsquo;t jump between non-default VDCs.</p>
<p>Non-default VDCs can be suspended, resumed, reloaded, or restarted. Use the <code>reload</code> command to reload a VDC; use the <code>vdc &lt;Name&gt; suspend</code> command to suspend a VDC. Reloading the default VDC reloads all VDCs.</p>
<p>Some VDC leading practices:</p>
<ul>
<li>
<p>Reserve the default VDC for administrative functions.</p>
</li>
<li>
<p>On VDC 1 assign accounts with minimum privileges necessary to perform operational tasks.</p>
</li>
<li>
<p>Use a linecard per VDC for improved HA and VDC isolation.</p>
</li>
<li>
<p>Customize VDC HA policy and resource configurations as necessary.</p>
</li>
</ul>
<p>Ron now moves on to a discussion of consolidation with VDCs. Consolidation is one of those areas where you have to consider the trade-offs between various network configurations. VDCs do enable 4:1 consolidation while still maintaining hierarchy. Naturally, there are risks (a catastrophic hardware failure will take out all the VDCs). Other considerations:</p>
<ul>
<li>
<p>VDC to forwarding engine mapping</p>
</li>
<li>
<p>A single chassis is still a single point of failure</p>
</li>
<li>
<p>MAC table sizing is bound to the &ldquo;lowest common denominator&rdquo;</p>
</li>
<li>
<p>There are a limited number of SPAN sessions</p>
</li>
</ul>
<p>Not only can you use VDCs for consolidation, you can also use VDCs for segmentation. Perhaps you want to use a pair of Nexus 7000s for core, DMZ, and Internet edge traffic. Using VDCs can make this possible. (In my mind this is just another consolidation scenario).</p>
<p>NX-OS 5.2 introduces support for MPLS, which means that each VDC can operate as a separate MPLS router (label switching router, LSR). This offers the opportunity to consolidate multiple layers of PE router and P routers.</p>
<p>VDC also works well with OTV. OTV requires an OTV edge device, and there is no universal agreement upon where the OTV edge device should be placed.  OTV does require separation of the SVI routing and the OTV encapsulation; this is ideally accomplished using VDCs instead of multiple physical appliances (including &ldquo;on-a-stick&rdquo; variations). Ron walks through several different scenarios and ways in which VDCs could be incorporated into an OTV design.</p>
<p>Next Ron shifts gears to discuss VDCs with FCoE. The use of VDCs allows us to further leverage fabric/network convergence beyond just the access layer. While it won&rsquo;t necessarily reduce the number of links between switches, it will reduce the overall number of switches and still allow us to maintain SAN A/SAN B separation, role-based access, etc.</p>
<p>The next technology Ron looks at with VDCs is FabricPath. I wasn&rsquo;t able to capture all of these information. Ron then wrapped up the session.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cisco">Cisco</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ciscolive2011">CiscoLive2011</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nexus">Nexus</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2011/07/13/announcing-mastering-vmware-vsphere-5/">Announcing Mastering VMware vSphere 5</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2011/07/14/brkdct-3060-deployment-considerations-with-interconnecting-dcs/">BRKDCT-3060: Deployment Considerations with Interconnecting DCs</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2011%2f07%2f13%2fbrkdct-2121-virtual-device-context-design-and-implementation-considerations%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2011%2f07%2f13%2fbrkdct-2121-virtual-device-context-design-and-implementation-considerations%2f&text=BRKDCT-2121%3a%20Virtual%20Device%20Context%20Design%20and%20Implementation%20Considerations" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2011%2f07%2f13%2fbrkdct-2121-virtual-device-context-design-and-implementation-considerations%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2011/07/12/brkdct-2081-cisco-fabricpath-technology-and-design/">BRKDCT-2081: Cisco FabricPath Technology and Design</a> <span class="post-date-list">129 May 121212</span></li><li><a href="/2011/07/12/brkcom-3002-network-redundancy-and-load-balancing-designs-for-ucs-blade-servers/">BRKCOM-3002: Network Redundancy and Load Balancing Designs for UCS Blade Servers</a> <span class="post-date-list">129 May 121212</span></li><li><a href="/2011/07/11/brkmpl-1101-introduction-to-mpls/">BRKMPL-1101: Introduction to MPLS</a> <span class="post-date-list">119 May 111111</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
