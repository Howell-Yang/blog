<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>BRKDCT-3060: Deployment Considerations with Interconnecting DCs - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="BRKDCT-3060: Deployment Considerations with Interconnecting DCs - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="BRKDCT-3060: Deployment Considerations with Interconnecting DCs - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2011/07/14/brkdct-3060-deployment-considerations-with-interconnecting-dcs/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">BRKDCT-3060: Deployment Considerations with Interconnecting DCs</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 149 May 141414 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/liveblog">Liveblog</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;1658 words (estimated 8 minutes to read)</span>
  <p>This is BRKDCT-3060, Deployment Considerations with Interconnecting Data Centers, presented by Patrice Bellagamba (Distinguished SE) and Max Ardica (Solution Architect). Given that my role in virtualization and storage puts me squarely in the middle of these sorts of designs, I&rsquo;m really looking forward to this session and gaining some valuable knowledge out of it.</p>
<p>The primary objectives of the session are to identify the business requirements driving DCI (Data Center Interconnect) deployments; understanding the functional components of the Cisco DCI solution; and get a full knowledge of Cisco LAN extension technologies and associated considerations. The session does NOT consider path optimization (ACE/GSS, LISP), storage extension considerations, and workload mobility application-specific considerations.</p>
<p>So what are some of the business drivers and solutions? There are several:</p>
<ul>
<li>
<p>Business continuity (disaster recovery, HA framework)</p>
</li>
<li>
<p>Operational cost containment (DC maintenance or migration)</p>
</li>
<li>
<p>Business resource optimization (disaster avoidance, workload mobility)</p>
</li>
<li>
<p>Cloud services (inter-cloud networking, _X_aaS)</p>
</li>
</ul>
<p>It is important, when extending VLANs between sites, to preserve STP domain isolation and storm control in order to keep fault domain as small as reasonably possible. A key part of a DCI model is path optimization, but that is not something that will be covered in this session.</p>
<p>In a VLAN extension environment, there are 5 different types of VLANs you might deploy in your data center:</p>
<ul>
<li>
<p>Type T0: Limited to a single access layer device</p>
</li>
<li>
<p>Type T1: Extended within an aggregation block/pod</p>
</li>
<li>
<p>Type T2: Extended between aggregation blocks/pods within a single data center site</p>
</li>
<li>
<p>Type T3: Extended between aggregation blocks/pods as part of &ldquo;twin DC sites&rdquo; (usually connected via dark fiber; think metro/synchronous distances)</p>
</li>
<li>
<p>Type T4: Extended between aggregation blocks/pods as part of remote DC sites (think geo/asynchronous distances)</p>
</li>
</ul>
<p>Note that these classifications are just for understanding the different ways VLANs are extended; this is not a configuration class or type.</p>
<p>There are three basic types of VLAN extensions: Ethernet-based, IP-based, or MPLS-based.</p>
<p>The Ethernet-based solution leverages dark fiber/DWDM connections between DCs. In this configuration, make sure to filter BPDUs on one site and enable broadcast storm control. You can leverage technologies like vPC or VSS to avoid loops and take advantage of redundant links between the DC sites. If you use vPC, you will need separate (dedicated) Layer 3 links for inter-DC routing.</p>
<p>There was a question about the distances supported for an Ethernet solution. According to Max, it&rsquo;s less about distance and more about the dark fiber/DWDM/direct fibre connectivity requirements. Up to 60km is probably a reasonable distance for this solution.</p>
<p>The Ethernet-based solution is a viable solution, but Max prefers OTV.</p>
<p>OTV is Overlay Transport Virtualization and is something I&rsquo;ve discussed on my site before. The OTV edge device (ED) is the device that performs the OTV encapsulation (MAC-in-IP encapsulation). The internal interfaces are the interfaces on the ED that face the site. The join interface is the interface of the ED that faces the core. The overlay interface is a logical entity that encapsulates the traffic.</p>
<p>Some considerations:</p>
<ul>
<li>
<p>Join interfaces and internal interfaces are only supported on M1 modules.</p>
</li>
<li>
<p>The join interface can&rsquo;t be an SVI or loopback interface, but it can be a port-channel interface or a routed physical interface (or sub-interface).</p>
</li>
</ul>
<p>There were some other considerations but I couldn&rsquo;t capture them in time.</p>
<p>OTV encapsulation adds 42 bytes to the packet IP MTU size. Be sure to keep this consideration in mind; ensure that you have the appropriate MTU size support end-to-end. The OTV control plane uses IS-IS to learn MAC address reachability information from remote OTV peers. In the current release of NX-OS, OTV requires multicast support in the transport network connecting the sites. NX-OS 5.2 will add unicast (Adjacency Server mode) support.</p>
<p>The adjacency server (or daemon) is &ldquo;just an OTV edge device&rdquo; that advertises the IP of each ED to all other EDs (in something called the OTV Neighbor List, or the oNL). All subsequent communications happen directly between EDs without going through the adjacency server/daemon.</p>
<p>By default OTV will isolate STP domains, which is an important part of any DCI solution. OTV also does not flood unknown unicast frames. OTV relies on the OTV control plane in order to ensure MAC address reachability information is in the MAC address table of edge OTV ED.</p>
<p>Some current limitations:</p>
<ul>
<li>
<p>Up to 3 sites for OTV</p>
</li>
<li>
<p>Up to 128 extended VLANs</p>
</li>
<li>
<p>12K MAC addresses</p>
</li>
</ul>
<p>In NX-OS 5.2 these values increase to 6 sites, 256 VLANs, and 16K MAC addresses.</p>
<p>Max now shifts into a discussion of OTV deployment considerations. The first topic is where to place the OTV ED.</p>
<p>One option is to deploy the OTV ED in the core. This is an easy deployment in brownfield scenarios. In this case, the L2-L3 boundary remains at aggregation. You could have core devices perform both L3 and OTV functions, or you could use separate core devices, or you could use Nexus 7000 VDCs (see <a href="/2011/07/13/brkdct-2121-virtual-device-context-design-and-implementation-considerations/">my VDC session blog</a> for more information).</p>
<p>However, Max prefers deploying OTV at the aggregation layer. This preserves &ldquo;pure&rdquo; L3 functionality at the core and is consistent with OTV&rsquo;s role as an &ldquo;overlay&rdquo; functionality.</p>
<p>Traffic on a Nexus 7000 belonging to a given VLAN can either be routed or extended, but not both. You must use dual VDCs to do both routing and OTV extension on the same Nexus 7000 physical device (either at the core or the aggregation layer).</p>
<p>Deploying OTV at the aggregation layer is recommended for greenfield deployments, but it does require Nexus 7000 at the aggregation layer.</p>
<p>A third option is to deploy OTV over dark fiber connections, much like the Ethernet-based solution described earlier. In this scenario you would not need separate L3 links as with the Ethernet-based solution. Because you are doing both routing and OTV extension at the same time, this solution would require dedicated OTV VDCs.</p>
<p>Max next covered the various scenarios of how you can actually connect the OTV VDC and L2/L3 VDCs. There are advantages and disadvantages to the various approaches: the simple appliance model uses fewer links but introduces other challenges; the most resilient model uses more links but provides faster convergence and better traffic flow.</p>
<p>Keep in mind that OTV is a pure IP encapsulation technology that does not include any L4 information (only L3 information wrapped around a MAC address), so IP hashing technologies (port-channel load balancing or ECMP hashing) won&rsquo;t spread traffic across multiple links. In a two-site scenario, only one of two links will be used&mdash;always. In a three-site design, two links can be used (depends on the hashing). Future hardware updates will allow flow-based load balancing (F2 or F3 module, perhaps).</p>
<p>Native OTV support on F-series modules is targeted for a future hardware release. Neither F1 nor F2 modules support OTV currently.</p>
<p>In the event of various failure scenarios, only failures that cause an AED (Authoritative Edge Device) re-election cause extended outages for convergence. In NX-OS 5.2, convergence will be between 5 and 30 seconds for an AED re-election. Future releases will bring those values down. Failures that do not cause AED re-election will converge in sub-second timeframes.</p>
<p>Max still recommends configuring storm control (using the <code>storm-control broadcast</code> command) on the internal interface if you are concerned about broadcast storms with OTV.</p>
<p>Now Patrice takes over to discuss MPLS-based solutions (refer to <a href="/2011/07/11/brkmpl-1101-introduction-to-mpls/">my MPLS session blog</a> for more information). There are three MPLS-based solutions: EoMPLS, A-VPLS, and H-VPLS.</p>
<p>EoMPLS is Ethernet-over-MPLS. To do this, you would use the <code>xconnect</code> command with MPLS encapsulation to create a point-to-point Ethernet over MPLS connection. In fact, a <code>show cdp neighbor</code> will show the remote port over the MPLS network.</p>
<p>This use of MPLS allows us to take advantage of all of MPLS&rsquo; features, like traffic engineering, for the traffic moving over this EoMPLS connection.</p>
<p>You can use LACP/vPC with multiple EoMPLS links.</p>
<p>You can also use MPLS over IP (using a GRE tunnel) and then create the EoMPLS pseudowires inside the GRE tunnels. (I think&mdash;this part got pretty complicated.) Because you are using GRE tunneling, you can apply an IPsec encryption profile against that tunnel to provide encryption for the EoMPLS traffic.</p>
<p>EoMPLS is point-to-point, so what about point-to-multipoint? VPLS can address this. With multiple devices connected across an MPLS core, each VSI (Virtual Switch Instance) will create multiple EoMPLS pseudowires to create a full mesh between all other VSIs.</p>
<p>There are considerations on attaching edge devices in this sort of configuration; best practices would be to make the MPLS-connected devices the STP root bridge (or avoid STP through vPC or equivalent). Patrice walks through a number of different deployment considerations and discussions of where to place the devices, but the focus of the discussion seemed to be more on VSS than A-VPLS. I&rsquo;ll need to go back and review this information again in order to get a better understanding of the material.</p>
<p>Patrice now moves on to a discussion of H-VPLS.</p>
<p>H-VPLS is more suited for service providers (SPs) or SP-like enterprises. You might see this when interconnecting provider DCs, connecting enterprise DCs to provider DCs, or in high-end enterprise DCI scenarios.</p>
<p>ICCP is Inter-Chassis Communication Protocol that is in draft status with the IETF. I&rsquo;m not clear on how this is related to vPC, vPC+ (since Patrice was talking about FabricPath), or other multi-chassis link aggregation solutions. I think the connection to H-VPLS is that you might use ICCP in connecting Layer 2 devices to the edge devices that will then be participating in the MPLS network.</p>
<p>Some terms:</p>
<ul>
<li>
<p>mLACP Multi-Chassis Link Aggregation Protocol</p>
</li>
<li>
<p>MC-LAG: Multi-Chassis Link Aggregation Group</p>
</li>
<li>
<p>DHD: Dual-homed device (customer edge)</p>
</li>
<li>
<p>DHN: Dual-home network (customer edge)</p>
</li>
</ul>
<p>Ah, here&rsquo;s the information that helps me decipher the flow of the session. A-VPLS is only for certain devices (Catalyst 6500); H-VPLS is for high-end devices (7600, ASR-9K).</p>
<p>At this point I had to leave for a meeting so I wrapped up the session blog. Patrice was in the summary section of the presentation so no new information was going to be shared.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cisco">Cisco</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ciscolive2011">CiscoLive2011</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/otv">OTV</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2011/07/13/brkdct-2121-virtual-device-context-design-and-implementation-considerations/">BRKDCT-2121: Virtual Device Context Design and Implementation Considerations</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2011/07/14/brksan-3707-advanced-san-services/">BRKSAN-3707: Advanced SAN Services</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2011%2f07%2f14%2fbrkdct-3060-deployment-considerations-with-interconnecting-dcs%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2011%2f07%2f14%2fbrkdct-3060-deployment-considerations-with-interconnecting-dcs%2f&text=BRKDCT-3060%3a%20Deployment%20Considerations%20with%20Interconnecting%20DCs" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2011%2f07%2f14%2fbrkdct-3060-deployment-considerations-with-interconnecting-dcs%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2011/07/13/brkdct-2121-virtual-device-context-design-and-implementation-considerations/">BRKDCT-2121: Virtual Device Context Design and Implementation Considerations</a> <span class="post-date-list">139 May 131313</span></li><li><a href="/2011/07/12/brkdct-2081-cisco-fabricpath-technology-and-design/">BRKDCT-2081: Cisco FabricPath Technology and Design</a> <span class="post-date-list">129 May 121212</span></li><li><a href="/2011/07/12/brkcom-3002-network-redundancy-and-load-balancing-designs-for-ucs-blade-servers/">BRKCOM-3002: Network Redundancy and Load Balancing Designs for UCS Blade Servers</a> <span class="post-date-list">129 May 121212</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
