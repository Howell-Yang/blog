<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>How to Deploy 800 Servers in 8 Hours - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="How to Deploy 800 Servers in 8 Hours - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="How to Deploy 800 Servers in 8 Hours - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2017/11/06/how-deploy-800-servers-8-hours/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">How to Deploy 800 Servers in 8 Hours</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 69 May 6066 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/liveblog">Liveblog</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;668 words (estimated 4 minutes to read)</span>
  <p>This is a liveblog of the session titled &ldquo;How to deploy 800 nodes in 8 hours automatically&rdquo;, presented by Tao Chen with T2Cloud (Tencent).</p>
<p>Chen takes a few minutes, as is customary, to provide an overview of his employer, T2cloud, before getting into the core of the session&rsquo;s content. Chen explains that the drive to deploy such a large number of servers was driven in large part by a surge in travel due to the Spring Festival travel rush, an annual event that creates high traffic load for about 40 days.</p>
<p>The &ldquo;800 servers&rdquo; count included 3 controller nodes, 117 storage nodes, and 601 compute nodes, along with some additional bare metal nodes supporting Big Data workloads. All these nodes needed to be deployed in 8 hours or less in order to allow enough time for T2cloud&rsquo;s customer, China Railway Corporation, to test and deploy applications to handle the Spring Festival travel rush.</p>
<p>To help with the deployment, T2cloud developed a &ldquo;DevOps&rdquo; platform consisting of six subsystems: CMDB, OS installation, OpenStack deployment, task management, automation testing, and health check/monitoring. Chen doesn&rsquo;t go into great deal about any of these subsystems, but the slide he shows does give away some information:</p>
<ul>
<li>The OS installation subsystem appeared to leverage IPMI and Cobbler.</li>
<li>The OpenStack deployment subsystem used Ansible (it&rsquo;s not clear if it was using OpenStack-Ansible or just Ansible with custom playbooks).</li>
</ul>
<p>Going into a bit more detail, Chen explains that the OS installation process uses PXE plus Kickstart, all glued together using Cobbler. For the 800-node deployment, T2cloud used a total of 3 Cobbler servers, running about 20 servers concurrently in each group. Each server took about 10 minutes to deploy. Chen mentions that they used Cobbler snippet to dynamically locate the target disk when deploying the operating system; this is a feature I hadn&rsquo;t heard of before, and sounds very useful (especially in large-scale environments). Chen also explains how to use Cobbler to revert to the &ldquo;old style&rdquo; of interface naming (i.e., <code>eth0</code> instead of <code>enoXXXXXX</code> or similar).</p>
<p>Coming to the OpenStack deployment portion, Chen discusses the benefits that led T2cloud to choose Ansible for deployment. T2cloud used Ansible both for <em>ad hoc</em> commands as well as with playbooks. Chen reviews some of the key components they needed in order to use playbooks: inventory, roles, modules, group variables, and host variables. (These are all pretty standard Ansible constructs.) Chen does not mention anything about the modules that T2cloud used, other than to say they are idempotent and explain what that means.</p>
<p>Chen does review some performance optimizations for Ansible:</p>
<ul>
<li>Disable the <code>gather_facts</code> function</li>
<li>Enable pipelining</li>
<li>Increase the number of forks running</li>
<li>Upgrade SSH (as necessary) and use ControlPersist</li>
</ul>
<p>Next, Chen reviews some issues and their respective solutions discovered during this deployment:</p>
<ul>
<li>The Neutron agents were down, even though the services were running; this was later determined to be an insuficient number of file descriptors for the system because RabbitMQ was using too many descriptors</li>
<li>The Cinder services failed to start, due to an maximum connection limit on the backend MySQL database(s)</li>
<li>There were a number of other limits or maximum connections that also had to be increased; Chen shows a slide listing quite a few of them</li>
</ul>
<p>This brings Chen to a discussion of the health and monitoring system, which was used before the deployment, during the deployment, and after the deployment (for different purposes in each phase, of course).</p>
<p>In closing, Chen provides some suggestions/recommendations to attendees:</p>
<ul>
<li>Do more tests to find bottlenecks.</li>
<li>Always do health checks.</li>
</ul>
<p>At this point, Chen ends the session and opens up for questions from the audience.</p>
<p>Some things I would&rsquo;ve liked to hear from Chen:</p>
<ul>
<li>How did they get inventory from Cobbler to Ansible? Was it manual, or was there an automated process?</li>
<li>Which Ansible modules did they use? If they built their own, why?</li>
<li>What tools were used in the health check/monitoring system?</li>
</ul>
<p>Without more detailed information, the session was good but not as helpful as it could have been.</p>

  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/openstack">OpenStack</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2017/11/06/ipv6-primer-for-deployments/">IPv6 Primer for Deployments</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2017/11/07/make-your-application-serverless/">Make Your Application Serverless</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2017%2f11%2f06%2fhow-deploy-800-servers-8-hours%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2017%2f11%2f06%2fhow-deploy-800-servers-8-hours%2f&text=How%20to%20Deploy%20800%20Servers%20in%208%20Hours" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2017%2f11%2f06%2fhow-deploy-800-servers-8-hours%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2017/11/06/ipv6-primer-for-deployments/">IPv6 Primer for Deployments</a> <span class="post-date-list">69 May 6066</span></li><li><a href="/2017/11/06/battle-scars-openstack-deployments/">Battle Scars from OpenStack Deployments</a> <span class="post-date-list">69 May 6066</span></li><li><a href="/2017/11/05/kubernetes-openstack-technical-details/">Kubernetes on OpenStack: The Technical Details</a> <span class="post-date-list">59 May 5055</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
