<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Liveblog: Terraform Abstractions for Safety and Power - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Liveblog: Terraform Abstractions for Safety and Power - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Liveblog: Terraform Abstractions for Safety and Power - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2017/09/19/terraform-abstractions-safety-power/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Liveblog: Terraform Abstractions for Safety and Power</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 199 May 191919 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/liveblog">Liveblog</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;732 words (estimated 4 minutes to read)</span>
  <p>This is a liveblog for the HashiConf 2017 session titled &ldquo;Terraform Abstractions for Safety and Power.&rdquo; The speaker is Calvin French-Owen, Founder and co-CTO at Segment.</p>
<p>French-Owen starts by describing Segment, and providing a quick overview of Segment&rsquo;s use of Terraform. Segment is all on AWS, and is leveraging ECS (Elastic Container Service) to schedule containers. Segment&rsquo;s journey with Terraform started about 2.5 years ago. They now have 30-50 developers interacting with Terraform weekly, and Terraform is managing tens of thousands of AWS resources.</p>
<p>Digging into the meat of the presentation, French-Owens starts by answering the question, &ldquo;Why is safety such a big deal?&rdquo; There&rsquo;s more to the puzzle than just preventing downtime. To illustrate that point, French-Owens shares some conclusions from an academic paper that explores why developers choose software programs. It turns out that to scale adoption, you must reduce the risk of adoption (developers avoid programs based on risk).</p>
<p>Naturally, French-Owens talks about how Terraform can &ldquo;feel scary&rdquo; since it&rsquo;s so easy to destroy a bunch of infrastructure with only <code>terraform destroy</code>.</p>
<p>Before moving into a discussion on how to make Terraform feel less scary, French-Owens first covers some &ldquo;Terraform nouns&rdquo; (HCL, HashiCorp Configuration Language; variables; resources; inputs and outputs; and modules). Along the way, he shows examples of these nouns so that attendees who aren&rsquo;t familiar with Terraform can understand what he&rsquo;s discussing.</p>
<p>French-Owens shows how Terraform uses <em>state</em> to be able to make the diff between your infrastructure&rsquo;s current state and the desired state (which is what happens when you run <code>terraform plan</code>). Boiling it all down, French-Owens explains that Terraform applies diffs to your infrastructure to achieve the desired configuration.</p>
<p>With this foundational information in mind, French-Owens goes on to explain how to provide safety with Terraform; specifically, how do I protect existing infrastructure and prevent Terraform from destroying it? One common approach is to use separate AWS accounts (i.e., one account for dev, one account for staging, one account for production).</p>
<p>Basic state management is important, says French-Owens. One key rule is to use remote state/remote backends. It doesn&rsquo;t matter as much which remote state you use (Terraform Enterprise, S3, Consul, etc.), it&rsquo;s more important that you just actually use remote state. French-Owens quickly runs through some advantages and disadvantages of the various remote state backends (S3, Consul, and Terraform Enterprise).</p>
<p>While remote state is important, there&rsquo;s more to state management according to French-Owens. One approach is breaking down state into &ldquo;smaller&rdquo; components, such as using different states for different services. Another approach is to use shared states grouped by team. Mastering the use of read-only remote state is also important. You can use the <code>terraform_remote_state</code> option, you can use Terraform&rsquo;s data sources (although at first glance I don&rsquo;t understand how remote state and data sources should both be lumped together&mdash;they seem somewhat unrelated), or you can use shared outputs from other Terraform modules.</p>
<p>Summarizing state safety:</p>
<ul>
<li>Use separate cloud accounts.</li>
<li>Use states per environment.</li>
<li>Consider states per service or per team.</li>
<li>Use a remote state manager (like Terraform Enterprise or S3).</li>
<li>Limit your blast radius.</li>
<li>Use some sort of read-only state.</li>
</ul>
<p>The second part of safety, according to French-Owens, pertains to Terraform modules. French-Owens believes that establishing standards/guidelines for writing Terraform modules can make Terraform &ldquo;feel safe&rdquo;. These can include separate definitions of inputs and outputs (using separate files), using sane default for inputs (to make it easier to consume), leveraging simplified templates, and bundling resources (like IAM) along with resource definitions/modules. Along the way, French-Owens shows examples of these standards/guidelines as they are being used at Segment. Using these guidelines allows you to abstract away some of the complexity, which makes it easier&mdash;and safer&mdash;for developers to consume. Reducing complexity and risk means developers are more likely to use Terraform, according to French-Owens.</p>
<p>French-Owens provided a summary slide of how to provide safety for modules, but I wasn&rsquo;t able to capture the contents of the slide quickly enough before he advanced.</p>
<p>In closing, French-Owens shows how Segment has leveraged the use of Terraform to address operational issues like ensuring that alerts are created for every service (using Datadog) or how to optimize cloud provider costs by tagging resources with cost center/billing information. He finally wraps up by extending a vision of Terraform as the &ldquo;package manager for the cloud&rdquo; and what this means in the future.</p>
<p>At this point, French-Owens wraps up the session.</p>

  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/hashiconf2017">HashiConf2017</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/terraform">Terraform</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/aws">AWS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ecs">ECS</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2017/09/19/journey-to-cloud-packer-terraform/">Liveblog: Journey to the Cloud with Packer and Terraform</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2017/09/20/hashiconf-2017-day-2-keynote/">HashiConf 2017 Day 2 Keynote</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2017%2f09%2f19%2fterraform-abstractions-safety-power%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2017%2f09%2f19%2fterraform-abstractions-safety-power%2f&text=Liveblog%3a%20Terraform%20Abstractions%20for%20Safety%20and%20Power" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2017%2f09%2f19%2fterraform-abstractions-safety-power%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2017/09/19/journey-to-cloud-packer-terraform/">Liveblog: Journey to the Cloud with Packer and Terraform</a> <span class="post-date-list">199 May 191919</span></li><li><a href="/2017/09/19/hashiconf-2017-day-1-keynote/">HashiConf 2017 Day 1 Keynote</a> <span class="post-date-list">199 May 191919</span></li><li><a href="/2017/08/25/technology-short-take-86/">Technology Short Take 86</a> <span class="post-date-list">259 May 252525</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
