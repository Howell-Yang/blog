<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>New User&#39;s Guide to Configuring VMware ESXi Networking via CLI - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="New User&#39;s Guide to Configuring VMware ESXi Networking via CLI - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="New User&#39;s Guide to Configuring VMware ESXi Networking via CLI - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2010/08/23/new-users-guide-to-configuring-vmware-esxi-networking-via-cli/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">New User&#39;s Guide to Configuring VMware ESXi Networking via CLI</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 239 May 232323 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/education">Education</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;1003 words (estimated 5 minutes to read)</span>
  <p>This is one article in a series of articles focused toward new users. Some other New User&rsquo;s Guide articles include:</p>
<ul>
<li>
<p><a href="/2009/06/23/new-user-networking-config-guide/">New User&rsquo;s Guide to Configuring VMware ESX Networking via CLI</a></p>
</li>
<li>
<p><a href="/2009/08/24/new-users-guide-to-configuring-cisco-mds-zones-via-cli/">New User&rsquo;s Guide to Configuring Cisco MDS Zones via CLI</a></p>
</li>
<li>
<p><a href="/2009/10/20/new-users-guide-to-managing-cisco-mds-zones-via-cli/">New User&rsquo;s Guide to Managing Cisco MDS Zones via CLI</a></p>
</li>
</ul>
<p>This particular article is a follow-up of sorts to the first article listed above. While that article focused on virtual networking with VMware ESX, this article focuses on virtual networking with VMware ESXi. Given that VMware&rsquo;s stated focus is on VMware ESXi moving forward, I thought this article would be helpful and timely.</p>
<p>For new users who are seeking a thorough explanation of how VMware ESX/ESXi networking functions, I&rsquo;ll recommend a series of articles by Ken Cline titled <a href="http://kensvirtualreality.wordpress.com/2009/03/29/the-great-vswitch-debate-part-1/">The Great vSwitch Debate</a>. Ken goes into a great level of detail. Go read that, then you can come back here.</p>
<p>All of the commands presented in this article were testing using VMware vSphere 4.1. The environment consisted of hosts running VMware ESXi 4.1 being managed by VMware vCenter Server 4.1. For CLI access, I used the vSphere Management Assistant (vMA) virtual appliance, deployed via OVF.</p>
<p>The majority of all the networking configuration you will need to perform on VMware ESXi boils down to just a few commands:</p>
<ul>
<li>
<p><em>vicfg-vswitch:</em> You will use this command to manipulate virtual switches (vSwitches) and port groups.</p>
</li>
<li>
<p><em>vicfg-vmknic:</em> You will use this command to create, modify, or delete VMkernel NICs on the VMware ESXi hosts.</p>
</li>
<li>
<p><em>vicfg-nics:</em> You will use this command to view (and potentially manipulate) the physical network interface cards (NICs) in a VMware ESXi host.</p>
</li>
</ul>
<p>The tasks that you&rsquo;ll actually perform using this commands are pretty straightforward:</p>
<ol>
<li>
<p>Creating, configuring, and deleting vSwitches</p>
</li>
<li>
<p>Creating, configuring, and deleting port groups</p>
</li>
<li>
<p>Creating, configuring, and deleting VMkernel NICs</p>
</li>
</ol>
<p>I&rsquo;ll start with a few prerequisites that are necessary due to the fact that you are using a remote CLI to access the VMware ESXi hosts.</p>
<p>As you can see from the list above, all the commands you&rsquo;re going to use are the <code>vicfg-*</code> commands. All of these commands have some standard parameters they require in addition to the task-specific parameters. To make things a bit simpler for you, I&rsquo;ll recommend that you set persistent values (persistent for the current vMA session, at least) to simplify the commands later. Here are the values I recommend you establish:</p>
<ul>
<li>
<p>First, set the value of the VI_SERVER variable to be the fully qualified domain name of the vCenter Server computer. Use the bash <code>export</code> command to set this variable. The command looks like <code>export VI_SERVER=vcenter-server.domain.com</code>.</p>
<p>Setting this variable now means that none of the <code>vicfg-*</code> commands will need to have this parameter specified. Since it&rsquo;s likely that you&rsquo;ll consistently work with one specific instance of vCenter Server, then this is a pretty safe variable to set.</p>
</li>
<li>
<p>In the absence of using Active Directory integration (which is a far cleaner choice, but one which we&rsquo;ll reserve for a future article), set the VI_USERNAME variable to the name of the user account you&rsquo;ll use to authenticate against vCenter Server. Again, use the <code>export</code> command as outlined in the previous bullet.</p>
</li>
</ul>
<p>Now that you have some basics established, I&rsquo;ll move on to creating, configuring, and deleting vSwitches.</p>
<h2 id="creating-configuring-and-deleting-vswitches">Creating, Configuring, and Deleting vSwitches</h2>
<p>You&rsquo;ll use the <code>vicfg-vswitch</code> command for the majority of these tasks. Unless I specifically indicate otherwise, all the commands, parameters, and arguments are case-sensitive. For all these <code>vicfg-*</code> commands, you will get prompted for the password to the user account you defined when you set the value of the VI_USERNAME variable.</p>
<p>To create a vSwitch, use this command:</p>
<pre><code>vicfg-vswitch -h &lt;ESXi hostname&gt; -a &lt;vSwitch Name&gt;
</code></pre>
<p>To link a physical NIC to a vSwitch&mdash;which is necessary in order for the vSwitch to pass traffic onto the physical network or to receive traffic from the physical network&mdash;use this command:</p>
<pre><code>vicfg-vswitch -h &lt;ESXi hostname&gt; -L &lt;Physical NIC&gt; &lt;vSwitch Name&gt;
</code></pre>
<p>In the event you don&rsquo;t have information on the physical NICs, you can use this command to list the physical NICs (that&rsquo;s a lowercase L in the command):</p>
<pre><code>vicfg-nics -h &lt;ESXi hostname&gt; -l
</code></pre>
<p>Conversely, if you need to unlink (remove) a physical NIC from a vSwitch, use this command:</p>
<pre><code>vicfg-vswitch -h &lt;ESXi hostname&gt; -U &lt;Physical NIC&gt; &lt;vSwitch Name&gt;
</code></pre>
<p>To change the Maximum Transmission Unit (MTU) size on a vSwitch, use this command:</p>
<pre><code>vicfg-vswitch -h &lt;ESXi hostname&gt; -m &lt;MTU size&gt; &lt;vSwitch Name&gt;
</code></pre>
<p>To delete a vSwitch, use this command:</p>
<pre><code>vicfg-vswitch -h &lt;ESXi hostname&gt; -d &lt;vSwitch Name&gt;
</code></pre>
<h2 id="creating-configuring-and-deleting-port-groups">Creating, Configuring, and Deleting Port Groups</h2>
<p>As with virtual switches, the <code>vicfg-vswitch</code> is the command you will use to work with port groups. Once again, unless I specifically indicate otherwise, all the commands, parameters, and arguments are case-sensitive.</p>
<p>To create a port group, use this command:</p>
<pre><code>vicfg-vswitch -h &lt;ESXi hostname&gt; -A &lt;Port Group Name&gt; &lt;vSwitch Name&gt;
</code></pre>
<p>To set the VLAN ID for a port group, use this command:</p>
<pre><code>vicfg-vswitch -h &lt;ESXi hostname&gt; -v &lt;VLAN ID&gt; -p &lt;Port Group Name&gt; &lt;vSwitch Name&gt;
</code></pre>
<p>To delete a port group, use this command:</p>
<pre><code>vicfg-vswitch -h &lt;ESXi hostname&gt; -D &lt;Port Group Name&gt; &lt;vSwitch Name&gt;
</code></pre>
<p>To view the current list of vSwitches, port groups, and uplinks, use this command (that&rsquo;s a lowercase L in the command):</p>
<pre><code>vicfg-vswitch -h &lt;ESXi hostname&gt; -l
</code></pre>
<h2 id="creating-configuring-and-deleting-vmkernel-nics">Creating, Configuring, and Deleting VMkernel NICs</h2>
<p>To work with ESXi&rsquo;s VMkernel NICs, you&rsquo;ll primarily use the <code>vicfg-vmknic</code> command. As in the previous sections, all commands are case-sensitive unless I specifically indicate otherwise, and all commands assume you&rsquo;ve defined the VI_SERVER and VI_USERNAME variables.</p>
<p>To create a new VMkernel NIC, use this command:</p>
<pre><code>vicfg-vmknic -h &lt;ESXi hostname&gt; -a -i &lt;VMkernel NIC IP address&gt; -n &lt;Subnet mask&gt; &lt;Port group&gt;
</code></pre>
<p>To delete a VMkernel NIC, use this command:</p>
<pre><code>vicfg-vmknic -h &lt;ESXi hostname&gt; -d &lt;Port group&gt;
</code></pre>
<p>To enable vMotion on an already-created VMkernel NIC:</p>
<pre><code>vicfg-vmknic -h &lt;ESXi hostname&gt; -E &lt;Port group&gt;
</code></pre>
<p>There are more networking-related tasks that you can perform from the CLI, but for a new user these commands should handle the lion&rsquo;s share of all the networking configuration. Good luck with your ESXi environment!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/esxi">ESXi</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vsphere">vSphere</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2010/08/22/vmworld-2010-spouse-activities-calendar/">VMworld 2010 Spouse Activities Calendar</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2010/08/23/windows-7-microsoft-security-essentials-and-proxy-servers/">Windows 7, Microsoft Security Essentials, and Proxy Servers</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2010%2f08%2f23%2fnew-users-guide-to-configuring-vmware-esxi-networking-via-cli%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2010%2f08%2f23%2fnew-users-guide-to-configuring-vmware-esxi-networking-via-cli%2f&text=New%20User%27s%20Guide%20to%20Configuring%20VMware%20ESXi%20Networking%20via%20CLI" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2010%2f08%2f23%2fnew-users-guide-to-configuring-vmware-esxi-networking-via-cli%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2009/05/21/vmware-vsphere-vds-vmkernel-ports-and-jumbo-frames/">VMware vSphere vDS, VMkernel Ports, and Jumbo Frames</a> <span class="post-date-list">219 May 212121</span></li><li><a href="/2009/05/18/summary-of-cdp-articles/">Summary of CDP Articles</a> <span class="post-date-list">189 May 181818</span></li><li><a href="/2009/03/25/next-gen-stuff-verifying-the-sha-1-fingerprint/">Next-Gen Stuff: Verifying the SHA-1 Fingerprint</a> <span class="post-date-list">259 May 252525</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
