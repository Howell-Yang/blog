<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>How to Configure NPV on a Nexus 5000 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="How to Configure NPV on a Nexus 5000 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="How to Configure NPV on a Nexus 5000 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2010/06/28/how-to-configure-npv-on-a-nexus-5000/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">How to Configure NPV on a Nexus 5000</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 289 May 282828 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;647 words (estimated 4 minutes to read)</span>
  <p>Some time ago I posted a &ldquo;how to&rdquo; article on <a href="/2009/10/25/setting-up-fcoe-on-a-nexus-5000/">how to configure FCoE on a Nexus 5000</a> switch. At that time, I did not put the Nexus 5000 into NPV mode but rather connected it to a Cisco MDS Fibre Channel switch without using NPV. In this entry, I&rsquo;d like to follow up on that article and show you how to configure NPV on a Nexus 5000.</p>
<p>If you aren&rsquo;t familiar with NPV (N_Port Virtualization) and how it&rsquo;s different than NPIV (N_Port ID Virtualization), check out this article titled <a href="/2009/11/27/understanding-npiv-and-npv/">&ldquo;Understanding NPIV and NPV&rdquo;</a>; It should help clear things up. Because NPV makes the Nexus 5000 look like an NPIV-enabled host, one potential use for NPV, as in this case, is when connecting the Nexus 5000 to a non-Cisco Fibre Channel switch. Using NPV helps ease interoperability concerns. In this instance, I&rsquo;m connecting the Nexus 5000 to a Brocade Fibre Channel switch (actually an EMC Connectrix).</p>
<p>Note that I tested these instructions on a Nexus 5010 using both NX-OS 4.1(3)N2(1) as well as NX-OS 4.2(1)N1(1).</p>
<p>The first step is to enable NPV on the Nexus 5000. As far as I can tell, in order to enable NPV you must first enable FCoE using the <code>feature</code> command:</p>
<pre><code>switch(config)# feature fcoe
</code></pre>
<p>This loads various Fibre Channel modules and makes possible other features, including NPV and NPIV. Enabling NPV erases the switch configuration and reboots the switch, so be sure you are connected via a console connection before enabling NPV with the <code>feature</code> command:</p>
<pre><code>switch(config)# feature npv
</code></pre>
<p>Immediately after enabling NPV, the Nexus 5000 will reboot (you&rsquo;re warned and given the option to proceed or cancel). The warning indicates that the switch&rsquo;s configuration will be removed, but the minimally-configured switches I used in my testing retained their configuration. Granted, I hadn&rsquo;t performed any Fibre Channel or FCoE configurations yet, so perhaps that&rsquo;s the configuration to which the warning was referring.</p>
<p>Once NPV is enabled on the switch, you can then configure Fibre Channel uplink ports as NP ports (proxy N_ports); these are also referred to as external interfaces. To configure a Fibre Channel port as an NP port, use these commands:</p>
<pre><code>switch# config t  
switch(config)# interface fc _slot/port_  
switch(config-if)# switchport mode np  
switch(config-if)# no shut  
switch(config-if)# exit  
switch(config)# exit
</code></pre>
<p>You should then be ready to physically connect to the upstream Fibre Channel switch, which&mdash;if you recall correctly from my earlier NPV/NPIV post&mdash;needs to be NPIV-enabled. In this particular case, I was uplinking the Nexus 5010 to an EMC-rebranded Brocade switch (a Connectrix DS-300B running Fabric OS 6.1.0). To show whether the port on the Connectrix was enabled for NPIV, I used the <code>portcfgshow</code> command:</p>
<pre><code>rtp-fc-sw-01:admin&gt; portcfgshow &lt;port number&gt;
</code></pre>
<p>Look for the line that says &ldquo;NPIV Capability&rdquo;; the value should be reported as &ldquo;ON&rdquo;. If the value is not &ldquo;ON&rdquo;, you&rsquo;ll need to use the <code>portcfgnpivport</code> command to enable NPIV on the specified port, like this:</p>
<pre><code>rtp-fc-sw-01:admin&gt; portcfgnpivport &lt;port number&gt; 1
</code></pre>
<p>The &ldquo;1&rdquo; at the end of that command enables NPIV; a &ldquo;0&rdquo; would disable NPIV for that port.</p>
<p>Once NPIV is enabled on the upstream Fibre Channel switch, when you physically connect the configured external interface then the Fibre Channel link should come up. I used the <code>show int fc &lt;slot/number&gt;</code> command on the Nexus to verify that the port was up; on the Connectrix, I used the <code>portshow &lt;port&gt;</code> command. In addition, I was also able to see the Nexus switch logged into the Fibre Channel fabric on the Connectrix using the <code>nsshow</code> command.</p>
<p>Once you have Fibre Channel connectivity via the external interfaces, then configuring FCoE to hosts connected to the Nexus follows the same set of instructions laid out in <a href="/2009/10/25/setting-up-fcoe-on-a-nexus-5000/">my earlier FCoE how-to article</a>.</p>
<p>From that point on, it&rsquo;s only a matter of configuring zones (see here for <a href="/2009/08/24/new-users-guide-to-configuring-cisco-mds-zones-via-cli/">help with zones on a Cisco MDS</a>) and presenting storage. Those are different posts for a different day&hellip;</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cisco">Cisco</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/fcoe">FCoE</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/fibrechannel">FibreChannel</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nexus">Nexus</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/npiv">NPIV</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/npv">NPV</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/storage">Storage</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2010/06/19/hiatus/">Hiatus</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2010/07/12/vmotion-practicality/">vMotion Practicality</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2010%2f06%2f28%2fhow-to-configure-npv-on-a-nexus-5000%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2010%2f06%2f28%2fhow-to-configure-npv-on-a-nexus-5000%2f&text=How%20to%20Configure%20NPV%20on%20a%20Nexus%205000" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2010%2f06%2f28%2fhow-to-configure-npv-on-a-nexus-5000%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2009/11/27/understanding-npiv-and-npv/">Understanding NPIV and NPV</a> <span class="post-date-list">279 May 272727</span></li><li><a href="/2009/10/25/setting-up-fcoe-on-a-nexus-5000/">Setting Up FCoE on a Nexus 5000</a> <span class="post-date-list">259 May 252525</span></li><li><a href="/2010/04/21/thinking-out-loud-what-is-multi-hop-fcoe/">Thinking Out Loud: What is multi-hop FCoE?</a> <span class="post-date-list">219 May 212121</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
