<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>PXE Booting VMware ESX 4.0 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="PXE Booting VMware ESX 4.0 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="PXE Booting VMware ESX 4.0 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2010/03/02/pxe-booting-vmware-esx-40/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">PXE Booting VMware ESX 4.0</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 29 May 2022 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;1009 words (estimated 5 minutes to read)</span>
  <p>I recently had the opportunity to work on a proof of concept (PoC) in which we wanted to help a customer streamline the processes needed to deploy new hosts and reduce the amount of time it took overall. One of the tools we used in the PoC for this purpose was PXE booting VMware ESX for an automated installation. Here are the details on how we made this work.</p>
<p>Before I get into the details, I&rsquo;ll provide this disclaimer: there are probably easier ways of making this work. I specifically didn&rsquo;t use UDA or similar because I wanted to gain the experience of how to do this the &ldquo;old fashioned&rdquo; way. I also wanted to be able to walk the customer through the &ldquo;old fashioned&rdquo; way and explain all the various components.</p>
<p>With that in mind, here are the components you&rsquo;ll need to make this work:</p>
<ol>
<li>
<p>You&rsquo;ll need a DHCP server to pass down the PXE boot information. In this particular instance, I used an existing Windows-based DHCP server. Any DHCP server should work; feel free to use the Linux ISC DHCP server if you prefer.</p>
</li>
<li>
<p>You&rsquo;ll need an FTP server to host the kickstart script and VMware ESX 4.0 Update 1 installation files. In this case, I used a third-party FTP server running on the same Windows-based server as DHCP. Again, feel free to use a Linux-based FTP server if you prefer.</p>
</li>
<li>
<p>You will need a TFTP server to provide the boot files. The third-party FTP server used in the previous step also provided TFTP functionality. Use whatever TFTP server you prefer.</p>
</li>
</ol>
<p>Make sure that each of these components is working as expected before proceeding. Otherwise, you&rsquo;ll spend time troubleshooting problems that aren&rsquo;t immediately apparent.</p>
<h2 id="preparing-for-the-automated-esx-installation">Preparing for the Automated ESX Installation</h2>
<p>First, copy the contents for the VMware ESX 4.0 Update 1 DVD&mdash;not the actual ISO, but the contents of the ISO&mdash;to a directory on the FTP server. Test it to make sure that the files can be accessed via an anonymous FTP user.</p>
<p>Also go ahead and create a simple kickstart script that automates the installation of VMware ESX. I won&rsquo;t bother to go into detail on this step here; it&rsquo;s been quite adequately documented elsewhere. You&rsquo;ll need to put this kickstart script on the FTP server as well.</p>
<p>At this point, you&rsquo;re ready to proceed with gathering the PXE boot files.</p>
<h2 id="gathering-the-pxe-boot-files">Gathering the PXE Boot Files</h2>
<p>The first task you&rsquo;ll need to complete is gathering the necessary files for a PXE boot environment.</p>
<p>First, copy the <code>vmlinuz</code> and <code>initrd.img</code> files from the VMware ESX 4.0 Update 1 ISO image. Since I use a Mac, for me this was a simple case of mounting the ISO image and copying out the files I needed. Linux or Windows users, it might be a bit more complicated for you. These files, by the way, are in the ISOLINUX folder on the DVD image.</p>
<p>Next, you&rsquo;ll need the PXE boot files. Specifically, you&rsquo;ll need the <code>menu.c32</code> and <code>pxelinux.0</code> files. These files are <strong>not</strong> on the DVD ISO image; you&rsquo;ll have to download Syslinux from <a href="http://syslinux.zytor.com/wiki/index.php/The_Syslinux_Project">this web site</a>. Once you download Syslinux, extract the files into a temporary directory. You&rsquo;ll find <code>menu.c32</code> in the com32/menu folder; you&rsquo;ll find <code>pxelinux.0</code> in the core folder. Copy both of these files, along with <code>vmlinuz</code> and <code>initrd.img</code>, into the root directory of the TFTP server. (If you don&rsquo;t know the root directory of the TFTP server, double-check its configuration.)</p>
<p>You&rsquo;re now ready to configure the PXE boot process.</p>
<h2 id="configuring-the-pxe-boot-environment">Configuring the PXE Boot Environment</h2>
<p>Once the necessary files have been placed into the root directory of the TFTP server, you&rsquo;re ready to configure the PXE boot environment. To do this, you&rsquo;ll need to create a PXE configuration file on the TFTP server.</p>
<p>The file should be placed into a folder named pxelinux.cfg under the root of the TFTP server. The filename of the PXE configuration file should be named something like this:</p>
<pre><code>01-&lt;MAC address of network interface on host&gt;
</code></pre>
<p>If the MAC address of the host was 01:02:03:04:05:06, the name of the text file in the <code>pxelinux.cfg</code> folder on the TFTP server would be:</p>
<pre><code>01-01-02-03-04-05-06
</code></pre>
<p>The PoC in which I was engaged involved Cisco UCS, so we knew in advance what the MAC addresses were going to be (the MAC address is assigned in the UCS service profile).</p>
<p>The contents of this file should look something like this (lines have been wrapped here for readability and are marked by backslashes; don&rsquo;t insert any line breaks in the actual file):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>default menu.c32  
</span></span><span style="display:flex;"><span>menu title Custom PXE Boot Menu Title  
</span></span><span style="display:flex;"><span>timeout 30  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>label scripted  
</span></span><span style="display:flex;"><span>menu label Scripted installation  
</span></span><span style="display:flex;"><span>kernel vmlinuz  
</span></span><span style="display:flex;"><span>append initrd=initrd.img mem=512M ksdevice=vmnic0 ks=ftp://A.B.C.D/ks.cfg  
</span></span><span style="display:flex;"><span>IPAPPEND 1
</span></span></code></pre></div><p>You&rsquo;ll want to replace <code>ftp://A.B.C.D/ks.cfg</code> with the correct IP address and path for the kickstart script on the FTP server.</p>
<p>Only one step remains: configuring the DHCP server.</p>
<h2 id="configuring-the-dhcp-server-for-pxe-boot">Configuring the DHCP Server for PXE Boot</h2>
<p>As I mentioned earlier, I used the Windows DHCP server as a matter of ease and convenience; feel free to use whatever DHCP server best suits your needs. There are only two options that are necessary for PXE boot:</p>
<p>066 Boot Server Host Name <em>(specify the IP address of the TFTP server)</em></p>
<p>067 Bootfile Name <em>(specify <code>pxelinux.0</code>)</em></p>
<p>In this particular example, I created reservations for each MAC address. Because the values were the same for all reservations, I used server-wide DHCP options, but you could use reservation-specific DHCP options if you wanted different boot options on a per-MAC address (i.e., per-reservation) basis.</p>
<h2 id="the-end-result">The End Result</h2>
<p>Recall that this PoC was using Cisco UCS blades. Thus, in this environment, to prepare for a new host coming online we only had to make sure that we had a PXE configuration file and create a matching DHCP reservation. The MAC address would get assigned via the service profile, and when the blade booted then it would automatically proceed with an unattended installation. Combined with Host Profiles in VMware vCenter, this took the process of bringing new ESX/ESXi hosts online down to mere minutes. A definite win for any customer!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cisco">Cisco</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/esx">ESX</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ucs">UCS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vsphere">vSphere</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2010/02/26/congrats-to-hytrust/">Congrats to HyTrust</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2010/03/05/vmware-esx-emc-clariion-arrays-and-multiple-protocols/">VMware ESX, EMC CLARiiON Arrays, and Multiple Protocols</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2010%2f03%2f02%2fpxe-booting-vmware-esx-40%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2010%2f03%2f02%2fpxe-booting-vmware-esx-40%2f&text=PXE%20Booting%20VMware%20ESX%204.0" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2010%2f03%2f02%2fpxe-booting-vmware-esx-40%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2010/02/04/using-ip-based-storage-with-vmware-vsphere-on-cisco-ucs/">Using IP-Based Storage with VMware vSphere on Cisco UCS</a> <span class="post-date-list">49 May 4044</span></li><li><a href="/2010/01/07/virtualization-short-take-33/">Virtualization Short Take #33</a> <span class="post-date-list">79 May 7077</span></li><li><a href="/2009/11/03/a-few-quick-thoughts-on-the-vce-coalition-announcement/">A Few Quick Thoughts on the VCE Coalition Announcement</a> <span class="post-date-list">39 May 3033</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
