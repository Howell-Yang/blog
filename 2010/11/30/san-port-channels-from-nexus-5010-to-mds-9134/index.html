<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>SAN Port Channels from Nexus 5010 to MDS 9134 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="SAN Port Channels from Nexus 5010 to MDS 9134 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="SAN Port Channels from Nexus 5010 to MDS 9134 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2010/11/30/san-port-channels-from-nexus-5010-to-mds-9134/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">SAN Port Channels from Nexus 5010 to MDS 9134</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 309 May 303030 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;976 words (estimated 5 minutes to read)</span>
  <p>As part of an ongoing effort to expand the functionality of the vSpecialist lab in the EMC RTP facility, we recently added a pair of Cisco MDS 9134 Fibre Channel switches. These Fibre Channel switches are connected to a pair of Cisco Nexus 5010 switches, which handle Unified Fabric connections from a collection of CNA-equipped servers. To connect the Nexus switches to the MDS switches, we used SAN port channels to bond multiple Fibre Channel interfaces together for both redundancy and increased aggregate throughput. Here is how to configure SAN port channels to connect a Cisco Nexus switch to a Cisco MDS switch.</p>
<p>If you are interested, more in-depth information can be found <a href="http://www.cisco.com/en/US/docs/switches/datacenter/nexus5000/sw/san_switching/Cisco_Nexus_5000_Series_NX-OS_SAN_Switching_Configuration_Guide_chapter7.html">here</a> on Cisco&rsquo;s web site.</p>
<p>Although I&rsquo;ve broken out the configuration for the MDS and the Nexus into separate sections, the commands are <strong>very</strong> similar. In my situation, the MDS 9134 was running NX-OS 5.0(1a) and the Nexus 5010 was running NX-OS 4.2(1)N1(1).</p>
<h2 id="configuring-the-cisco-mds-9134">Configuring the Cisco MDS 9134</h2>
<p>To configure the MDS 9134 with a SAN port channel, use the following commands.</p>
<p>First, create the SAN port channel with the <code>interface port-channel</code> command, like this:</p>
<pre><code>mds(config)# interface port-channel 1
</code></pre>
<p>You can replace the &ldquo;1&rdquo; at the end of that command with any number from 1 to 256; it&rsquo;s just the numeric identifier for that SAN port channel. The SAN port channel number does not have to match on both ends.</p>
<p>Once you&rsquo;ve created the SAN port channel, then add individual interfaces with the <code>channel-group</code> command:</p>
<pre><code>mds(config)# interface fc1/16  
mds(config-if)# channel-group 1
</code></pre>
<p>The &ldquo;1&rdquo; specified in the <code>channel-group</code> command has to match the number specified in the earlier <code>interface port-channel</code> command. This might seem obvious, but I wanted to point it out nevertheless.</p>
<p>Repeat this process for each interface you want to add to the SAN port channel. In my example, I used two interfaces.</p>
<p>When you add an interface to the SAN port channel, NX-OS reminds you to perform a matching configuration on the switch at the other end, then use the <code>no shutdown</code> command to make the interfaces (and the SAN port channel) active. Let&rsquo;s look first at the commands for configuring the Nexus, then we&rsquo;ll examine what it looks like when we bring the SAN port channel online.</p>
<h2 id="configuring-the-cisco-nexus-5010">Configuring the Cisco Nexus 5010</h2>
<p>The commands here are <strong>very</strong> similar to the MDS 9134. First, you need to create the SAN port channel using the <code>interface san-port-channel</code> command (note the slight difference in commands between the MDS and the Nexus here):</p>
<pre><code>nexus(config)# interface san-port-channel 1
</code></pre>
<p>As with the MDS, the number at the end simply serves as a unique identifier for the SAN port channel and can range from 1 to 256.</p>
<p>Then add interfaces to the SAN port channel using the <code>channel-group</code> command:</p>
<pre><code>nexus(config)# interface fc2/1  
nexus(config-if)# channel-group 1  
nexus(config-if)# interface fc2/2  
nexus(config-if)# channel-group 1
</code></pre>
<p>As I&rsquo;ve shown above, simply repeat the process for each interface you want to add to the SAN port channel. As on the MDS, NX-OS reminds you to perform a matching configuration on the opposite end of the link and then issue the <code>no shutdown</code> command.</p>
<h2 id="bringing-up-the-san-port-channel">Bringing Up the SAN Port Channel</h2>
<p>Once a matching configuration is performed on both ends, then you can use the <code>no shutdown</code> command (which you can abbreviate to simply <code>no shut</code>) to activate the interfaces and the SAN port channel. After activating the interfaces, a <code>show interface port-channel</code> (on the MDS) or a <code>show interface san-port-channel</code> (on the Nexus) will show you the status of the SAN port channel. Only the first few lines of output are shown below (this output is taken from the Nexus):</p>
<pre><code>nexus# sh int san-port-channel 1  
san-port-channel 1 is trunking (Not all VSANs UP on the trunk)  
Hardware is Fibre Channel  
Port WWN is 24:01:00:05:9b:7b:0c:80  
Admin port mode is auto, trunk mode is on  
snmp link state traps are enabled  
Port mode is TE  
Port vsan is 1  
Speed is 4 Gbps  
Trunk vsans (admin allowed and active) (1)  
Trunk vsans (up) ()  
Trunk vsans (isolated) ()  
Trunk vsans (initializing) (1)
</code></pre>
<p>A few useful pieces of information are available here:</p>
<ul>
<li>
<p>First, you can see that the SAN port channel is not fully up; it&rsquo;s still initializing. This is shown by the &ldquo;Not all VSANs UP on the trunk&rdquo; message, as well as by the &ldquo;Trunk vsans (initializing)&rdquo; line.</p>
</li>
<li>
<p>Second, you can see the only a single member is up. Note the speed of the SAN port channel is listed as 4 Gbps.</p>
</li>
<li>
<p>Third, note that this is a trunking port, meaning that it could carry multiple VSANs. This is noted by the &ldquo;Port mode is TE&rdquo; line as well as the first line of the output (&ldquo;san-port-channel 1 is trunking&rdquo;).</p>
</li>
</ul>
<p>As it turns out, I&rsquo;d cabled the connections wrong; after I fixed the connections and gave the SAN port channel a small amount of time to initialize, the output was different (this output is taken from the MDS):</p>
<pre><code>nexus# sh int port-channel 1  
port-channel 1 is trunking  
Hardware is Fibre Channel  
Port WWN is 24:01:00:05:73:a7:72:00  
Admin port mode is auto, trunk mode is on  
snmp link state traps are enabled  
Port mode is TE  
Port vsan is 1  
Speed is 8 Gbps  
Trunk vsans (admin allowed and active) (1)  
Trunk vsans (up) (1)  
Trunk vsans (isolated) ()  
Trunk vsans (initializing) ()
</code></pre>
<p>Now you can see that both members of the SAN port channel are active (&ldquo;Speed is 8 Gbps&rdquo;) and that all VSANs are trunking across the SAN port channel.</p>
<p>At this point, you are now ready to proceed with creating VSANs, zones, and zonesets. Refer to these articles for more information on MDS zone creation and management via CLI:</p>
<p><a href="/2009/08/24/new-users-guide-to-configuring-cisco-mds-zones-via-cli/">New User&rsquo;s Guide to Configuring Cisco MDS Zones via CLI</a></p>
<p><a href="/2009/10/20/new-users-guide-to-managing-cisco-mds-zones-via-cli/">New User&rsquo;s Guide to Managing Cisco MDS Zones via CLI</a></p>
<p>As always, questions, clarifications, or corrections are welcome&mdash;just add them below in the comments. Thanks!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cisco">Cisco</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/fibrechannel">FibreChannel</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nexus">Nexus</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/san">SAN</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/storage">Storage</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2010/11/29/technology-short-take-7/">Technology Short Take #7</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2010/11/30/connecting-a-nexus-2148-to-a-nexus-5010/">Connecting a Nexus 2148 to a Nexus 5010</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2010%2f11%2f30%2fsan-port-channels-from-nexus-5010-to-mds-9134%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2010%2f11%2f30%2fsan-port-channels-from-nexus-5010-to-mds-9134%2f&text=SAN%20Port%20Channels%20from%20Nexus%205010%20to%20MDS%209134" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2010%2f11%2f30%2fsan-port-channels-from-nexus-5010-to-mds-9134%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2010/06/28/how-to-configure-npv-on-a-nexus-5000/">How to Configure NPV on a Nexus 5000</a> <span class="post-date-list">289 May 282828</span></li><li><a href="/2009/10/25/setting-up-fcoe-on-a-nexus-5000/">Setting Up FCoE on a Nexus 5000</a> <span class="post-date-list">259 May 252525</span></li><li><a href="/2009/08/22/planning-for-fcoe-in-your-data-center-today/">Planning for FCoE in Your Data Center Today</a> <span class="post-date-list">229 May 222222</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
