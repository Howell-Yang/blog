<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Configuring Inter-VLAN Routing - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Configuring Inter-VLAN Routing - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Configuring Inter-VLAN Routing - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2010/04/23/configuring-inter-vlan-routing/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Configuring Inter-VLAN Routing</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 239 May 232323 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;582 words (estimated 3 minutes to read)</span>
  <p>Yesterday I completed the configuration of inter-VLAN routing (aka &ldquo;router on a stick&rdquo;, or RoaS) as part of my ongoing CCNA preparation. A couple people mentioned that they would find the configuration useful, so I&rsquo;m posting what I have. This is by no means a comprehensive treatise on the subject; for that, you should look elsewhere. Google can find you lots of sites with more in-depth and detailed information on the reasons behind the necessary configuration.</p>
<p>There are two primary components in a RoaS configuration:</p>
<ol>
<li>
<p>The configuration of the VLANs and VLAN trunking port on the switch</p>
</li>
<li>
<p>The configuration of subinterfaces on the router</p>
</li>
</ol>
<p>I describe how to configure each component below.</p>
<h2 id="vlans-and-vlan-trunking">VLANs and VLAN Trunking</h2>
<p>How to create VLANs varies between various switch types. On some switches, you&rsquo;ll use the <code>vlan database</code> command in privileged EXEC mode. On other switches, you will use the <code>vlan &lt;VLAN ID&gt;</code> command while in global configuration mode. Regardless of which method is necessary for your particular Cisco switch, you will want to ensure that the switch has all the necessary VLANs defined.</p>
<p>After the VLANs have been defined, then you will need to configure the switch port connected to the router as a VLAN trunk port. This is pretty <a href="/2006/12/04/esx-server-nic-teaming-and-vlan-trunking/">well covered elsewhere</a>, but here is a quick review of the commands (these commands assume port 15 on module 0, a Fast Ethernet port):</p>
<pre><code>switch(config)# int fa0/15  
switch(config-if)# switchport trunk encapsulation dot1q  
switch(config-if)# switchport mode trunk  
switch(config-if)# switchport trunk allowed vlan 1,71-75  
switch(config-if)# exit  
switch(config)# exit  
</code></pre>
<p>A couple notes about these commands:</p>
<ul>
<li>
<p>Some switches only accept 802.1Q VLAN encapsulation; therefore, the <code>switchport trunk encapsulation dot1q</code> command isn&rsquo;t supported because that&rsquo;s the only encapsulation supported. So, the support for this command will vary from switch to switch.</p>
</li>
<li>
<p>You will want to specify the correct VLANs for your environment in the <code>switchport trunk allowed vlan</code> command.</p>
</li>
</ul>
<p>At this point, the switch is configured correctly; now it&rsquo;s time to move to the router.</p>
<h2 id="subinterfaces-on-the-router">Subinterfaces on the Router</h2>
<p>For each VLAN that needs to be routed, you will need to create a subinterface on the router. Creating a subinterface is pretty easy, the commands look something like this:</p>
<pre><code>router(config)# int fa0/0.1  
router(config-if)# encapsulation dot1q 1 native  
router(config-if)# ip address 192.168.1.1 255.255.255.0  
router(config-if)# exit  
router(config)# exit  
</code></pre>
<p>As before, there are a few notes to consider about these commands:</p>
<ul>
<li>
<p>The number of the subinterface (the &ldquo;1&rdquo; in <code>fa0/0.1</code> above) is only locally significant and doesn&rsquo;t need to match the VLAN ID, but matching the VLAN ID makes it easier to associate the subinterface with its configured VLAN ID. Again, as stated earlier, you&rsquo;ll need a separate subinterface for each VLAN that you want to route.</p>
</li>
<li>
<p>Only specify the <code>native</code> keyword on the <code>encapsulation dot1q</code> command if this is the native VLAN on the switch side as well. Otherwise, the trunk won&rsquo;t form as expected.</p>
</li>
<li>
<p>The IP address specified here will be the IP address of the default gateway for that VLAN/subnet.</p>
</li>
</ul>
<p>For the physical interface itself, the interface needs to be up (so <strong>don&rsquo;t</strong> issue a <code>shutdown</code> command), but the interface does not need to have any IP address associated with it.</p>
<p>With this configuration in place, you should be able to route between the VLANs; just specify the IP address of the subinterface on the router for that VLAN as the default gateway of the systems on that VLAN and you should be good to go.</p>
<p>If I&rsquo;ve missed anything glaring please speak up in the comments and let me know.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cisco">Cisco</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vlan">VLAN</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2010/04/22/setting-up-a-ccna-study-environment-with-gns3-and-vmware/">Setting up a CCNA Study Environment with GNS3 and VMware</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2010/04/26/continuing-the-consolidation-discussion/">Continuing the Consolidation Discussion</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2010%2f04%2f23%2fconfiguring-inter-vlan-routing%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2010%2f04%2f23%2fconfiguring-inter-vlan-routing%2f&text=Configuring%20Inter-VLAN%20Routing" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2010%2f04%2f23%2fconfiguring-inter-vlan-routing%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2008/12/19/vmware-esx-networking-articles/">VMware ESX Networking Articles</a> <span class="post-date-list">199 May 191919</span></li><li><a href="/2009/11/09/enabling-jumbo-frames-on-a-nexus-5000/">Enabling Jumbo Frames on a Nexus 5000</a> <span class="post-date-list">99 May 9099</span></li><li><a href="/2009/11/03/fcoe-and-vlan-trunking-on-nexus-5000/">FCoE and VLAN Trunking on Nexus 5000</a> <span class="post-date-list">39 May 3033</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
