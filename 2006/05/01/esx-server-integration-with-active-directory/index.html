<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>ESX Server Integration with Active Directory - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="ESX Server Integration with Active Directory - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="ESX Server Integration with Active Directory - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2006/05/01/esx-server-integration-with-active-directory/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">ESX Server Integration with Active Directory</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 19 May 1011 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;733 words (estimated 4 minutes to read)</span>
  <p>Having successfully mapped out the steps for Linux/Unix-based hosts to authenticate against Active Directory on Windows Server 2003 R2 (get the <a href="/2006/04/27/linux-ad-integration-with-windows-server-2003-r2/">complete details</a>), I now turned my sights toward integrating authentication on <a href="http://www.vmware.com/products/esx/">ESX Server</a> 2.5.3 with Active Directory as well.</p>
<p>Using instructions found in <a href="http://www.vmware.com/pdf/esx_authentication_AD.pdf">this technical white paper</a> from VMware&rsquo;s web site, I started out by modifying the <code>/etc/krb5.conf</code> file, which controls the operation of the Kerberos libraries in the Console Operating System (COS).  The contents of the <code>/etc/krb5.conf</code> file should look something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[logging]
</span></span><span style="display:flex;"><span> default = FILE:/var/log/krb5libs.log
</span></span><span style="display:flex;"><span> kdc = FILE:/var/log/krb5kdc.log
</span></span><span style="display:flex;"><span> admin_server = FILE:/var/log/kadmind.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[libdefaults]
</span></span><span style="display:flex;"><span> ticket_lifetime = 24000
</span></span><span style="display:flex;"><span> default_realm = EXAMPLE.NET
</span></span><span style="display:flex;"><span> dns_lookup_realm = false
</span></span><span style="display:flex;"><span> dns_lookup_kdc = false
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[realms]
</span></span><span style="display:flex;"><span> EXAMPLE.NET = {
</span></span><span style="display:flex;"><span>  kdc = addc01.example.net:88
</span></span><span style="display:flex;"><span>  admin_server = addc01.example.net:749
</span></span><span style="display:flex;"><span>  default_domain = example.net
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[domain_realm]
</span></span><span style="display:flex;"><span> .example.net = EXAMPLE.NET
</span></span><span style="display:flex;"><span> example.net = EXAMPLE.NET
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[kdc]
</span></span><span style="display:flex;"><span> profile = /var/kerberos/krb5kdc/kdc.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[pam]
</span></span><span style="display:flex;"><span> debug = false
</span></span><span style="display:flex;"><span> ticket_lifetime = 36000
</span></span><span style="display:flex;"><span> renew_lifetime = 36000
</span></span><span style="display:flex;"><span> forwardable = true
</span></span><span style="display:flex;"><span> krb4_convert = false
</span></span></code></pre></div><p>As you may already be aware, you can change the &ldquo;dns_lookup_realm&rdquo; and &ldquo;dns_lookup_kdc&rdquo; directives to true and omit the &ldquo;[realms]&rdquo; section, assuming that your Active Directory DNS infrastructure has the properly registered SRV records for the domain controllers.</p>
<p>The <a href="http://www.vmware.com/">VMware</a> white paper then instructed to modify the <code>/var/kerberos/krb5kdc/kdc.conf</code> file, but I had never performed any edits to that file in my earlier experiments, so I decided to forgo that step. It is my understanding that this file controls the behavior of a Key Distribution Center (KDC), which the COS is not (in this instance, the KDC is the Active Directory domain controller).</p>
<p>Next, I edited the <code>vmware-authd</code> file in <code>/etc/pam.d</code>, which connects the vmware-authd daemon to the PAM modules for authentication. After the edits, the <code>/etc/pam.d/vmware-authd</code> file looked like this:</p>
<pre><code>#%PAM-1.0
auth       sufficient   /lib/security/pam_unix_auth.so shadow nullok
auth       required     /lib/security/pam_krb5.so use_first_pass
account    required     /lib/security/pam_unix_acct.so
</code></pre>
<p>Finally, still following the instructions, I created a user account on the ESX Server (using the <code>useradd</code> command there in the COS) that matched the username of an account in Active Directory. At this point, I was ready to test connectivity.</p>
<p>(Those of you that have read the other articles on Kerberos/LDAP integration of Linux into Active Directory will note that I did not create a computer object, use <code>ktpass.exe</code> to create a keytab, nor did I configure <code>ldap.conf</code> with the attribute mapping. I can&rsquo;t explain why I don&rsquo;t need a computer object or a keytab yet&mdash;rest assured I will get the bottom of that&mdash;but the LDAP pieces aren&rsquo;t necessary because we are relying on the presence of the accounts locally and only using Kerberos for authentication. This has some advantages and some disadvantages, which I&rsquo;ll discuss in more detail later.)</p>
<p>The first test (performing by trying to log into the VMware ESX Server MUI using the account created above) failed; <code>/var/log/messages</code> indicated a problem with host resolution. That problem was easily resolved with a quick edit of <code>/etc/resolv.conf</code>.</p>
<p>The next test also failed; again, <code>/var/log/messages</code> held the answer: too great of a time skew between the ESX Server and the Active Directory domain controller. The <code>date</code> command fixed that right up, and we were ready to test again.</p>
<p>The third time was the charm. Using an account that existed locally (but for which no password had been set) as well as in Active Directory, I was able to log in to the MUI using the Active Directory password. A quick test with another Active Directory account that did <em>not</em> have a matching local account failed (as expected), indicating that it was working as expected.</p>
<p>I learned a couple of useful tidbits from this experiment. First, it seems viable that organizations may wish to use Kerberos for authentication to their Linux-based hosts but <em>not</em> use LDAP for account information, instead requiring that local accounts exist on each system (like in this situation). This bears the advantage that the organization has more granular control over which specific Linux/Unix hosts may be used (i.e., no logins will succeed if a local account does not exist); that granularity does not exist if using LDAP for account information. However, the corresponding disadvantage of this approach is that local accounts must be managed on each separate host.</p>
<p>Second, I learned that a computer object (and the whole <code>ktpass.exe</code> command to generate the keytab) may not be necessary; I&rsquo;m going to go back and perform some additional testing to see if that is the case. More information will be posted here as soon as it is available.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/activedirectory">ActiveDirectory</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/esx">ESX</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/kerberos">Kerberos</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/windows">Windows</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/interoperability">Interoperability</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2006/05/01/virtualization-layers/">Virtualization Layers</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2006/05/01/permissions-in-the-esx-server-mui/">Permissions in the ESX Server MUI</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2006%2f05%2f01%2fesx-server-integration-with-active-directory%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f05%2f01%2fesx-server-integration-with-active-directory%2f&text=ESX%20Server%20Integration%20with%20Active%20Directory" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f05%2f01%2fesx-server-integration-with-active-directory%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2006/04/27/linux-ad-integration-with-windows-server-2003-r2/">Linux-AD Integration With Windows Server 2003 R2</a> <span class="post-date-list">279 May 272727</span></li><li><a href="/2006/03/30/vmware-weak-spot/">VMware Weak Spot</a> <span class="post-date-list">309 May 303030</span></li><li><a href="/2005/12/22/complete-linux-ad-authentication-details/">Complete Linux-AD Authentication Details</a> <span class="post-date-list">229 May 222222</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
