<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Erroneous Mail Relay Error with Exchange - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Erroneous Mail Relay Error with Exchange - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Erroneous Mail Relay Error with Exchange - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2006/08/24/erroneous-mail-relay-error-with-exchange/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Erroneous Mail Relay Error with Exchange</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 249 May 242424 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;513 words (estimated 3 minutes to read)</span>
  <p>You&rsquo;ve probably all run into the &ldquo;Unable to relay&rdquo; error message before. The usual fixes to this problem are pretty straightforward:</p>
<ul>
<li>
<p>Add the address space to a recipient policy in Exchange System Manager; this tell Exchange to accept the messages as inbound; or</p>
</li>
<li>
<p>Add IP addresses, subnets, or host names to the SMTP virtual server in Exchange System Manager as allowed to relay through this host;</p>
</li>
</ul>
<p>Generally speaking, either one of these two options will generally fix the problem. If the address space (say, example.com) should truly be accepted inbound, then adding it to an Exchange recipient policy will tell Exchange to accept it as inbound&mdash;thus eliminating the relay issue. Likewise, if the messages should truly be relayed to their final destination, then adding the host(s) to the list of machines allowed to relay via the Exchange SMTP virtual server will indeed do that. Pretty simple, right?</p>
<p>In this case, the e-mail address space should have been accepted inbound, so I first added the address space to an Exchange recipient policy (leaving the check box to apply that address space to recipients <em>unchecked</em>, since I didn&rsquo;t really want addresses from this domain applied to users). That didn&rsquo;t work. OK, maybe the check box to apply this domain needs to be checked, so I add it to a recipient policy that has no filter criteria (and therefore won&rsquo;t be applied to any users). It still doesn&rsquo;t work.</p>
<p>Next, I add the appropriate servers to the list of hosts allowed to relay (by modifying the properties of the Exchange SMTP virtual server), restart the SMTP service, and try again. It <em>still</em> doesn&rsquo;t work, reporting a &ldquo;5.7.1 Unable to relay for &lt;username&gt;&rdquo; message.</p>
<p>My colleague searched the Microsoft Knowledge Base and turns up <a href="http://support.microsoft.com/?id=323669">KB article 323669</a>, titled &ldquo;XFOR: 550 5.7.1 Unable to relay Error Message When E-Mail is Sent to Local Exchange Recipient&rdquo;. In the article, it mentions using <a href="http://support.microsoft.com/default.aspx?scid=KB;en-us;q232068">MetaEdit</a> to edit the IIS metabase and delete the LM/DS2MB key.</p>
<p>Good idea, but MetaEdit doesn&rsquo;t support IIS 6.0, and this problem is occurring on <a href="http://www.microsoft.com/windowsserver2003/default.mspx">Windows Server 2003</a> with <a href="http://www.microsoft.com/exchange/default.mspx">Exchange Server 2003</a>. Fortunately, the <a href="http://www.microsoft.com/downloads/info.aspx?na=22&amp;p=2&amp;SrcDisplayLang=en&amp;SrcCategoryId=&amp;SrcFamilyId=&amp;u=%2fdownloads%2fdetails.aspx%3fFamilyID%3d80a1b6e6-829e-49b7-8c02-333d9c148e69%26DisplayLang%3den">IIS 6.0 Resource Kit</a> comes with the Metabase Explorer, which allows me to delete the key as per the KB article and restart the services. After restarting the services, the problem is fixed! (Kudos go to Chauncey, who found both the article and the Metabase Explorer.)</p>
<p>Apparently, the DS2MB portion is involved in one-way replication of configuration data from Active Directory (the directory service, hence the &ldquo;DS&rdquo; in the name) to the metabase. If the metabase (or even just the DS2MB portion of the metabase) gets damaged, then changes made in Exchange System Manager&mdash;which are written to Active Directory via the configuration domain controller&mdash;will never get synchronized to the IIS metabase. Since the IIS metabase controls the SMTP service, then SMTP will continue to deny what it believes to be unallowed requests to relay. Removing the DS2MB key and restarting the services rebuilds that portion of the metabase from scratch, thus pulling in the correct configuration from Active Directory and fixing the problem.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/activedirectory">ActiveDirectory</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/exchange">Exchange</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/microsoft">Microsoft</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2006/08/21/native-kerberos-authentication-with-ssh/">Native Kerberos Authentication with SSH</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2006/08/28/another-round-with-iscsi-and-esx-server-3/">Another Round with iSCSI and ESX Server 3</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2006%2f08%2f24%2ferroneous-mail-relay-error-with-exchange%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f08%2f24%2ferroneous-mail-relay-error-with-exchange%2f&text=Erroneous%20Mail%20Relay%20Error%20with%20Exchange" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f08%2f24%2ferroneous-mail-relay-error-with-exchange%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2006/06/13/mass-creating-exchange-mailboxes/">Mass-Creating Exchange Mailboxes</a> <span class="post-date-list">139 May 131313</span></li><li><a href="/2005/09/26/error-id-c10308a2-is-put-to-rest/">Error ID c10308a2 is Put to Rest</a> <span class="post-date-list">269 May 262626</span></li><li><a href="/2005/09/22/have-you-seen-error-id-c10308a2/">Have You Seen Error ID c10308a2?</a> <span class="post-date-list">229 May 222222</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
