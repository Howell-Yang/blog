<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>A Couple Handy AD Manipulation Tricks - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="A Couple Handy AD Manipulation Tricks - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="A Couple Handy AD Manipulation Tricks - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2006/09/14/a-couple-handy-ad-manipulation-tricks/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">A Couple Handy AD Manipulation Tricks</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 149 May 141414 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;701 words (estimated 4 minutes to read)</span>
  <p>First, a couple of disclaimers: if you are an old hand with regexes (regular expressions), you won&rsquo;t find anything terribly groundbreaking here. Conversely, if you are a complete newbie to regexes, some of the examples I provide may leave you confused. (I am neither a veteran nor a newbie&hellip;instead I&rsquo;m somewhere in between.)</p>
<p>Where shall we start? Let&rsquo;s say that you needed to add a prefix to all the names of the security groups in your Active Directory domain. Of course, you <em>could</em> do this by hand, but let&rsquo;s explore something a bit more&hellip;automated. (Caveat: If you only have 20 groups in your domain, the setup work for this process may be more involved than just changing the name manually.)</p>
<p>First, export the list of groups out of Active Directory using a tool such as AdFind:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>adfind -b ou=Groups,dc=example,dc=net -s subtree  
</span></span><span style="display:flex;"><span>-f &#34;(objectCategory=Group)&#34; displayName –csv &gt; grp-list-1.csv
</span></span></code></pre></div><p>This produces a list of groups in the Groups OU at the root of the domain example.net in CSV format, listing the full DN and the group&rsquo;s display name. It will look a little something like this:</p>
<pre><code>&quot;CN=Dallas Users,DC=example,DC=net&quot;,&quot;Dallas Users&quot;  
&quot;CN=Sacramento Users,DC=example,DC=net&quot;,&quot;Sacramento Users&quot;  
&quot;CN=Lexington Users,DC=example,DC=net&quot;,&quot;Lexington Users&quot;
</code></pre>
<p>Apply this regex to the file (using your regex-capable text editing tool of choice; I used a Win32 port of <code>sed</code>):</p>
<pre><code>s/(\&quot;,\&quot;)/\1SG-/g
</code></pre>
<p>The command line, if you were to use <code>sed</code>, would look something like:</p>
<pre><code>sed -r -e s/(\&quot;,\&quot;)/\1SG-/g input-file.csv &gt; output-file.csv`
</code></pre>
<p>After this command (which would run <em>very</em> fast, even for listings of thousands of groups), the file would look like this:</p>
<pre><code>&quot;CN=Dallas Users,DC=example,DC=net&quot;,&quot;SG-Dallas Users&quot;  
&quot;CN=Sacramento Users,DC=example,DC=net&quot;,&quot;SG-Sacramento Users&quot;  
&quot;CN=Lexington Users,DC=example,DC=net&quot;,&quot;SG-Lexington Users&quot;
</code></pre>
<p>Now, all your groups have an &ldquo;SG-&rdquo; prefix (for <strong>S</strong>ecurity <strong>G</strong>roup, of course).</p>
<p>You could then take the output file and convert it from CSV to LDIF for importing back into Active Directory, as I described <a href="/2006/06/20/mass-changes-in-active-directory/">in this posting</a>. After a couple of steps with Log Parser and LDIFDE, you could have all your security groups updated in just minutes. Handy, don&rsquo;t you think?</p>
<p>sed (or <strong>s</strong>tream <strong>ed</strong>itor) is a Unix application that is exceedingly efficient at making changes to text files. When combined with a regex (regular expression), this gives us a tremendous amount of flexibility and power to quickly make large numbers of changes.</p>
<p>OK, let&rsquo;s run with another example. What if your organization decides its going to split into two different companies, sharing the same infrastructure, and you are charged with the task of stamping every user account with a suffix that denotes the company for which that user works. After separating the users into separate OUs (which would be useful for separate Group Policy object application anyway), export the user list using AdFind:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>adfind -b ou=NewCompanyB,dc=example,dc=net -s subtree  
</span></span><span style="display:flex;"><span>-f &#34;(&amp;(objectCategory=User)(objectClass=User))&#34; name displayName  
</span></span><span style="display:flex;"><span>–csv &gt; usr-compb-list-1.csv
</span></span></code></pre></div><p>This will create a more complex listing that includes full DN, name, and display name attributes of the users in that OU. With this file, use <code>sed</code> to transform it automagically:</p>
<pre><code>sed -r -e s/(,DC=net\&quot;,\&quot;)(.*)(\&quot;,\&quot;)(.*)(\&quot;)($)/\1\2 [New 
Org]\3\4 [New Org]\5\6/g usr-compb-list-1.csv &gt; output-file.csv
</code></pre>
<p>You may find it easier to put the regex in a file (say, called <code>fixnames.sed</code> or similar) and use this command instead:</p>
<pre><code>sed -r -f fixnames.sed usr-compb-list-1.csv &gt; output-file.csv
</code></pre>
<p>When this command is complete, your <code>output-file.csv</code> would look something like this:</p>
<pre><code>&quot;CN=Smith\, John,OU=NewCompanyB,DC=example,DC=net&quot;,  
&quot;Smith, John [New Org]&quot;,&quot;Smith, John [New Org]&quot;  
&quot;CN=Public\, Joan,OU=NewCompanyB,DC=example,DC=net&quot;,  
&quot;Public, Joan [New Org]&quot;,&quot;Public, Joan [New Org]&quot;
</code></pre>
<p>(Each entry would all be on a single line; they&rsquo;ve been wrapped here for readability.)</p>
<p>You could then use a variety of methods to get these changes back into Active Directory. If you wanted to modify only the display name (of course, you&rsquo;d need to adjust the commands above accordingly) you could use <code>for /f</code> with <code>dsmod user</code> and pipe the correct information to the command to modify the users; that technique is described <a href="/2006/07/06/mass-renaming-computers/">here</a> and <a href="/2006/06/30/bulk-adding-entries-in-dns/">here</a>. Or, you could just use Log Parser again to convert from CSV to LDIF using a template file and then import back in with LDIFDE. The real trick here is again the use of <code>sed</code> and regexes to quickly and efficiently make bulk changes to a text file, and that&rsquo;s something that is uniquely Unix-like. Nevertheless, it holds great value in other areas and on other platforms as well.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/activedirectory">ActiveDirectory</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ldap">LDAP</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/microsoft">Microsoft</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/unix">UNIX</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2006/09/12/embracing-diversity/">Embracing Diversity</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2006/09/19/new-zero-day-ie-exploits/">New Zero-Day IE Exploits</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2006%2f09%2f14%2fa-couple-handy-ad-manipulation-tricks%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f09%2f14%2fa-couple-handy-ad-manipulation-tricks%2f&text=A%20Couple%20Handy%20AD%20Manipulation%20Tricks" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f09%2f14%2fa-couple-handy-ad-manipulation-tricks%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2006/07/28/active-directory-and-vas/">Active Directory and VAS</a> <span class="post-date-list">289 May 282828</span></li><li><a href="/2006/08/21/more-on-kerberos-authentication-against-active-directory/">More on Kerberos Authentication Against Active Directory</a> <span class="post-date-list">219 May 212121</span></li><li><a href="/2006/08/15/solaris-10-and-active-directory-integration/">Solaris 10 and Active Directory Integration</a> <span class="post-date-list">159 May 151515</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
