<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Details on Transparent RDP Tunneling - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Details on Transparent RDP Tunneling - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Details on Transparent RDP Tunneling - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2006/02/19/details-on-transparent-rdp-tunneling/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Details on Transparent RDP Tunneling</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 199 May 191919 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;494 words (estimated 3 minutes to read)</span>
  <p>Quite a long time ago, I posted two short articles on transparent RDP tunneling (read more <a href="/2005/06/29/transparent-rdp-tunneling/">here</a> and <a href="/2005/07/01/transparent-rdp-tunneling-part-2/">here</a>). To be honest, I had forgotten that I hadn&rsquo;t posted more complete details on how exactly I went about making it work. So, to rectify that problem, here are the full details.</p>
<p>First, some background. I have a number of customers whose servers I manage remotely via Remote Desktop. Remote Desktop (or Terminal Services, if running in Application Server mode), as you may be aware, uses Microsoft&rsquo;s RDP as the protocol. Not comfortable using RDP across the Internet, I always encrypted RDP using SSL (typically via <a href="http://stunnel.mirt.net/index.html">Stunnel</a>), but this proved unwieldy as the number of servers increased. I needed a way that I could use any ordinary RDP client from within my office and transparently tunnel that RDP traffic inside SSL.</p>
<p>&lt;aside&gt;The reason this became unwieldy is due to the number of client-side definitions I had to create on my <a href="http://www.apple.com/macosx/">Mac OS X</a> laptop using SSL Enabler. After a while, it become difficult to remember which local port corresponded with each remote server.&lt;/aside&gt;</p>
<p>So, using <a href="http://www.openbsd.org/">OpenBSD</a> (then version 3.7, now version 3.8), I first added some additional IP addresses to the le1 interface by modifying the <code>/etc/hostname.le1</code> file like so:</p>
<pre><code>inet 192.168.100.1 255.255.0.0
alias 192.168.100.2
alias 192.168.100.3
</code></pre>
<p>Using <code>ping</code>, I verified that the new IP addresses were responding, then proceeded to configure Stunnel to accept unencrypted connections and forward them to another host as encrypted connections. The Stunnel configuration looked something like this:</p>
<pre><code>client = yes
[ms-wbt-server]
accept  = 192.168.100.2:3389
connect = 172.16.100.100:54321
</code></pre>
<p>I also had to add &ldquo;ms-wbt-server&rdquo; to the <code>/etc/services</code> file with the appropriate port numbers (3389).</p>
<p>On the other end of the tunnel, Stunnel was set up in reverse&mdash;it was configured to receive an encrypted connection on port 54321 (for example) and forward that as an unencrypted connection to the standard RDP port (3389). The Stunnel configuration looked something like this:</p>
<pre><code>CApath = c:\winnt\system32\stunnel
cert = c:\winnt\system32\stunnel\stunnel.pem
client = no
service = SSLTunnel
[ms-wbt-server-s]
accept = 54321
connect = 3389
</code></pre>
<p>Again, the &ldquo;ms-wbt-server-s&rdquo; (for &ldquo;secure&rdquo;) had to be added to to the services file (on Windows boxes typically located in <code>C:\winnt\system32\drivers\etc</code>). Then I registered Stunnel to run as a service (I believe the command-line was <code>stunnel -s &lt;config file name&gt;</code> or similar). Upon starting the service, I verified that we now had a listening port using <code>netstat -an</code>.</p>
<p>When all looked good, I configured any firewalls to pass the appropriate traffic and tested the connection. Done! I was now able to connect to one of the internal IP addresses on the OpenBSD server using a standard, unencrypted RDP connection. That connection was then encrypted in SSL and forwarded across the Internet to a waiting Stunnel instance, where it was decrypted and handed off to the RDP listener.</p>
<p>With a few modifications, this approach could easily be used to create <a href="/2005/12/13/application-specific-vpns/">application-specific VPNs</a> between multiple locations within the same organization, or between different organizations.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/bsd">BSD</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/encryption">Encryption</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/security">Security</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ssl">SSL</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/windows">Windows</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/interoperability">Interoperability</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2006/02/16/information-overload/">Information Overload</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2006/02/20/apple-virtualization-drawing-near/">Apple Virtualization Drawing Near</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2006%2f02%2f19%2fdetails-on-transparent-rdp-tunneling%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f02%2f19%2fdetails-on-transparent-rdp-tunneling%2f&text=Details%20on%20Transparent%20RDP%20Tunneling" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f02%2f19%2fdetails-on-transparent-rdp-tunneling%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2005/12/02/certificate-conversion-using-openssl/">Certificate Conversion Using OpenSSL</a> <span class="post-date-list">29 May 2022</span></li><li><a href="/2005/11/22/cisco-pix-vpn-and-active-directory-integration/">Cisco PIX VPN and Active Directory Integration</a> <span class="post-date-list">229 May 222222</span></li><li><a href="/2005/12/13/application-specific-vpns/">Application-Specific VPNs</a> <span class="post-date-list">139 May 131313</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
