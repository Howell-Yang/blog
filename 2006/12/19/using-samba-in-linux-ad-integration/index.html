<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Using Samba in Linux-AD Integration - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Using Samba in Linux-AD Integration - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Using Samba in Linux-AD Integration - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2006/12/19/using-samba-in-linux-ad-integration/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Using Samba in Linux-AD Integration</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 199 May 191919 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;598 words (estimated 3 minutes to read)</span>
  <p>Suggestions to use <a href="http://www.samba.org/">Samba</a> in Linux-AD integration scenarios appeared in the comments for the following articles:</p>
<p><a href="/2006/08/08/linux-active-directory-and-windows-server-2003-r2-revisited/">Linux, Active Directory, and Windows Server 2003 R2 Revisited</a><br>
<a href="/2006/08/10/kerberos-based-sso-with-apache/">Kerberos-Based SSO with Apache</a></p>
<p>The idea was that Samba could be used to help automate the process of creating the appropriate service principals in Active Directory. Previously, I had recommended the use of <code>ktpass.exe</code> and separate user accounts for each service principal (i.e., HOST/ or host/, HTTP/, etc.) because of the limitations of <code>ktpass.exe</code> and adding service principals in Active Directory. However, a number of readers pointed out that Samba&rsquo;s <code>net ads join</code> and <code>net ads keytab</code> commands could help automate and streamline this process.</p>
<p>Since one of my Linux servers had crashed anyway, I decided to try out the Samba toolset while integrating this new Linux server into my existing Active Directory infrastructure. Here&rsquo;s what I found and the process that I used to successfully integrate the new Linux server into AD with the Samba tools.</p>
<ol>
<li>
<p>First, the Kerberos client had to be configured properly. I&rsquo;ll refer you back to any one of the various Linux-AD integration articles I&rsquo;ve written for more information on how to setup the <code>/etc/krb5.conf</code> file. You should be able to do a successful <code>kinit username@AD.DOMAIN.NAME</code> when <code>/etc/krb5.conf</code> is configured correctly.</p>
</li>
<li>
<p>Next, Samba must be properly configured. I used the following settings in <code>/etc/samba/smb.conf</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>workgroup = &lt;NetBIOS name of AD domain&gt; 
</span></span><span style="display:flex;"><span>security = ads
</span></span><span style="display:flex;"><span>realm = &lt;DNS name of AD domain&gt;
</span></span><span style="display:flex;"><span>use kerberos keytab = true
</span></span><span style="display:flex;"><span>password server = &lt;Space-delimited list of AD DCs&gt;
</span></span></code></pre></div></li>
<li>
<p>For full Linux-AD integration, you must configure the nss_ldap client. Again, I&rsquo;ll refer you to any one of the various AD integration articles I&rsquo;ve written for more details on a suggested nss_ldap configuration. When nss_ldap is correctly configured, you should be able to do a <code>getent password &lt;username&gt;</code> and get back a list of properties (including UID, home directory, login shell, etc.) for that username.</p>
</li>
<li>
<p>Use <code>kdestroy</code> to kill any Kerberos credentials you may have established during testing, and then run <code>kinit &lt;administrative account&gt;@AD.DOMAIN.NAME</code> to get a Kerberos ticket for an administrative user in the AD domain.</p>
</li>
<li>
<p>If the DNS domain of your Linux server will be <em>different</em> than the DNS domain of the AD domain (for example, perhaps your Linux server will be web1.linux.corp.com whereas Active Directory uses ad.corp.com), then create a computer account in Active Directory. If the Linux server&rsquo;s DNS domain will be the same as the DNS domain for AD, then we can have Samba create it for us. (I ran into problems here since the Linux server does use a different DNS domain than Active Directory, and pre-creating the computer account was the only way to make it work.)</p>
</li>
<li>
<p>Run <code>net ads join</code> to join the Linux server to Active Directory. As part of this process, it will add various SPNs to the computer account in Active Directory automatically and create the appropriate entries in the local Kerberos keytab (<code>/etc/krb5.keytab</code>, by default). No more <code>ktpass.exe</code>!</p>
</li>
</ol>
<p>At this point, you can configure PAM appropriately (again, refer to one of the previous integration articles for full details on PAM configuration) and login to the Linux server with an Active Directory account.</p>
<p>I used this process to integrate a new <a href="http://www.centos.org/">CentOS</a> 4.4 server into Active Directory without any problems whatsoever. I used the Kerberos, LDAP, nsswitch.conf, and PAM configurations from <a href="/2006/08/08/linux-active-directory-and-windows-server-2003-r2-revisited/">this Linux-AD integration article</a> within the framework of the steps listed above and ran into only one problem (that was the issue with the differing DNS domains). Otherwise, it worked just fine.</p>
<p>Thanks to those readers who suggested the use of Samba!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/activedirectory">ActiveDirectory</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/centos">CentOS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/interoperability">Interoperability</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/kerberos">Kerberos</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ldap">LDAP</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/samba">Samba</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2006/12/18/changing-the-ip-address-in-solaris-10-u3/">Changing the IP Address in Solaris 10 U3</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2006/12/22/vmware-fusion-public-beta/">VMware Fusion Public Beta</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2006%2f12%2f19%2fusing-samba-in-linux-ad-integration%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f12%2f19%2fusing-samba-in-linux-ad-integration%2f&text=Using%20Samba%20in%20Linux-AD%20Integration" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f12%2f19%2fusing-samba-in-linux-ad-integration%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2006/11/21/greater-ad-integration-via-nfs-and-automounts/">Greater AD Integration via NFS and Automounts</a> <span class="post-date-list">219 May 212121</span></li><li><a href="/2006/10/23/event-logging-in-ad-integration-scenarios/">Event Logging in AD Integration Scenarios</a> <span class="post-date-list">239 May 232323</span></li><li><a href="/2006/09/08/ldap-based-access-control/">LDAP-Based Access Control</a> <span class="post-date-list">89 May 8088</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
