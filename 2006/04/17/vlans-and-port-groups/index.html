<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>VLANs and Port Groups - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="VLANs and Port Groups - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="VLANs and Port Groups - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2006/04/17/vlans-and-port-groups/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">VLANs and Port Groups</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 179 May 171717 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;632 words (estimated 3 minutes to read)</span>
  <p>One topic that I had been very interested in exploring was the idea of VLAN tagging within <a href="http://www.vmware.com/products/esx/">ESX Server</a>. ESX Server offers the ability to establish <a href="http://en.wikipedia.org/wiki/802.1Q">802.1Q</a> trunks with compatible switches so that 802.1Q tagged frames can be routed to appropriately configured &ldquo;port groups&rdquo; within ESX Server. This would allow a single physical host server to run virtual servers in multiple VLANs without requiring a separate physical connection for each VLAN.</p>
<p>The idea of having an ESX Server create an 802.1Q trunk (even using multiple physical connections for redundancy) becomes really important when you move into the larger-scale server consolidation projects. Organizations just won&rsquo;t have the switch density (or the NIC density on the ESX Server, for that matter) to have multiple physical connections to each VLAN. The ability to &ldquo;extend&rdquo; these VLANs into ESX Server&rsquo;s virtual networking capabilities is very important.</p>
<p>Today, I set out to test this interoperability. A host server running ESX Server 2.5.3 (the latest version, just released a few days ago) was connected to a Cisco Catalyst 3524XL running IOS 12.0(5). The following commands were used to configure the port to which the ESX Server was connected:</p>
<pre><code>Switch(config-if): switchport mode trunk
Switch(config-if): switchport trunk encapsulation dot1q
</code></pre>
<p>A quick review of the output from <code>sh int fa0/18 switchport</code> (where &ldquo;fa0/18&rdquo;, for example, is the interface to which the ESX Server is connected) showed that the port was indeed configured and operating as an 802.1Q trunk.</p>
<p>Next, a new VLAN (VLAN ID 10) was created on the switch. No ports were placed into this VLAN because no physical ports were required; the ports would all be coming from ESX Server across the trunk.</p>
<p>Third, port groups were configured in the MUI for ESX Server. Two port groups were configured, one to match the native VLAN on the switch (VLAN 1, typically) and one to match VLAN 10.</p>
<p>Once all of the configuration was done, testing began. Upon moving the first VM to the default port group (this was the port group created to match the native VLAN), I lost connectivity to that VM from other systems connected to other ports also in the native VLAN. Thinking that perhaps all VMs needed to configured for a port group (some VMs were still connected to virtual switches and not port groups), I added the second running VM to the default port group as well. Connectivity was established between the two VMs within the same port group, but I still had no connectivity to other systems on the same VLAN.</p>
<p>After a fair amount of troubleshooting and searching, I came across a reference on the VMware web site regarding the use of native VLANs. VMware recommends against the use of native VLANs because switches tend to strip off the 802.1Q tags for frames on the native VLAN. To make VLAN tagging in ESX Server work in this situation, the switch must be reconfigured to tag all frames, including frames in the native VLAN.</p>
<p>The command in Cisco IOS to do this is <code>vlan dot1q tag native</code>. Unfortunately, this command is not supported on the version of IOS that is running on the Catalyst 3524XL I used in the test lab, so there was no way to make VLAN tagging work when using the native VLAN. This is a key &ldquo;gotcha&rdquo;&mdash;make sure that the switches support tagging native VLAN traffic if you plan to use native VLANs with ESX Server and port groups, otherwise it isn&rsquo;t going to work.</p>
<p>As soon as I have the opportunity to upgrade the IOS image on the Catalyst 3524XL switch in the test lab, I&rsquo;ll try testing port group/VLAN interoperability again and post results here.</p>
<p><strong>UPDATE:</strong> I&rsquo;ve posted some updated information and more comprehensive configuration notes in a posting titled &ldquo;<a href="/2006/12/04/esx-server-nic-teaming-and-vlan-trunking/">ESX Server, NIC Teaming, and VLAN Trunking</a>&rdquo;.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cisco">Cisco</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/esx">ESX</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vlan">VLAN</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2006/04/17/freenas-on-esx-server/">FreeNAS on ESX Server</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2006/04/18/microsoft-virtual-server-management-tool-being-readied/">Microsoft Virtual Server Management Tool Being Readied</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2006%2f04%2f17%2fvlans-and-port-groups%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f04%2f17%2fvlans-and-port-groups%2f&text=VLANs%20and%20Port%20Groups" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f04%2f17%2fvlans-and-port-groups%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2006/04/17/freenas-on-esx-server/">FreeNAS on ESX Server</a> <span class="post-date-list">179 May 171717</span></li><li><a href="/2006/04/03/openbsd-on-esx-server/">OpenBSD on ESX Server</a> <span class="post-date-list">39 May 3033</span></li><li><a href="/2006/03/30/vmware-weak-spot/">VMware Weak Spot</a> <span class="post-date-list">309 May 303030</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
