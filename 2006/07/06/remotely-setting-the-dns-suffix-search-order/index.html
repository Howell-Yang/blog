<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Remotely Setting the DNS Suffix Search Order - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Remotely Setting the DNS Suffix Search Order - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Remotely Setting the DNS Suffix Search Order - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2006/07/06/remotely-setting-the-dns-suffix-search-order/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Remotely Setting the DNS Suffix Search Order</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 69 May 6066 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/education">Education</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;732 words (estimated 4 minutes to read)</span>
  <p>Invariably, larger organizations end up with a fragmented DNS namespace that has grown over the years due to name changes and acquisitions. As resources move between domains (DNS domains and Active Directory domains), it soon becomes necessary to have clients resolve hostnames even when the fully qualified domain name (FQDN) isn&rsquo;t provided by the user. The DNS suffix search order provides that functionality, and is very often a key part of maintaining connectivity in these separate namespaces.</p>
<p>Because the DNS suffix search order can&rsquo;t be set via DHCP (for Windows clients, at least), it has to be set some other way. <a href="http://www.microsoft.com/windowsserver2003/default.mspx">Windows Server 2003</a> adds this functionality into Group Policy, so that a GPO can enforce the DNS suffix search order that way. <a href="http://www.microsoft.com/windowsxp/default.mspx">Windows XP</a> or higher is required to support that GPO functionality on the client side.</p>
<p>If it can&rsquo;t be done via GPO, though, there aren&rsquo;t a lot of options&mdash;unless you are using Windows XP and/or Windows Server 2003 and can use WMIC (WMI Command-line). The full power of WMIC is outside the scope of this article (it&rsquo;s quite likely you&rsquo;ll see more from me about WMIC as time progresses), but we can at least look at using WMIC to set the DNS suffix search order on client systems.</p>
<p>First, let&rsquo;s look at the full command, then we&rsquo;ll break it down. Here&rsquo;s the full command:</p>
<pre><code>wmic /node:@input.txt nicconfig call SetDNSSuffixSearchOrder 
(legacydomain.com,newdomain.net,some.other.domain.org)
</code></pre>
<p>OK, so what does this command do, exactly? Here&rsquo;s the breakdown.</p>
<ul>
<li>
<p>The <code>wmic /node:</code> invokes WMIC, targeted at a remote computer. This allows us to run the command centrally, on one system, yet affect remote computers.</p>
</li>
<li>
<p>The <code>@input.txt</code> parameter tells WMIC to use the contents of the file input.txt to specify the names of the remote computers that will be configured with this command. This makes it easy for us to export a list of computer names into a text file and then plug that text file into this WMIC command.</p>
</li>
<li>
<p>The <code>nicconfig</code> is the WMIC <em>alias</em> that allows us to configure NIC properties. A full set of aliases can be viewed by typing <code>wmic /?</code>.</p>
</li>
<li>
<p>The <code>call</code> parameter is the <em>verb</em>, followed by the action being called. In this particular case, we&rsquo;re using the <code>SetDNSSuffixSearchOrder</code>; this is, in turn, followed by the list of DNS domains to be included in the DNS suffix search list.</p>
</li>
</ul>
<p>By combining WMIC with the handy <code>for /f</code> batch command, we can do even more. For example, let&rsquo;s say we wanted to use <code>dsquery.exe</code> to produce a list of all the computers in a particular OU. That&rsquo;s pretty straightforward:</p>
<pre><code>dsquery computer &quot;ou=Workstations,dc=example,dc=net&quot; -o rdn
</code></pre>
<p>The &ldquo;-o rdn&rdquo; switch is used here to output the <em>relative distinguished name (RDN)</em> instead of the full DN.</p>
<p>Embed that command into a for loop like so:</p>
<pre><code>for /f &quot;tokens=1&quot; %1 in ('dsquery computer 
&quot;ou=Workstations,dc=example,dc=net&quot; -o rdn') do 
@wmic /node:%1 nicconfig call SetDNSSuffixSearchOrder 
(example.net,subdomain.example.net,otherdomain.org)
</code></pre>
<p>And just like that, we&rsquo;ve taken the dynamic output of the <code>dsquery.exe</code> tool and plugged into WMIC to set the DNS suffix search order for all the systems in a particular OU in Active Directory.</p>
<p>As a side note, it&rsquo;s possible to use this WMIC command across domains (even without a trust relationship) by adding <code>/user:&lt;username&gt;</code> and <code>/password:&lt;password&gt;</code> switches to the WMIC command. This will allow WMIC to authenticate to the remote system as the specified user with the specified password.</p>
<p>It&rsquo;s also possible to use WMIC to set other parameters, such as DNS server search order and WINS servers. However, setting these parameters via WMIC also requires that we identify the name of the specific network interface card, and that may vary from system to system. I&rsquo;ll try to work on some examples and post those here as soon as I have them working reliably.</p>
<p><strong>UPDATE:</strong> I failed to mention another important switch for WMIC; namely, the <code>/FAILFAST:ON</code> switch. This switch causes WMIC to ping the remote node first as a connectivity test, and proceed with the operation only if the remote node is reachable. This will eliminate delays waiting for timeouts for remote systems that are shut down or otherwise unreachable.</p>
<p><strong>UPDATE 2:</strong> <code>dsquery.exe</code> has a <code>-limit</code> switch that can control how many objects will be returned by the query. That switch is not included in the command line above; be sure to add <code>-limit 0</code> or <code>-limit X</code> to either bypass the limit or limit the query to X objects, respectively.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/activedirectory">ActiveDirectory</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/microsoft">Microsoft</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/windows">Windows</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2006/07/06/mass-renaming-computers/">Mass Renaming Computers</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2006/07/07/setting-dns-and-wins-server-addresses-remotely/">Setting DNS and WINS Server Addresses Remotely</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f06%2fremotely-setting-the-dns-suffix-search-order%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f06%2fremotely-setting-the-dns-suffix-search-order%2f&text=Remotely%20Setting%20the%20DNS%20Suffix%20Search%20Order" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f06%2fremotely-setting-the-dns-suffix-search-order%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2006/07/06/mass-renaming-computers/">Mass Renaming Computers</a> <span class="post-date-list">69 May 6066</span></li><li><a href="/2006/07/03/group-policy-resources/">Group Policy Resources</a> <span class="post-date-list">39 May 3033</span></li><li><a href="/2006/06/09/extending-group-policy/">Extending Group Policy</a> <span class="post-date-list">99 May 9099</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
