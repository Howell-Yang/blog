<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Resetting DNS and WINS on DHCP Clients - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Resetting DNS and WINS on DHCP Clients - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Resetting DNS and WINS on DHCP Clients - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2006/07/14/resetting-dns-and-wins-on-dhcp-clients/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Resetting DNS and WINS on DHCP Clients</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 149 May 141414 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/education">Education</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;975 words (estimated 5 minutes to read)</span>
  <p>As you probably know, Windows-based systems can be DHCP clients (and obtain their IP address, subnet mask, and gateway from DHCP) but use hard-coded DNS servers or WINS servers. Right off the top of my head, I can&rsquo;t really think of any reasons <em>why</em> this is useful, or when it may be necessary, but the point remains that it is possible, and invariably this situation crops up during standardization or migration projects. The problem with this situation is that changes made to the DHCP server (such as handing out new DNS server or new WINS server addresses) won&rsquo;t be properly reflected on those workstations that have hard-coded values for these configuration settings.</p>
<p>So, we need to find a way to reset these DHCP clients to revert back to DHCP for these values instead of using the hard-coded entries.</p>
<p>Resetting the DNS server search order on a DHCP client to use the DNS servers passed down via DHCP is pretty easy. In this sitaution, we&rsquo;ll modify the technique described earlier to <a href="/2006/07/07/setting-dns-and-wins-server-addresses-remotely/">remotely set DNS and WINS server addresses</a>. However, instead of setting a specific DNS server, we&rsquo;ll essentially set the value to nothing:</p>
<pre><code>wmic nicconfig where (IPEnabled=TRUE and DHCPEnabled=TRUE) 
call SetDNSServerSearchOrder ()
</code></pre>
<p>As described in earlier posts, this command uses WMIC to set an empty DNS server search order for all NICs that are both IP-enabled and DHCP-enabled. As with all other WMIC examples that have been presented here, this command is remotely executable (using the <code>/node:&lt;PC name&gt;</code> switch), and it can be made to work with multiple machines using either the <code>/node:@&lt;filename&gt;</code> syntax or using <code>for /f</code> to pipe results into the <code>/node</code> switch. All of these examples have been demonstrated already, so we won&rsquo;t delve into them again here. Refer to back to any of these articles for more information:</p>
<ul>
<li>
<p><a href="/2006/07/13/remotely-enabling-remote-desktop/">Remotely Enabling Remote Desktop</a></p>
</li>
<li>
<p><a href="/2006/07/07/setting-dns-and-wins-server-addresses-remotely/">Setting DNS and WINS Server Addresses Remotely</a></p>
</li>
<li>
<p><a href="/2006/07/06/remotely-setting-the-dns-suffix-search-order/">Remotely Setting the DNS Suffix Search Order</a></p>
</li>
</ul>
<p>All of these articles discuss the use of WMIC and provide examples of how to execute the WMIC commands against multiple remote systems.</p>
<p>Resetting the WINS servers remotely, however, is a very different story. In this case, the WMIC command for setting the WINS servers won&rsquo;t allow you to specify an empty value, or any other value that does not appear to be a valid IP address. In addition, as mentioned when discussing how to remotely set the DNS and WINS server addresses, the WMIC command always wants both the primary and secondary WINS server addresses; it does not appear to be possible to set only one or the other.</p>
<p>Netsh (network shell, available in <a href="http://www.microsoft.com/windows2000/default.mspx">Windows 2000</a>, <a href="http://www.microsoft.com/windowsxp/default.mspx">Windows XP</a>, and <a href="http://www.microsoft.com/windowsserver2003/default.mspx">Windows Server 2003</a>), on the other hand, does provide a way to set both the DNS servers and the WINS servers back to DHCP-supplied via a command line, and netsh does offer a remote option (-r), as well as the ability to supply alternate credentials (via the -u and -p switches to provide username and password, respectively). It would seem like that&rsquo;s exactly the tool to use, and it is&mdash;sort of.</p>
<p>The problem with Netsh when being used remotely, however, is that it <em>won&rsquo;t allow</em> changes to DNS or WINS servers. Specifically, the command that would be used to reset WINS servers to DHCP is this one:</p>
<pre><code>netsh interface ip set wins 
name=&quot;Local Area Connection&quot; source=dhcp
</code></pre>
<p>(Be sure to type this all on a single line.) This works just fine when executed locally (tested on both Windows Server 2003 and Windows XP), but refuses to work when executed remotely using the &ldquo;-r&rdquo; switch.</p>
<p>The trick here, then, is to find a way to spawn this command on a remote system so that it is executed locally, i.e., to be able to issue a command on a central server that reaches out to a workstation and spawns this command as a local process. That&rsquo;s where WMIC comes back into the picture.</p>
<p>This WMIC command will spawn a process remotely:</p>
<pre><code>wmic /node:pc01 process call create &quot;cmd.exe&quot;
</code></pre>
<p>Using some switches for the Windows command shell (<code>cmd.exe</code>), we can build a command to launch <code>cmd.exe</code> and then issue the <code>netsh</code> command we need. This is the final result:</p>
<pre><code>wmic /node:&lt;PC name&gt; process call create 
'cmd.exe /c &quot;netsh interface ip set wins name=&quot;Local Area Connection&quot; 
source=dhcp&quot;'
</code></pre>
<p>Pay close attention to the quotes&mdash;those are single quotes around the entire command line, then double quotes around the Netsh command and the name of the network adapter. As it turns out, the default behavior of <code>cmd.exe</code> is to strip off the first double quote (in this case, the one just before <code>netsh</code>) and the last double quote (just after the <code>source=dhcp</code> parameter) and leave the remaining. The single quotes are used to bind the entire command line together, so that when it is parsed first by <code>cmd.exe</code> on the local system where the command is being typed it will work correctly. I tried several different combinations of single and double quotes and this worked; you may be able to find other combinations (if so, please let me know by posting a comment to this article).</p>
<p>By extension, of course, you could also use the same technique to reset the DNS servers:</p>
<pre><code>wmic /node:&lt;PC name&gt; process call create 
'cmd.exe /c &quot;netsh interface ip set dns name=&quot;Local Area Connection&quot; 
source=dhcp&quot;'
</code></pre>
<p>It should go without saying, but I&rsquo;ll say it anyway: we can easily modify this command to act upon multiple remote computers by using an input file or by piping command results to this command. Refer to any of the linked articles above for more information and examples.</p>
<p><strong>UPDATE:</strong> It has come to my attention that you could also use the <a href="http://www.sysinternals.com/Utilities/PsExec.html">PsExec</a> tool, from <a href="http://www.sysinternals.com/">SysInternals</a>, to replace the <code>wmic process call create</code> command. This should achieve the same effect, but I haven&rsquo;t yet had the time to check that myself and fully document the command line.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/microsoft">Microsoft</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/windows">Windows</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2006/07/13/remotely-enabling-remote-desktop/">Remotely Enabling Remote Desktop</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2006/07/15/tags-rss-and-other-site-changes/">Tags, RSS, and Other Site Changes</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f14%2fresetting-dns-and-wins-on-dhcp-clients%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f14%2fresetting-dns-and-wins-on-dhcp-clients%2f&text=Resetting%20DNS%20and%20WINS%20on%20DHCP%20Clients" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f14%2fresetting-dns-and-wins-on-dhcp-clients%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2006/07/07/setting-dns-and-wins-server-addresses-remotely/">Setting DNS and WINS Server Addresses Remotely</a> <span class="post-date-list">79 May 7077</span></li><li><a href="/2006/07/06/mass-renaming-computers/">Mass Renaming Computers</a> <span class="post-date-list">69 May 6066</span></li><li><a href="/2006/06/28/automating-static-entries-in-wins/">Automating Static Entries in WINS</a> <span class="post-date-list">289 May 282828</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
