<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Remotely Changing User Account Passwords - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Remotely Changing User Account Passwords - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Remotely Changing User Account Passwords - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2006/07/17/remotely-changing-user-account-passwords/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Remotely Changing User Account Passwords</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 179 May 171717 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/education">Education</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;533 words (estimated 3 minutes to read)</span>
  <p>Rather than using WMIC to do this (which is most likely possible), we&rsquo;ll pull in a couple of third-party freeware tools. First, we&rsquo;ll use <a href="http://www.joeware.net/win/free/tools/adfind.htm">AdFind</a>, by <a href="http://www.joeware.net/">Joe Richards</a>. We certainly could have used <code>dsquery</code> to provide the functionality we need, but this utility offers a bit more flexibility in the output options than <code>dsquery</code>. Next, we&rsquo;ll team AdFind up with <a href="http://www.sysinternals.com/Utilities/PsPasswd.html">PsPasswd</a>, part of <a href="http://www.sysinternals.com/Utilities/PsTools.html">PsTools suite</a> by Sysinternals.</p>
<p>PsPasswd is a very flexible tool, capable of working on local or remote computers, multiple remote computers with their names specified on the command line, all computers within a domain, or remote computers specified by the contents of an input file. It does not, however, support having the name of the remote computer piped into it from another command (at least, not that I could tell). That doesn&rsquo;t mean we can&rsquo;t get our input for PsPasswd from another command, though.</p>
<p>Rather than using the old <code>for /f</code> trick, instead we&rsquo;re going to redirect the output of one command into a text file, then read that text file into PsPasswd to change local user account passwords&mdash;all on a single command line. We&rsquo;ll use a pair of ampersands to instruct the second command to run only if the first command completes successfully.</p>
<p>Here&rsquo;s what the command will look like:</p>
<pre><code>adfind -b ou=Workstations,dc=example,dc=net 
-f &quot;(objectcategory=computer)&quot; dNSHostName -list &gt; 
c:\temp\pclist.txt &amp;&amp; pspasswd @c:\temp\pclist.txt 
pcsupport HsaEAA2e! &gt; c:\temp\audit.txt
</code></pre>
<p>In this example, we use AdFind to search the Workstations OU in the example.net AD domain for computers, and return each computer&rsquo;s DNS host name in simple list format. This output is placed into the file <code>c:\temp\pclist.txt</code>. <em>If this command is successful</em>, then the PsPasswd command runs, reading the contents of that file and outputting the results into <code>c:\temp\audit.txt</code> for later review and storage.</p>
<p>Of course, this could easily be placed into a batch file and called with the OU as a parameter:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>REM Accepts an Active Directory base DN as a parameter, local account as a parameter, and new password as a parameter, then changes the password on the specified account on all PCs in the specified base DN.
</span></span><span style="display:flex;"><span>REM
</span></span><span style="display:flex;"><span>@echo off
</span></span><span style="display:flex;"><span>adfind -b %1 -f &#34;(objectcategory=computer)&#34; dNSHostName -list &gt; %temp%\adfindtmp.txt &amp;&amp; pspasswd @%temp%\adfindtmp.txt %2 %3
</span></span><span style="display:flex;"><span>del %temp%\adfindtmp.txt
</span></span></code></pre></div><p>It would be a good idea to incorporate some error checking, to ensure that the right number and type of parameters were specified, but I&rsquo;ll leave that as an exercise to the readers.</p>
<p>There are a couple of problems with this approach. First, it is assumed that all the PCs returned by the AdFind query will have the account specified on the command line; there is no functionality (not in this approach, at least) to specify the name of the account for each PC. In a standardized environment this may not be a big deal. Second, there is no way to determine if a computer returned by the query is actually up and running, so the PsPasswd command will attempt to operate even against PCs that may not be running or may not be reachable. This will cause some errors and delays.</p>
<p>Even given these limitations, however, this is a very useful technique for managing local user accounts that are used for support purposes.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/activedirectory">ActiveDirectory</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/microsoft">Microsoft</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/windows">Windows</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2006/07/17/listing-services-running-as-a-user-account/">Listing Services Running as a User Account</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2006/07/19/gpmc-scripts/">GPMC Scripts</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f17%2fremotely-changing-user-account-passwords%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f17%2fremotely-changing-user-account-passwords%2f&text=Remotely%20Changing%20User%20Account%20Passwords" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f17%2fremotely-changing-user-account-passwords%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2006/07/17/listing-services-running-as-a-user-account/">Listing Services Running as a User Account</a> <span class="post-date-list">179 May 171717</span></li><li><a href="/2006/07/06/remotely-setting-the-dns-suffix-search-order/">Remotely Setting the DNS Suffix Search Order</a> <span class="post-date-list">69 May 6066</span></li><li><a href="/2006/07/06/mass-renaming-computers/">Mass Renaming Computers</a> <span class="post-date-list">69 May 6066</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
