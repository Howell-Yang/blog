<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Monitoring Event Logs with Log Parser - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Monitoring Event Logs with Log Parser - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Monitoring Event Logs with Log Parser - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2006/07/19/monitoring-event-logs-with-log-parser/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Monitoring Event Logs with Log Parser</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 199 May 191919 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/education">Education</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;778 words (estimated 4 minutes to read)</span>
  <p>If you haven&rsquo;t yet downloaded Log Parser 2.2 (the current version), you can get it from <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&amp;displaylang=en">Microsoft&rsquo;s download site</a>.</p>
<p>As I&rsquo;ve mentioned before, Log Parser is an extraordinarily versatile tool, and the functionality we&rsquo;ve seen so far only scratches the surface. In this next example of using Log Parser, we&rsquo;re going to take advantage of the fact that Log Parser possesses the ability to natively parse Windows&rsquo; event logs. That ability, combined with some SQL query syntax and command-line tricks, will give us an automated method for retrieving warning and error events from a user-defined list of servers and event logs.</p>
<p>Rather than belaboring the Log Parser syntax here, I&rsquo;ll direct you to the <a href="http://www.logparser.com/">Unofficial Log Parser support site</a>. There are numerous resources, both hosted there and linked to from there, that will help you understand the specific syntax. Instead, let&rsquo;s look at the full command and reverse engineer it to understand what&rsquo;s happening.</p>
<p>The full command looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>for /f &#34;tokens=1,2 delims=,&#34; %1 in (c:\servers.txt) do 
</span></span><span style="display:flex;"><span>@logparser -i:EVT &#34;SELECT TimeGenerated,EventID,EventType,
</span></span><span style="display:flex;"><span>EventTypeName,EventCategory,EventCategoryName,SourceName,
</span></span><span style="display:flex;"><span>Strings,ComputerName,SID,Message FROM \%1\%2 WHERE 
</span></span><span style="display:flex;"><span>TimeGenerated &gt; TO_TIMESTAMP(SUB(TO_INT(SYSTEM_TIMESTAMP()),86400)) 
</span></span><span style="display:flex;"><span>AND EventType IN (1;2) ORDER BY TimeGenerated DESC&#34; -o:CSV 
</span></span><span style="display:flex;"><span>-q:ON -stats:OFF &gt;&gt; c:\24hr-events.csv
</span></span></code></pre></div><p>Whew! That&rsquo;s a monster of a command. Let&rsquo;s break it down.</p>
<ol>
<li>
<p>First, we have the ever-useful <code>for /f</code> trick, which here is pulling two parameters from a file called <code>c:\servers.txt</code>. Obviously, the path and name of the file are irrelevant; just be sure to put the correct path and name in the command. The contents of this file should contain a list of servers and logs that will be checked by Log Parser, with a single server-event log pair on each line, separated by a comma. So, to check the System log on SERVERA, SERVERB, and SERVERC, the file would look something like this:</p>
<p>SERVERA,System<br>
SERVERB,System<br>
SERVERC,System</p>
</li>
</ol>
<p>Alternately, to review the Application log on SERVERA, the System log on SERVERB, and both Application and System on SERVERC, it would need to look like this:</p>
<pre><code>SERVERA,Application  
SERVERB,System  
SERVERC,Application  
SERVERC,System
</code></pre>
<p>Simply place all the log names from all the servers you&rsquo;d like monitored into this text file (in the appropriate format).</p>
<ol start="2">
<li>
<p>Next, we have the Log Parser command itself. This command specifies to use the Event log input format (<code>-i:EVT</code>) and uses a SQL SELECT statement to choose the specific fields from the event logs, filtering them by EventType (EventTypes 1 and 2 are Error events and Warning events) and by timestamp (only events in the preceding 24 hour period; refer to the Log Parser help file to try to decode the funky SQL math required to do that). The rows returned by the query are sorted according to time, and the output is set to CSV (<code>-o:CSV</code>).  The remaining options suppress other output (<code>-q:ON</code>) and suppress statistics (<code>-stats:OFF</code>). Note the parameter substitution for the source of the query; here is where the server name and event log name will be substituted as they are pulled from the text file specified in the <code>for /f</code> clause.</p>
</li>
<li>
<p>Finally, we redirect the output to a filename. It&rsquo;s important to use double redirection symbols here, or else the output file will contain only the results from the last server queried.</p>
</li>
</ol>
<p>To make this command really helpful, though, we need a way to get the results of the Log Parser command into your hands, instead of making you go to a server and look at a text file. This is where Blat comes in.</p>
<p><a href="http://www.blat.net/">Blat</a> is a command-line utility for sending SMTP messages. With Blat, sending the output file from the Log Parser command above becomes as simple as this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>blat - -subject &#34;Daily event log report&#34; 
</span></span><span style="display:flex;"><span>-body &#34;Here is the daily report of warning and error events 
</span></span><span style="display:flex;"><span>from the servers&#39; event logs.&#34; -to your@address -f source@address 
</span></span><span style="display:flex;"><span>-server your.mail.server -attacht c:\24hr-events.csv
</span></span></code></pre></div><p>Do you remember how to concatenate multiple commands on a single command line? Use the double ampersands! Using double ampersands, we can query the event logs <em>and</em> e-mail ourselves the results all on a single command line:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>for /f &#34;tokens=1,2 delims=,&#34; %1 in (c:\servers.txt) do 
</span></span><span style="display:flex;"><span>@logparser -i:EVT &#34;SELECT TimeGenerated,EventID,EventType,
</span></span><span style="display:flex;"><span>EventTypeName,EventCategory,EventCategoryName,SourceName,
</span></span><span style="display:flex;"><span>Strings,ComputerName,SID,Message FROM \%1\%2 WHERE 
</span></span><span style="display:flex;"><span>TimeGenerated &gt; TO_TIMESTAMP(SUB(TO_INT(SYSTEM_TIMESTAMP()),86400)) 
</span></span><span style="display:flex;"><span>AND EventType IN (1;2) ORDER BY TimeGenerated DESC&#34; -o:CSV 
</span></span><span style="display:flex;"><span>-q:ON -stats:OFF &gt;&gt; c:\24hr-events.csv &amp;&amp;
</span></span><span style="display:flex;"><span>blat - -subject &#34;Daily event log report&#34; 
</span></span><span style="display:flex;"><span>-body &#34;Here is the daily report of warning and error events 
</span></span><span style="display:flex;"><span>from the servers&#39; event logs.&#34; -to your@address -f source@address 
</span></span><span style="display:flex;"><span>-server your.mail.server -attacht c:\24hr-events.csv
</span></span></code></pre></div><p>Voila! You now have an automated command that will parse your servers&rsquo; event logs for warning and informational events, output those results into a CSV file (easily manipulated via your choice of spreadsheet program), and e-mail that CSV file to your e-mail address. Can it get any easier?</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/microsoft">Microsoft</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/windows">Windows</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2006/07/19/powerpoint-zero-day-exploit/">PowerPoint Zero-Day Exploit</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2006/07/21/listing-groups-in-active-directory/">Listing Groups in Active Directory</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f19%2fmonitoring-event-logs-with-log-parser%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f19%2fmonitoring-event-logs-with-log-parser%2f&text=Monitoring%20Event%20Logs%20with%20Log%20Parser" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f07%2f19%2fmonitoring-event-logs-with-log-parser%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2006/07/14/resetting-dns-and-wins-on-dhcp-clients/">Resetting DNS and WINS on DHCP Clients</a> <span class="post-date-list">149 May 141414</span></li><li><a href="/2006/07/07/setting-dns-and-wins-server-addresses-remotely/">Setting DNS and WINS Server Addresses Remotely</a> <span class="post-date-list">79 May 7077</span></li><li><a href="/2006/07/06/mass-renaming-computers/">Mass Renaming Computers</a> <span class="post-date-list">69 May 6066</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
