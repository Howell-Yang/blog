<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>GRE Tunnels on a Cisco Router - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="GRE Tunnels on a Cisco Router - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="GRE Tunnels on a Cisco Router - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2006/01/27/gre-tunnels-on-a-cisco-router/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">GRE Tunnels on a Cisco Router</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 279 May 272727 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;505 words (estimated 3 minutes to read)</span>
  <p>One of my projects involved the configuration of GRE (Generic Routing Encapsulation) tunnels, encrypted by IPSec, between two locations. I was having some problems getting the tunnels to work properly, but now I&rsquo;ve managed to resolve that problem, and the configuration is working well. Here&rsquo;s some additional information on the problem and how it was finally corrected.</p>
<p>This was my first project using GRE tunnels. I&rsquo;d used IPSec tunnels many times, and on many different platforms, but this time around we needed an interface that could be tracked for HSRP (Hot Standby Router Protocol) purposes, and until recently Cisco didn&rsquo;t offer IPSec tunnel interfaces. (I just came across some documentation last night that indicated very recent releases of IOS offer this functionality.) So, the idea was to use GRE tunnels, track the GRE tunnels using HSRP for failover with another router, and encrypt the traffic using IPSec in transport mode.</p>
<p>The GRE tunnel configuration (scrubbed for sensitive data) looked something like this originally:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>interface Tunnel0
</span></span><span style="display:flex;"><span>description GRE tunnel to other location
</span></span><span style="display:flex;"><span>ip address 192.168.254.1 255.255.255.252
</span></span><span style="display:flex;"><span>tunnel source FastEthernet0/0
</span></span><span style="display:flex;"><span>tunnel destination 172.31.254.1
</span></span><span style="display:flex;"><span>crypto map tunnel-ipsec-map
</span></span></code></pre></div><p>Of course, there was an appropriately configured interface at the other end of the tunnel as well. The tunnels came up, and appeared to work just fine, until we added the <code>keepalive</code> statement. (The <code>keepalive</code> statement is required for the tunnel to report an actual up/down status, necessary for HSRP interface tracking.) Then they went down and stayed down.</p>
<p>A <code>debug tunnel</code> statement showed that the keepalives were being sent, but none were being received. Thinking perhaps the IPSec configuration was incorrect, I removed the <code>crypto map</code> statement from the tunnel interface. It still didn&rsquo;t work.</p>
<p>After reviewing the configuration again, I began to suspect an MTU issue&mdash;the <code>show int tun0</code> output listed an MTU of 1514. I consulted with a Cisco expert (recently obtained his CCIE), and he confirmed that it was most likely an MTU issue. So I modified the configuration to look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>interface Tunnel0
</span></span><span style="display:flex;"><span>description GRE tunnel to other location
</span></span><span style="display:flex;"><span>ip address 192.168.254.1 255.255.255.252
</span></span><span style="display:flex;"><span>ip mtu 1400
</span></span><span style="display:flex;"><span>keepalive
</span></span><span style="display:flex;"><span>tunnel source FastEthernet0/0
</span></span><span style="display:flex;"><span>tunnel destination 172.31.254.1
</span></span></code></pre></div><p>At that point, the tunnel finally came up and I was able to pass traffic through the tunnel. I re-added the <code>crypto map</code> statement to enforce encryption, and the tunnels promptly went back down again.</p>
<p>Once again, debug output saved the day. The output from a <code>debug crypto</code> statement was constantly reporting &ldquo;packet too small&rdquo;. A search of the Cisco web site turned up a result (I can&rsquo;t find it now) that indicated a bug within IOS and suggested the addition of a <code>tunnel key</code> statement. So, I modified the configuration again:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>interface Tunnel0
</span></span><span style="display:flex;"><span>description GRE tunnel to other location
</span></span><span style="display:flex;"><span>ip address 192.168.254.1 255.255.255.252
</span></span><span style="display:flex;"><span>ip mtu 1400
</span></span><span style="display:flex;"><span>keepalive
</span></span><span style="display:flex;"><span>tunnel source FastEthernet0/0
</span></span><span style="display:flex;"><span>tunnel destination 172.31.254.1
</span></span><span style="display:flex;"><span>tunnel key 12345
</span></span><span style="display:flex;"><span>crypto map tunnel-ipsec-map
</span></span></code></pre></div><p>With this configuration, the IPSec/ISAKMP SAs were established and the tunnels came up, passing traffic as expected. The debug output showed no crypto errors, and keepalives were being sent and received. Success!</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cisco">Cisco</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/encryption">Encryption</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ios">IOS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vpn">VPN</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2006/01/24/gsx-upgrade-much-smoother-this-time/">GSX Upgrade Much Smoother This Time</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2006/01/30/decisions-to-be-made/">Decisions To Be Made</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2006%2f01%2f27%2fgre-tunnels-on-a-cisco-router%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f01%2f27%2fgre-tunnels-on-a-cisco-router%2f&text=GRE%20Tunnels%20on%20a%20Cisco%20Router" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2006%2f01%2f27%2fgre-tunnels-on-a-cisco-router%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2005/11/22/cisco-pix-vpn-and-active-directory-integration/">Cisco PIX VPN and Active Directory Integration</a> <span class="post-date-list">229 May 222222</span></li><li><a href="/2006/01/22/cisco-nat-issue-resolved/">Cisco NAT Issue Resolved</a> <span class="post-date-list">229 May 222222</span></li><li><a href="/2006/01/14/cisco-nat-issue/">Cisco NAT Issue</a> <span class="post-date-list">149 May 141414</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
