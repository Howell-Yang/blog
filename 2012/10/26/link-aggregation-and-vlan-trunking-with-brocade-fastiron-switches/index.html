<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Link Aggregation and VLAN Trunking with Brocade FastIron Switches - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Link Aggregation and VLAN Trunking with Brocade FastIron Switches - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Link Aggregation and VLAN Trunking with Brocade FastIron Switches - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2012/10/26/link-aggregation-and-vlan-trunking-with-brocade-fastiron-switches/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Link Aggregation and VLAN Trunking with Brocade FastIron Switches</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 269 May 262626 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;858 words (estimated 5 minutes to read)</span>
  <p>In this post, I&rsquo;ll be sharing with you information on how to do link aggregation (with LACP) and VLAN trunking on a Brocade FastIron switch with both VMware vSphere as well as Open vSwitch (OVS).</p>
<p>Throughout the majority of my career, my networking experience has been centered around Cisco&rsquo;s products. You can easily tell that from looking at the articles I&rsquo;ve published here. However, I&rsquo;ve recently had the opportunity to spend some time working with a Brocade FastIron switch (a 48-port FastIron Edge X, specifically, running software version 7.2), and I wanted to write-up what I&rsquo;ve learned about how to do link aggregation and VLAN trunking in conjunction with both VMware vSphere as well as OVS.</p>
<h2 id="configuring-link-aggregation-with-lacp">Configuring Link Aggregation with LACP</h2>
<p>When researching how to do link aggregation on a Brocade FastIron, I came across a number of different articles suggesting two different ways to configure link aggregation (ultimately I followed the information provided in <a href="http://community.brocade.com/docs/DOC-1984">this article</a> and <a href="http://community.brocade.com/docs/DOC-1993">this article</a>). I think that the difference in the configuration comes down to whether or not you want to use LACP, but I&rsquo;m not completely sure. (If you&rsquo;re a Brocade/Foundry expert, feel free to weigh in.)</p>
<p>To configure a link aggregate using LACP, use these commands:</p>
<ul>
<li>
<p>You&rsquo;ll use the <code>link-aggregate configure key &lt;unique key&gt;</code> command to identify which interfaces may participate in a given link aggregate. The key must range from 10000 to 65535, and has to be unique for each group of interfaces in a link aggregate bundle. The switch uses the key to identify which ports may be a part of a link aggregate.</p>
</li>
<li>
<p>You&rsquo;ll use the <code>link-aggregate active</code> command to indicate the use of LACP for link aggregation configuration and negotiation.</p>
</li>
</ul>
<p>For example, if you wanted to configure port 10 on a switch for link aggregation, the commands would look something like this:</p>
<pre><code>switch(config)# interface ethernet 10
switch(config-if-e1000-10)# link-aggregate configure key 10000
switch(config-if-e1000-10)# link-aggregate active
</code></pre>
<p>For each additional port that should also belong in this same link aggregate bundle, you would repeat these commands and use the same key value. As I mentioned earlier, the identical key value is what tells the switch which interfaces belong in the same bundle.</p>
<p>Configuring the virtualization host is pretty straightforward from here:</p>
<ul>
<li>
<p>If you are using vSphere, note that you&rsquo;ll need to use vSphere 5.1 and a vSphere Distributed Switch (VDS) in order to use LACP. In order to use LACP, you&rsquo;ll need to set your teaming policy to &ldquo;Route based on IP hash,&rdquo; and then you must enable LACP in the settings for the uplink group. Chris Wahl has a nice write-up <a href="http://wahlnetwork.com/2012/10/15/using-lacp-with-a-vsphere-distributed-switch-5-1/">here</a>, including a list of the caveats of using LACP with vSphere. VMware also has <a href="http://kb.vmware.com/kb/2034277">a VMware KB article</a> on the topic.</p>
</li>
<li>
<p>If you are using OVS, you can follow the instructions I provided in this post on <a href="/2012/10/19/link-aggregation-and-lacp-with-open-vswitch/">link aggregation and LACP with Open vSwitch</a>.</p>
</li>
</ul>
<h2 id="configuring-vlans">Configuring VLANs</h2>
<p>Although VLANs are (generally) interoperable between different switch vendors due to the broad adoption of the 802.1Q standard, the details of each vendor&rsquo;s implementation of VLANs is just different enough to make life difficult. In this particular case, since I learned Cisco&rsquo;s VLAN implementation first, Brocade&rsquo;s VLAN implementation on the FastIron Edge X series switches seemed rather odd. I&rsquo;m sure that had I learned Brocade&rsquo;s implementation first, then Cisco&rsquo;s version would seem odd.</p>
<p>In any case, the commands you use for VLANs are as follows:</p>
<ul>
<li>
<p>To create a VLAN, use the <code>vlan &lt;VLAN identifier&gt;</code> command.</p>
</li>
<li>
<p>To add a port to that VLAN, so that traffic across that port is tagged for the specified VLAN, use the <code>tagged ethernet &lt;interface&gt;</code> command.</p>
</li>
<li>
<p>To add a range of ports to a VLAN, use the <code>tagged ethernet &lt;start interface&gt; to &lt;end interface&gt;</code> command.</p>
</li>
<li>
<p>To allow a port to carry both untagged (native, or default VLAN) and tagged traffic, you must use the <code>dual-mode</code> command. Otherwise, a port carries only untagged <em>or</em> tagged traffic. (This was a key difference in Brocade&rsquo;s VLAN implementation that threw me off at first.)</p>
</li>
</ul>
<p>So, if you wanted to create VLAN 30, add Ethernet interface 24 to that VLAN, and configure the interface to carry both tagged and untagged traffic, the commands would look something like this:</p>
<pre><code>switch(config)# vlan 30 name server-subnet
switch(config-vlan-30)# tagged ethernet 24
switch(config-vlan-30)# interface ethernet 24
switch(config-if-e1000-24)# dual-mode
</code></pre>
<p>Once the VLANs are created and the interfaces are added to the VLANs, configuring the virtualization hosts is&mdash;once again&mdash;pretty straightforward:</p>
<ul>
<li>
<p>On vSphere, you must create a port group (or distributed port group) for each VLAN, and specify the VLAN ID in the port group configuration. Any port group without a VLAN ID specified will receive untagged traffic. I wrote an article in 2007 (it&rsquo;s a bit dated, but still applicable) about <a href="/2007/11/13/esx-server-and-the-native-vlan/">VMware port groups and the native VLAN</a>. (The native VLAN is Cisco terminology for the untagged VLAN.)</p>
</li>
<li>
<p>On OVS, you must either <a href="/2012/10/19/vlans-with-open-vswitch-fake-bridges/">create OVS fake bridges for each VLAN</a> or (when it&rsquo;s working) use libvirt integration with OVS. You can <a href="/2012/10/22/wrapping-libvirt-virtual-networks-around-open-vswitch-fake-bridges/">wrap libvirt networks around OVS fake bridges</a> as well.</p>
</li>
</ul>
<p>I hope this information is useful to someone. If anyone has any corrections or clarifications, I encourage you to add your information to the comments on this post.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/interoperability">Interoperability</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ovs">OVS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vlan">VLAN</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vsphere">vSphere</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2012/10/23/why-mess-around-with-libvirt/">Why Mess Around with libvirt?</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2012/10/29/technology-short-take-26/">Technology Short Take #26</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2012%2f10%2f26%2flink-aggregation-and-vlan-trunking-with-brocade-fastiron-switches%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2012%2f10%2f26%2flink-aggregation-and-vlan-trunking-with-brocade-fastiron-switches%2f&text=Link%20Aggregation%20and%20VLAN%20Trunking%20with%20Brocade%20FastIron%20Switches" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2012%2f10%2f26%2flink-aggregation-and-vlan-trunking-with-brocade-fastiron-switches%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2012/10/19/vlans-with-open-vswitch-fake-bridges/">VLANs with Open vSwitch Fake Bridges</a> <span class="post-date-list">199 May 191919</span></li><li><a href="/2012/05/03/technology-short-take-22/">Technology Short Take #22</a> <span class="post-date-list">39 May 3033</span></li><li><a href="/2011/11/07/technology-short-take-16/">Technology Short Take #16</a> <span class="post-date-list">79 May 7077</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
