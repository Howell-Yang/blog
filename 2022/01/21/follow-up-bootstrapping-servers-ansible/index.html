<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Follow Up: Bootstrapping Servers into Ansible - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Follow Up: Bootstrapping Servers into Ansible - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Follow Up: Bootstrapping Servers into Ansible - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2022/01/21/follow-up-bootstrapping-servers-ansible/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Follow Up: Bootstrapping Servers into Ansible</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 219 May 212121 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/information">Information</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;391 words (estimated 2 minutes to read)</span>
  <p>Seven years ago, I wrote a quick post on <a href="/2015/05/26/bootstrap-servers-ansible/">bootstrapping servers into Ansible</a>. The basic gist of the post was that you can use variables on the <a href="https://www.ansible.com/">Ansible</a> command-line to specify hosts that aren&rsquo;t part of your inventory or log in via a different user (useful if the host doesn&rsquo;t yet have a dedicated Ansible user account because you want to use Ansible to create that account). Recently, though, I encountered a situation where this approach doesn&rsquo;t work, and in this post I&rsquo;ll describe the workaround.</p>
<p>In one of the Slack communities I frequent, someone asked about using the approach described in the original blog post. However, they were having issues connecting. Specifically, this error was cropping up in the Ansible output (names have been changed to protect the innocent):</p>
<pre tabindex="0"><code>fatal: [new-server.int.domain.test]: UNREACHABLE! =&gt; {&#34;changed&#34;: false, &#34;msg&#34;: &#34;Failed to connect to the host via ssh: ansible@new-server.int.domain.test: Permission denied (publickey,password).&#34;, &#34;unreachable&#34;: true}
</code></pre><p>Now, this is odd, because the Ansible command-line being executed included the parameters I mentioned in the original blog post:</p>
<pre><code>ansible-playbook bootstrap.yml -i inventory/hosts -K --extra-vars &quot;hosts=new-server.int.domain.test user=john&quot;
</code></pre>
<p>For some reason, though, it was ignoring that parameter and attempting to connect as <code>ansible</code>. At first, I thought this was just an SSH error, but the person assured me that they were definitely able to SSH into the specified host as the specified user.</p>
<p>That was when we found the difference between this environment and the environment I&rsquo;d used: in this environment, the <code>ansible_user</code> variable was defined in the specified inventory file. I hadn&rsquo;t defined <code>ansible_user</code>. Could that be it?</p>
<p>I asked the person to try specifying <code>ansible_user</code> instead of <code>user</code> on the command line, like so:</p>
<pre><code>ansible-playbook bootstrap.yml -i inventory/hosts -K --extra-vars &quot;hosts=new-server.int.domain.test ansible_user=john&quot;
</code></pre>
<p>It worked!</p>
<p>So, the key takeaway is: if you&rsquo;re thinking of using this bootstrapping technique with your Ansible environment, be sure to specify <code>ansible_user</code> on the Ansible command-line <em>if</em> you&rsquo;ve defined <code>ansible_user</code> in your inventory. Otherwise, you should be able to just use <code>user</code>.</p>
<p>Credit for finding this issue with the approach I described in the original blog post, and for testing the workaround, goes to James Cox. Thanks James! As always, feel free to reach out to <a href="https://twitter.com/scott_lowe">me on Twitter</a>&mdash;or find me in any of the Slack communities I regularly visit&mdash;and ask questions, provide feedback, or just say hello. I&rsquo;d love to hear from you.</p>

  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ansible">Ansible</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ubuntu">Ubuntu</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2022/01/21/technology-short-take-151/">Technology Short Take 151</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2022/02/17/using-cert-manager-with-kuma-mtls/">Using cert-manager with Kuma for mTLS</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2022%2f01%2f21%2ffollow-up-bootstrapping-servers-ansible%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2022%2f01%2f21%2ffollow-up-bootstrapping-servers-ansible%2f&text=Follow%20Up%3a%20Bootstrapping%20Servers%20into%20Ansible" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2022%2f01%2f21%2ffollow-up-bootstrapping-servers-ansible%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2019/02/01/technology-short-take-110/">Technology Short Take 110</a> <span class="post-date-list">19 May 1011</span></li><li><a href="/2018/04/27/technology-short-take-98/">Technology Short Take 98</a> <span class="post-date-list">279 May 272727</span></li><li><a href="/2017/09/22/technology-short-take-87/">Technology Short Take 87</a> <span class="post-date-list">229 May 222222</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
