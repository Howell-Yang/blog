<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Using VMware ESX Virtual Switch Tagging with HP Virtual Connect - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Using VMware ESX Virtual Switch Tagging with HP Virtual Connect - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Using VMware ESX Virtual Switch Tagging with HP Virtual Connect - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2009/07/06/using-vmware-esx-virtual-switch-tagging-with-hp-virtual-connect/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Using VMware ESX Virtual Switch Tagging with HP Virtual Connect</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 69 May 6066 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;1067 words (estimated 6 minutes to read)</span>
  <p>In January 2008, SearchVMware.com published an article of mine titled <a href="http://searchvmware.techtarget.com/tip/0,289483,sid179_gci1295274,00.html">VMware ESX Server Networking with HP Virtual Connect</a>. In that article, I stated that one drawback of HP Virtual Connect was that it forced you to use External Switch Tagging (EST):</p>
<blockquote>
<p>When used in conjunction with ESX Server, shared uplink sets force the use of EST because VLAN tags are stripped away by the Virtual Connect switch. Therefore, the ESX Server can&rsquo;t use the VLAN tags, and must resort to a different vSwitch&mdash;each with one or more pNICs as uplinks&mdash;for each VLAN/associated network. This solution may be useful in some situations, but typically wouldn&rsquo;t scale well for environments with many different VLANs.</p>
</blockquote>
<p>It turns out that a firmware revision to the HP Virtual Connect software addresses this problem. As I&rsquo;ve recently had the opportunity to work with an HP Virtual Connect Flex-10 module (you can expect to see some articles on Flex-10 in the near future), I wanted to revisit the idea of using HP Virtual Connect with VMware ESX/ESXi. In this post, I&rsquo;ll describe how you go about configuring HP Virtual Connect so that you can use Virtual Switch Tagging (VST) and Shared Uplink Sets together. Each of the steps is described in one of the sections below.</p>
<h2 id="configure-vc-for-vlan-mapping">Configure VC for VLAN Mapping</h2>
<p>Before you even create the Shared Uplink Set, you must first configure the Virtual Connect module to use VLAN mapping instead of VLAN tunneling.</p>
<p>To access the option for configuring VLAN mapping, you can use the menu bar across the top of the right side of the HP Virtual Connect Manager. Simply click Configure &gt; Ethernet Settings, then click on the Advanced Settings tab. There you will see the option to either tunnel VLAN tags or map VLAN tags. Choose to map VLAN tags. Optionally, you can click the check box to force server connections to use the same VLAN mappings; this will eliminate a step later but limits the overall flexibility of the solution. It&rsquo;s up to you if you want to use this option.</p>
<h2 id="create-the-shared-uplink-set">Create the Shared Uplink Set</h2>
<p>Now you&rsquo;re ready to create the Shared Uplink Set. Using the menu bar across the top of the right side of the HP Virtual Connect Manager interface, simply choose Define &gt; Shared Uplink Set. Specify a name for the uplink set, then choose the external uplink ports. While you here, you can also go ahead and create the associated networks you&rsquo;ll need later.</p>
<h2 id="create-the-associated-networks">Create the Associated Networks</h2>
<p>Either while you&rsquo;re creating the Shared Uplink Set or after the Shared Uplink Set has been created, you can add the Associated Networks. While you are editing the Shared Uplink Set, simply click the Add Network button under the Associated Networks area and define one or more VLANs. The following parameters are available when you define an Associated Network:</p>
<ul>
<li>
<p><strong>Network Name and VLAN ID:</strong> These are pretty self-explanatory. The VLAN ID here needs to match the external VLAN ID on the rest of the network.</p>
</li>
<li>
<p><strong>Native:</strong> If this VLAN is marked as the native VLAN on the rest of your network, check this box. This network would then receive all of the untagged traffic on the uplink set.</p>
</li>
<li>
<p><strong>Smart Link:</strong> If you would like this network to be marked as down if the uplinks go down, check this box.</p>
</li>
<li>
<p><strong>Private network:</strong> With this box checked, the network will act like a private VLAN&mdash;nodes on this network cannot communicate with each other.</p>
</li>
<li>
<p><strong>Advanced:</strong> This area allows you to set a custom speed for either the preferred speed or the maximum speed.</p>
</li>
</ul>
<p>After you&rsquo;ve defined the Associated Networks, then you&rsquo;re ready to create the Server Profile&mdash;and that&rsquo;s where the real magic in making VST is found.</p>
<h2 id="assign-networks-in-the-server-profile">Assign Networks in the Server Profile</h2>
<p>Once again, you&rsquo;ll use the menu bar across the right side of the HP Virtual Connect Manager to create a Server Profile. Simply select Define &gt; Server Profile. In the Server Profile, you&rsquo;ll add a network for each NIC present in the server blade (for a blade with Flex-10 NICs and a Flex-10 module, you will have eight NICs). When prompted for what network to associate to that NIC, choose Multiple Networks. Then click the small Edit button just to the right of the Network Name drop-down to show the Server VLAN to vNet Mappings screen.</p>
<p>The fact that you selected &ldquo;Multiple Networks&rdquo; when you added the connection to the Server Profile means that Virtual Connect will pass the VLAN tags up to the blade. The fact that you configured the Virtual Connect module to use VLAN mapping now means that you can create an association between the VLAN tags that a server uses and an corresponding Associated Network.</p>
<p>If you want to keep the server&rsquo;s VLAN tags and the Associated Networks&rsquo; VLAN IDs matched up, just follow these steps:</p>
<ol>
<li>
<p>Check the box labeled Force Same VLAN Mappings As Shared Uplink Sets.</p>
</li>
<li>
<p>Choose the Shared Uplink Set from the drop-down list.</p>
</li>
<li>
<p>Place a check mark next to each Associated Network/vNet/VLAN. This tell the Virtual Connect module to include that VLAN.</p>
</li>
<li>
<p>Place a check mark under Untagged for whichever Associated Network is should be handled as the untagged (native) VLAN.</p>
</li>
</ol>
<p>If, on the other hand, you want to specify different server VLAN tags than Associated Network/vNet VLAN IDs, leave the check box for Force Same VLAN Mappings As Shared Uplink Sets <em>unchecked</em>, and specify the server VLAN ID that should be used for each Associated Network/vNet. For example, if the server was using VLAN ID 10 to refer to the Production network, but the Production network was using VLAN 1000 on the Associated Network and on the rest of the network, then choose the Associated Network that represents the Production network and specify a server VLAN ID of 10. This allows you to create a mapping between the VLAN tags the server uses and the VLAN tags the rest of the network uses.</p>
<p>After you&rsquo;ve defined the Server Profile and created the vNet mappings, attach the Server Profile to a blade running VMware ESX/ESXi and you&rsquo;re good to go! Within VMware ESX/ESXi, you would configure the vSwitches, distributed vSwitches, and port groups as you would normally.</p>
<h2 id="how-i-tested">How I Tested</h2>
<p>My testing was performed on a HP Virtual Connect Flex-10 module running firmware revision 2.10. The Flex-10 module was uplinked via a single 10Gbps connection to an HP ProCurve switch. The blades were running VMware ESX 4.0.0.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/hardware">Hardware</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/hp">HP</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vlan">VLAN</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2009/07/05/another-reason-not-to-use-pvscsi-or-vmxnet3/">Another Reason Not to Use PVSCSI or VMXNET3</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2009/07/07/altor-announces-vmsafe-integrated-altor-vf-30/">Altor Announces VMsafe-Integrated Altor VF 3.0</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2009%2f07%2f06%2fusing-vmware-esx-virtual-switch-tagging-with-hp-virtual-connect%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2009%2f07%2f06%2fusing-vmware-esx-virtual-switch-tagging-with-hp-virtual-connect%2f&text=Using%20VMware%20ESX%20Virtual%20Switch%20Tagging%20with%20HP%20Virtual%20Connect" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2009%2f07%2f06%2fusing-vmware-esx-virtual-switch-tagging-with-hp-virtual-connect%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2008/12/19/vmware-esx-networking-articles/">VMware ESX Networking Articles</a> <span class="post-date-list">199 May 191919</span></li><li><a href="/2008/09/05/vmware-esx-nic-teaming-and-vlan-trunking-with-hp-procurve/">VMware ESX, NIC Teaming, and VLAN Trunking with HP ProCurve</a> <span class="post-date-list">59 May 5055</span></li><li><a href="/2008/01/30/hp-virtualconnect-clarification/">HP VirtualConnect Clarification</a> <span class="post-date-list">309 May 303030</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
