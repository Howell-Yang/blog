<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Getting QLogic Gen2 CNAs Working with ESX 4 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Getting QLogic Gen2 CNAs Working with ESX 4 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Getting QLogic Gen2 CNAs Working with ESX 4 - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2009/08/13/getting-qlogic-gen2-cnas-working-with-esx-4/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Getting QLogic Gen2 CNAs Working with ESX 4</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 139 May 131313 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;680 words (estimated 4 minutes to read)</span>
  <p>If you&rsquo;ve been following my updates on <a href="http://twitter.com/scott_lowe">Twitter</a>, you know that I&rsquo;m in the process of installing and configuring a Nexus 5000 switch. The Nexus 5010 will provide 10Gb Ethernet and Fibre Channel over Ethernet (FCoE) to the servers and storage arrays in the lab, and I&rsquo;ll be using the equipment to help generate reference architectures and standard configurations for the <a href="http://www.eplus.com/">ePlus</a> virtualization team.</p>
<p>One of our storage partners sent over some second-generation (Gen2) Qlogic QLE8142 dual-port converged network adapters (CNAs) for me to use. These adapters joined the Emulex LP21000 CNAs that I had already procured for the lab, and I&rsquo;d use the Qlogic and Emulex CNAs to connect my HP DL385G2 servers to the Nexus 5010. I don&rsquo;t know if it&rsquo;s because these cards are cutting edge (they are pre-production/beta units, apparently), but if all Nexus and FCoE deployments are this difficult to get up and running then FCoE will have a bleak future indeed. I&rsquo;ve managed to finally get them working and recognized, but it most certainly was not as straightforward as I had anticipated.</p>
<p>Here&rsquo;s what I&rsquo;ve had to do to make them work (with thanks to Eric H for his help):</p>
<ol>
<li>
<p>I flashed the HP DL385G2 to the latest firmware available from HP. I don&rsquo;t know if this is absolutely necessary (I&rsquo;ll find out when I do the next server), but I figured it couldn&rsquo;t hurt.</p>
</li>
<li>
<p>Next I had to obtain a special beta flash image of the firmware and BIOS for the CNA and flash it to the latest version. The first time I flashed it, the CNA reported errors during the POST on the next reboot. I repeated the process and the errors went away.</p>
</li>
<li>
<p>The in-box drivers for VMware ESX 4.0.0 don&rsquo;t support the Gen2 QLogic cards, so I had to obtain beta drivers to install into VMware ESX. I first tried <code>esxupdate</code> with the bundle ZIP file, using the command <code>esxupdate update --bundle=offline-bundle.zip --nosigcheck</code>. I couldn&rsquo;t omit the <code>--nosigcheck</code> parameter because <code>esxupdate</code> then failed with error 20 (VibSigMissing). That, unfortunately, worked only for the Ethernet drivers and not the HBA drivers. To make the HBA drivers install, I had to install the RPM directly and include the <code>--force</code> parameter because ESX thought the version that was already installed was newer than the beta driver I was trying to install. I did finally get both sets of drivers installed, though.</p>
</li>
</ol>
<p>Once both sets of drivers were installed, the 10GbE NICs and the 10Gb HBAs were both recognized in vCenter Server, but the ESX console showed an error about missing signatures. You can see a <a href="/public/img/esx4-gen2cna-drivers.png">screenshot of the error here</a>.</p>
<p>I&rsquo;m quite confident that this is just because this card is an early Gen2 card, and that the strangeness I&rsquo;ve been seeing is not a reflection on QLogic or VMware. I am a bit disappointed that the CNA is not supported by ESX 4.0.0 out of the box; I guess that will probably be remedied in ESX 4.0 Update 1. (No, I don&rsquo;t have any special insider knowledge. I&rsquo;m just guessing.)</p>
<p>Even so, I wanted to share this information with the readers so they could be prepared in case they are planning an FCoE deployment. Just make sure that you are prepared to update the BIOS and firmware of your server and potentially your CNAs, and be prepared to install custom drivers. Note that I&rsquo;m going to try a fresh install of ESX 4 on this system and install the drivers during the installation process to see if that helps to correct the errors I&rsquo;ve seen thus far. I&rsquo;ll post an update to this article when I have more information.</p>
<p><strong>UPDATE:</strong> Flashing the HP DL385G2 BIOS isn&rsquo;t necessary; after posting this article, I tried the same procedure with a server using an older BIOS. The card worked fine. Also, I made a <em>major</em> mistake in the original version of this article&mdash;the cards are actually QLogic cards, not Emulex cards. The Emulex LP21000 CNAs that I have are Gen1 CNAs and, aside from a strange cabling issue I&rsquo;m chasing, appear to work just fine.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cisco">Cisco</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/fcoe">FCoE</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/hardware">Hardware</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nexus">Nexus</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vsphere">vSphere</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/storage">Storage</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2009/08/11/why-no-multi-hop-fcoe/">Why No Multi-Hop FCoE?</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2009/08/17/netapp-rcu-and-vsc/">NetApp RCU and VSC</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2009%2f08%2f13%2fgetting-qlogic-gen2-cnas-working-with-esx-4%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2009%2f08%2f13%2fgetting-qlogic-gen2-cnas-working-with-esx-4%2f&text=Getting%20QLogic%20Gen2%20CNAs%20Working%20with%20ESX%204" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2009%2f08%2f13%2fgetting-qlogic-gen2-cnas-working-with-esx-4%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2009/08/02/ucs-class-wrap-up/">UCS Class Wrap-Up</a> <span class="post-date-list">29 May 2022</span></li><li><a href="/2009/06/29/blades-wont-die-but-they-will-change/">Blades Won&#39;t Die, But They Will Change</a> <span class="post-date-list">299 May 292929</span></li><li><a href="/2009/06/05/adaptec-support-in-vsphere-revoked/">Adaptec Support in vSphere Revoked?</a> <span class="post-date-list">59 May 5055</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
