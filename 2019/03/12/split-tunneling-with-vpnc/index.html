<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Split Tunneling with vpnc - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Split Tunneling with vpnc - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Split Tunneling with vpnc - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2019/03/12/split-tunneling-with-vpnc/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Split Tunneling with vpnc</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 129 May 121212 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;620 words (estimated 3 minutes to read)</span>
  <p><code>vpnc</code> is a fairly well-known VPN connectivity package available for most Linux distributions. Although <a href="https://www.unix-ag.uni-kl.de/%7Emassar/vpnc/">the <code>vpnc</code> web site</a> describes it as a client for the Cisco VPN Concentrator, it works with a wide variety of IPSec VPN solutions. I&rsquo;m using it to connect to a Palo Alto Networks-based solution, for example. In this post, I&rsquo;d like to share how to set up split tunneling for <code>vpnc</code>.</p>
<p>Split tunneling, as explained in <a href="https://en.wikipedia.org/wiki/Split_tunneling">this Wikipedia article</a>, allows remote users to access corporate resources over the VPN while still accessing non-corporate resources directly (as opposed to having <em>all</em> traffic routed across the VPN connection). Among other things, split tunneling allows users to access things on their home LAN&mdash;like printers&mdash;while still having access to corporate resources. For users who work 100% remotely, this can make daily operations much easier.</p>
<p><code>vpnc</code> does support split tunneling, but setting it up doesn&rsquo;t seem to be very well documented. I&rsquo;m publishing this post in an effort to help spread infomation on how it can be done.</p>
<p>First, go ahead and create a configuration file for <code>vpnc</code>. For example, here&rsquo;s a fictional configuration file:</p>
<pre tabindex="0"><code>IPSec gateway vpn.company.com
IPSec ID VPNGroup
IPSec secret donttellanyone
Xauth username bobsmith
</code></pre><p>All this information, naturally, has to reflect the correct configuration for your particular VPN setup. This is all reasonably well-documented on various <code>vpnc</code> tutorials. If you stop here, you&rsquo;ll have a &ldquo;regular&rdquo; <code>vpnc</code> connection that will route all traffic across the VPN.</p>
<p>To do split tunneling, add this line at the end of your configuration file:</p>
<pre tabindex="0"><code>Script /etc/vpnc/custom-script
</code></pre><p>You can use whatever filename you want there (and put it wherever you want in the file system, although I prefer keeping it in <code>/etc/vpnc</code>). In the file you specified, add these contents:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set up split tunneling</span>
</span></span><span style="display:flex;"><span>CISCO_SPLIT_INC<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>CISCO_SPLIT_INC_0_ADDR<span style="color:#f92672">=</span>10.0.0.0
</span></span><span style="display:flex;"><span>CISCO_SPLIT_INC_0_MASK<span style="color:#f92672">=</span>255.0.0.0
</span></span><span style="display:flex;"><span>CISCO_SPLIT_INC_0_MASKLEN<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>CISCO_SPLIT_INC_0_PROTOCOL<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>CISCO_SPLIT_INC_0_SPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>CISCO_SPLIT_INC_0_DPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Call regular vpnc-script</span>
</span></span><span style="display:flex;"><span>. /etc/vpnc/vpnc-script
</span></span></code></pre></div><p>The <code>CISCO_SPLIT_INC</code> value specifies how many networks are going to be configured to route across the VPN. In this example, there is only a single network being routed across the VPN. That network is provided by the <code>CISCO_SPLIT_INC_0_ADDR</code>, <code>CISCO_SPLIT_INC_0_MASK</code>, and <code>CISCO_SPLIT_INC_0_MASKLEN</code> entries, and in this case equates to 10.0.0.0/8.</p>
<p>If you have multiple/non-contiguous networks, then specify how many networks on the <code>CISCO_SPLIT_INC</code> line, and then repeat the lines above for each network, incrementing the number for each section. For two non-contiguous networks, you&rsquo;d have a series of <code>CISCO_SPLIT_INC_0_*</code> lines (for the first network) followed by a set of <code>CISCO_SPLIT_INC_1_*</code> lines (for the second network).</p>
<p>The last line is important&mdash;this ties back to the script that comes packaged with <code>vpnc</code> to set up all the routing and such, as modified/directed by the values specified in your custom script. This allows you to customize the behavior of split tunneling on a per-connection basis.</p>
<p>Once you have your custom script in place, you can connect using <code>sudo vpnc /etc/vpnc/config.conf</code> (as normal). Once the connection is up, you can use <code>ip route list</code> to see that only the specified networks are being routed across the VPN. All other traffic still uses your local gateway.</p>
<p>Note that this solution does <em>not</em> address custom DNS resolver configurations. If you need to be able to resolve corporate hostnames <em>and</em> a DNS domain on your home LAN, additional steps are needed. I&rsquo;ll try to document those soon (once I&rsquo;ve had a chance to do some additional testing).</p>
<p><a href="https://twitter.com/scott_lowe">Find me on Twitter</a> if you have questions, comments, suggestions, or corrections. Thanks!</p>
<p><strong>Update 4 Feb 2021:</strong> For systems running <code>resolvectl</code> or the equivalent, I&rsquo;ve found that adding <code>CISCO_SPLIT_DNS=domain1.com,domain2.com,domain3.com</code> to the custom script will configure the DNS search domains for that connection, which may help address situations where you need to resolve both local hostnames on your LAN as well as corporate hostnames.</p>

  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vpn">VPN</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/networking">Networking</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ipsec">IPSec</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2019/03/01/advanced-ami-filtering-with-jmespath/">Advanced AMI Filtering with JMESPath</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2019/03/15/looking-ahead-2019-projects/">Looking Ahead: My 2019 Projects</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2019%2f03%2f12%2fsplit-tunneling-with-vpnc%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2019%2f03%2f12%2fsplit-tunneling-with-vpnc%2f&text=Split%20Tunneling%20with%20vpnc" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2019%2f03%2f12%2fsplit-tunneling-with-vpnc%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2013/08/30/thinking-out-loud-diy-network-virtualization/">Thinking Out Loud: DIY Network Virtualization?</a> <span class="post-date-list">309 May 303030</span></li><li><a href="/2018/04/27/technology-short-take-98/">Technology Short Take 98</a> <span class="post-date-list">279 May 272727</span></li><li><a href="/2017/09/22/technology-short-take-87/">Technology Short Take 87</a> <span class="post-date-list">229 May 222222</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
