<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Programmatically Creating Kubernetes Manifests - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Programmatically Creating Kubernetes Manifests - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Programmatically Creating Kubernetes Manifests - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2019/10/29/programmatically-creating-kubernetes-manifests/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Programmatically Creating Kubernetes Manifests</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 299 May 292929 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;822 words (estimated 4 minutes to read)</span>
  <p>A while ago I came across <a href="https://jkcfg.github.io/#/">a utility named <code>jk</code></a>, which purported to be able to create structured text files&mdash;in JSON, YAML, or HCL&mdash;using JavaScript (or TypeScript that has been transpiled into JavaScript). One of the use cases was creating <a href="https://kubernetes.io/">Kubernetes</a> manifests. The <a href="https://github.com/jkcfg/jk">GitHub repository for <code>jk</code></a> describes it as &ldquo;a data templating tool&rdquo;, and that&rsquo;s accurate for simple use cases. In more complex use cases, the use of a general-purpose programming language like JavaScript in <code>jk</code> reveals that the tool has the potential to be much more than just a data templating tool&mdash;if you have the JavaScript expertise to unlock that potential.</p>
<p>The basic idea behind <code>jk</code> is that you could write some relatively simple JavaScript, and <code>jk</code> will take that JavaScript and use it to create some type of structured data output. I&rsquo;ll focus on Kubernetes manifests here, but as you read keep in mind you could use this for other purposes as well. (I explore a couple other use cases at the end of this post.)</p>
<p>Here&rsquo;s a very simple example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">service</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">v1</span>.<span style="color:#a6e22e">Service</span>(<span style="color:#e6db74">&#39;appService&#39;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">namespace</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;appName&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">labels</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">app</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;appName&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">team</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;blue&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">app</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;appName&#39;</span>,
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ports</span><span style="color:#f92672">:</span> [{
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">80</span>,
</span></span><span style="display:flex;"><span>        }],
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>As you might guess, this would generate a manifest for a Kubernetes Service object. In this example, you can see why <code>jk</code> is described as a data templating tool&mdash;the user essentially has to recreate a Service object as a JavaScript object, and then <code>jk</code> just does the rendering into YAML. In my opinion, using <code>jk</code> in this way doesn&rsquo;t really offer a great deal of value. Developers familiar with JavaScript may prefer this format as opposed to YAML, and teams could leverage a test framework to test the code. In this instance, one could make a comparison to <a href="https://www.pulumi.com/">Pulumi</a>; the same thing could be accomplished using a domain-specific language, but developers may prefer and be more productive with a general purpose programming language like JavaScript.</p>
<p>Given that <code>jk</code> can product multiple artifacts from the same JavaScript code (if the code is written correctly&mdash;the example above is <em>not</em> written to support multiple outputs), a more useful way to do leverage <code>jk</code> would be to combine all (or as much as possible) of the information for an application and then generate multiple outputs. I won&rsquo;t post all the code here, but instead point you to <a href="https://github.com/jkcfg/jk/tree/master/examples/kubernetes/micro-service">the micro-service example in the <code>jk</code> repository</a> as an example of this approach. (This example is also described in <a href="https://damien.lespiau.name/posts/2019-06-12-jk-configuration-as-code/">this blog post introducing <code>jk</code></a>.)</p>
<p>The basic gist of the micro-service example from the <code>jk</code> repository is this:</p>
<ul>
<li>One JavaScript module (<code>kubernetes.js</code>) has a series of functions that generate JavaScript objects that correspond to the major Kubernetes objects (Namespace, Service, Deployment, Ingress, and ConfigMap). This module also imports a couple other JavaScript modules that create Prometheus rules and Grafana dashboards.</li>
<li>Other JavaScript modules (like <code>billing.js</code>) import the module with the function definitions and use data from a generic JavaScript object to call the functions and generate multiple YAML manifests. The generic JavaScript object contains all the information needed by all the functions, although each individual function will generally only use a subset of the information in the generic object.</li>
</ul>
<p>The end result is that a developer can combine all the information needed to deploy an application on Kubernetes in one place, and then programmatically generate the YAML manifests for the Namespace, Deployment, Service, and Ingress from that <em>one source.</em> Need to change a value? Change it in one place, re-generate the manifests, and the value will be changed in all places where it was referenced. This, in my opinion, is a far more useful example of how <code>jk</code> could be leveraged. It does require JavaScript knowledge in order to unlock this functionality, as you have to write actual JavaScript code to define functions, import modules, etc., as opposed to just creating a JavaScript object whose structure mirrors that of the desired output.</p>
<p>I could also envision use cases for <code>jk</code> involving creating both Kubernetes manifests and Terraform HCL (maybe you want to create a Route 53 entry that corresponds to an Ingress object, or maybe you need to update a CDN when creating a new Ingress object). The Quick Start in the project&rsquo;s documentation briefly discusses using <code>jk</code> to generate Terraform for the GitHub provider as well as generating JSON output, so there&rsquo;s another example of creating multiple outputs from the same code. I won&rsquo;t say the possibilities are endless, but hopefully you can see there is quite a bit of flexibility here. The tradeoff, as I mentioned earlier, is that you&rsquo;ll need JavaScript expertise in order to really leverage this flexibility.</p>
<p>Are you using <code>jk</code>? What sort of use cases can you envision for a tool that enables you to programmatically create configuration files? I&rsquo;d love to hear from you, so <a href="https://twitter.com/scott_lowe">hit me up on Twitter</a> and let me know what you think!</p>

  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/kubernetes">Kubernetes</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/javascript">JavaScript</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/typescript">TypeScript</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/cli">CLI</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/yaml">YAML</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2019/10/20/spousetivities-in-barcelona-vmworld-emea-2019/">Spousetivities in Barcelona at VMworld EMEA 2019</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2019/11/12/using-kustomize-with-cluster-api-manifests/">Using Kustomize with Cluster API Manifests</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2019%2f10%2f29%2fprogrammatically-creating-kubernetes-manifests%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2019%2f10%2f29%2fprogrammatically-creating-kubernetes-manifests%2f&text=Programmatically%20Creating%20Kubernetes%20Manifests" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2019%2f10%2f29%2fprogrammatically-creating-kubernetes-manifests%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2019/10/16/using-kustomize-with-kubeadm-configuration-files/">Using Kustomize with Kubeadm Configuration Files</a> <span class="post-date-list">169 May 161616</span></li><li><a href="/2019/09/13/an-introduction-to-kustomize/">An Introduction to Kustomize</a> <span class="post-date-list">139 May 131313</span></li><li><a href="/2019/09/26/exploring-cluster-api-v1alpha2-manifests/">Exploring Cluster API v1alpha2 Manifests</a> <span class="post-date-list">269 May 262626</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
