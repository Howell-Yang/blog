<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>VM File-Level Recovery with NetApp Snapshots - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="VM File-Level Recovery with NetApp Snapshots - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="VM File-Level Recovery with NetApp Snapshots - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2007/10/08/vm-file-level-recovery-with-netapp-snapshots/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">VM File-Level Recovery with NetApp Snapshots</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 89 May 8088 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;604 words (estimated 3 minutes to read)</span>
  <p>Last year, I wrote an article about <a href="/2006/12/30/recovering-data-inside-vms-using-netapp-snapshots/">using NetApp Snapshots and LUN clones</a> to enable the recovery on individual files within a VM. This time around, I&rsquo;d like to have a quick at that same process, but this time using NFS instead of block-level storage.</p>
<p>As I mentioned <a href="/2007/09/21/nfs-for-vmware-storage/">a couple of weeks ago</a>, NFS is getting more and more attention as a key storage enabler for Virtual Infrastructure implementations. I do still plan to conduct some tests of my own between iSCSI and NFS. (Since they are both IP-based storage protocols, I figure that makes the playing field as level as possible.) In any case, with regards to file-level recovery within VMs, NFS does possess at least one advantage.</p>
<p>Using any sort of clones (LUN clones or FlexClones) within VI3 currently requires resignaturing enabled, or else the ESX Servers don&rsquo;t even <strong>see</strong> the clones. While enabling resignaturing is not difficult (can be done via the command line or via VirtualCenter), it is not the default configuration and VMware appears not to recommend it (per the <em>SAN Configuration Guide</em>, pages 112 through 115). With NFS, it&rsquo;s only necessary to create a FlexClone and set up a new NFS mount; no other configuration is required.</p>
<p>By the same token, using NFS for file-level recovery within VMs also has one key disadvantage: LUN clones are free, whereas the use of FlexClone requires a license.</p>
<p>With these advantages and disadvantages in mind, let&rsquo;s have a look at the what the process would look like to recover files inside VMs using NFS for VM storage with NetApp Snapshots.</p>
<p>First, we&rsquo;d review the list of available Snapshots using the <code>snap list &lt;volname&gt;</code> command. For example, for a volume named &ldquo;nfs_volume1&rdquo;, the command would be <code>snap list nfs_volume1</code>. The output of that command would look something like this:</p>
<pre tabindex="0"><code>  %/used       %/total  date          name  
----------  ----------  ------------  --------  
  0% ( 0%)    0% ( 0%)  Oct 08 12:00  hourly.0  
  0% ( 0%)    0% ( 0%)  Oct 08 08:00  hourly.1  
  0% ( 0%)    0% ( 0%)  Oct 08 00:00  nightly.0  
  0% ( 0%)    0% ( 0%)  Oct 07 20:00  hourly.2  
  0% ( 0%)    0% ( 0%)  Oct 07 16:00  hourly.3  
  0% ( 0%)    0% ( 0%)  Oct 07 12:00  hourly.4  
  0% ( 0%)    0% ( 0%)  Oct 07 08:00  hourly.5  
  0% ( 0%)    0% ( 0%)  Oct 07 00:00  nightly.1`
</code></pre><p>Once we identify the Snapshot that contains the data we need to recover (based on the date/time of the Snapshot), we create a FlexClone using that Snapshot as its backing:</p>
<pre><code>vol clone create nfs_volume1_clone -s file -b nfs_volume1 nightly.0
</code></pre>
<p>This creates a FlexClone named nfs_volume1_clone based on the nightly.0 Snapshot of the volume nfs_volume1. If you immediately run the <code>exportfs</code> command, you&rsquo;ll see that the new clone is already shared via NFS, too.</p>
<p>From here, the process is pretty straightforward:</p>
<ol>
<li>
<p>Create a new NFS datastore within VirtualCenter, using the new NFS mount as the destination. This makes the data inside the FlexClone visible to the existing VMs.</p>
</li>
<li>
<p>Add one of the VMDKs on the cloned NFS datastore to an existing VM as an additional hard drive. You should be able to do this on the fly without shutting down the VM.</p>
</li>
<li>
<p>Extract the files you need and place them back where you want them.</p>
</li>
</ol>
<p>When you&rsquo;re done recovering files, the clean-up process looks like this:</p>
<ol>
<li>
<p>Remove the VMDK(s) from the VM to which it/they was/were added.</p>
</li>
<li>
<p>Remove the NFS datastore from VirtualCenter.</p>
</li>
<li>
<p>Destroy the FlexClone using the <code>vol offline</code> and <code>vol destroy</code> commands.</p>
</li>
</ol>
<p>Overall, this process is rather similar to the technique described using LUN clones, although a bit simpler because resignaturing is not required.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/esx">ESX</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/netapp">NetApp</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/nfs">NFS</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/snapshot">Snapshot</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/snapshots">Snapshots</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/storage">Storage</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2007/10/08/full-vm-recovery-with-netapp-snapshots/">Full VM Recovery with NetApp Snapshots</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2007/10/11/disabling-rdp-clipboard-redirection/">Disabling RDP Clipboard Redirection</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2007%2f10%2f08%2fvm-file-level-recovery-with-netapp-snapshots%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2007%2f10%2f08%2fvm-file-level-recovery-with-netapp-snapshots%2f&text=VM%20File-Level%20Recovery%20with%20NetApp%20Snapshots" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2007%2f10%2f08%2fvm-file-level-recovery-with-netapp-snapshots%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2006/12/30/recovering-data-inside-vms-using-netapp-snapshots/">Recovering Data Inside VMs Using NetApp Snapshots</a> <span class="post-date-list">309 May 303030</span></li><li><a href="/2007/10/08/full-vm-recovery-with-netapp-snapshots/">Full VM Recovery with NetApp Snapshots</a> <span class="post-date-list">89 May 8088</span></li><li><a href="/2007/09/13/vmworld-2007-ip-based-storage-sessions/">VMworld 2007 IP-Based Storage Sessions</a> <span class="post-date-list">139 May 131313</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
