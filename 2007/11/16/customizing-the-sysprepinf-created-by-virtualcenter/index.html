<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Customizing the Sysprep.inf Created by VirtualCenter - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="Customizing the Sysprep.inf Created by VirtualCenter - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="Customizing the Sysprep.inf Created by VirtualCenter - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2007/11/16/customizing-the-sysprepinf-created-by-virtualcenter/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">Customizing the Sysprep.inf Created by VirtualCenter</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 169 May 161616 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;487 words (estimated 3 minutes to read)</span>
  <p>The support that VMware VirtualCenter provides for using Sysprep to clone Windows virtual machines (VMs) is a key part of VMware&rsquo;s quick provisioning functionality. While VirtualCenter provides a means for creating unattended answer files (via Customization Specifications), it does not provide a way to allow users to customize the <code>Sysprep.inf</code> that is generated by VirtualCenter. Of course, that is not to say that such customization isn&rsquo;t possible, just that there isn&rsquo;t a pretty graphical interface provided for it. Fortunately, the process for customizing the <code>Sysprep.inf</code> isn&rsquo;t too terribly difficult.</p>
<p>Using information provided by <a href="http://virtrix.blogspot.com/2006/11/vmware-setting-regional-settings-for.html">this Virtrix post</a>, I managed to customize the <code>Sysprep.inf</code>. A recent Virtual Desktop Infrastructure (VDI) project on which I was working called for VMs to have small Windows pagefiles, but Sysprep kept resetting the pagefile size to the default. In this case, the default was much larger than the customer desired, so we needed a way to tell Sysprep not to resize the pagefile.</p>
<p>The first step in customize the <code>Sysprep.inf</code> is to decode the VBScript files used by VirtualCenter. <a href="http://www.virtualconspiracy.com/content/scrdec/intro">This script decoder</a> works wonderfully, producing unencoded script files that can be easily edited. Be sure to backup the original files first in the event you run into a problem! Here&rsquo;s the commands I used to decode the scripts, which are located in <code>C:\Program Files\VMware\VMware VirtualCenter 2.0\scripts</code>:</p>
<pre><code>move autoprep.wsf autoprep.wsf.backup  
move gensysprepinf.vbs gensysprepinf.vbs.backup  
scrdec18 autoprep.wsf.backup autoprep.wsf  
scrdec18 gensysprepinf.vbs.backup gensysprepinf.vbs
</code></pre>
<p>First, I moved the originals to a backup file, then used the backup file as the source for decoding to a new file with the original name.</p>
<p>Once the files are decoded, you can then edit <code>gensysprepinf.vbs</code> to add or remove entries from the <code>Sysprep.inf</code> that is generated by VirtualCenter. In Vincent&rsquo;s example, he had to modify the default regional settings; in my case, I needed to change the behavior of Sysprep with regards to the pagefile. I modified the following section:</p>
<pre><code>outStr = &quot;[Unattended]&quot; &amp; vbCrLf _  
&amp; &quot;   OemSkipEula=Yes&quot; &amp; vbCrLf _  
&amp; &quot;   InstallFilesPath=\sysprep\i386&quot; &amp; vbCrLf _  
&amp; &quot;   KeepPageFile=1&quot; &amp; vbCrLf _`
</code></pre>
<p>That last line &ldquo;KeepPageFile=1&rdquo;, was what I added to tell Sysprep to leave the existing pagefile alone. That line isn&rsquo;t perfect, though; <a href="http://support.microsoft.com/kb/813138">this Microsoft KB article</a> describes how it works. In our case, it was enough.</p>
<p>Once that&rsquo;s done, I had to edit <code>autoprep.wsf</code> to indicate that the <code>gensysprepinf.vbs</code> file is no longer encoded. I had to edit the line that referenced <code>gensysprepinf.vbs</code>:</p>
<pre><code>&lt;script language=&quot;VBScript&quot; src=&quot;gensysprepinf.vbs&quot;&gt;
</code></pre>
<p>The key change here is from &ldquo;VBScript.Encode&rdquo; to &ldquo;VBScript&rdquo; for the language parameter. This is detailed in Vincent&rsquo;s post as well. That&rsquo;s it! Of course, you could edit the scripts far more extensively, if so desired.</p>
<p>Thanks to Vincent for a great post; without his post, I wouldn&rsquo;t have known where to start. It also looks like Jase McCarty used the same technique in <a href="http://www.jasemccarty.com/blog/2006/09/vmware-extending-cloned-deployed.html">extending the VM&rsquo;s root partition</a>; although I didn&rsquo;t read his paper I would guess the same mechanisms are involved.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/microsoft">Microsoft</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vdi">VDI</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/windows">Windows</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2007/11/14/vmware-referral-program/">VMware Referral Program</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2007/11/20/quicksilver-ssh-plugin/">Quicksilver SSH Plugin</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2007%2f11%2f16%2fcustomizing-the-sysprepinf-created-by-virtualcenter%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2007%2f11%2f16%2fcustomizing-the-sysprepinf-created-by-virtualcenter%2f&text=Customizing%20the%20Sysprep.inf%20Created%20by%20VirtualCenter" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2007%2f11%2f16%2fcustomizing-the-sysprepinf-created-by-virtualcenter%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2007/10/11/disabling-rdp-clipboard-redirection/">Disabling RDP Clipboard Redirection</a> <span class="post-date-list">119 May 111111</span></li><li><a href="/2007/08/25/user-profile-management-in-vdi-deployments/">User Profile Management in VDI Deployments</a> <span class="post-date-list">259 May 252525</span></li><li><a href="/2007/10/21/when-an-os-is-not-an-os/">When an OS is not an OS</a> <span class="post-date-list">219 May 212121</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
