<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>VMware Consolidated Backup - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="VMware Consolidated Backup - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="VMware Consolidated Backup - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2007/03/05/vmware-consolidated-backup/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">VMware Consolidated Backup</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 59 May 5055 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;724 words (estimated 4 minutes to read)</span>
  <p><a href="http://www.vmware.com/products/vi/consolidated_backup.html">VMware Consolidated Backup</a> (VCB) is a new component of Virtual Infrastructure 3, and is designed to facilitate both full-VM and file-level backups of ESX-hosted virtual machines on a SAN. In its current release, it only supports Fibre Channel SANs, but support for iSCSI is supposedly coming in the next release. When used in conjunction with a third-party backup application (such as <a href="http://www.symantec.com/backupexec/index.jsp">Backup Exec</a>) and the appropriate integration software, VCB can provide the ability to backup VMs across the SAN (instead of across the network) without the need to install backup agents on every VM. The speed of backups is pretty good, too.</p>
<p>We performed a number of backups with VCB during our tests:</p>
<ul>
<li>File-level backup of Windows-based guest with the guest OS running</li>
<li>File-level backup of Windows-based guest with the VM powered off</li>
<li>Full VM backup of Windows-based guest with the guest OS running</li>
</ul>
<p>All of the preliminary VCB tests listed above were performed using <code>vcbMounter</code>, a command-line tool installed on the VCB proxy server. The command we used looked something like this (this has been line-wrapped for readability, but should be entered all on a single line):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>vcbmounter -h vcenter.example.com -u vcbservice 
</span></span><span style="display:flex;"><span>-p &lt;password&gt; -a ipaddr:10.1.1.100 -r E:\VMmount\VM1 
</span></span><span style="display:flex;"><span>-t file -m san
</span></span></code></pre></div><p>In the specific environment in which this testing was conducted, the hostname (of the VirtualCenter server, in this example) had to be changed from the default of 902, as the customer was using a non-default port number. This threw us for a minute, until we could determine exactly what port on which the server was listening.</p>
<p>This mounted the contents of this VM&rsquo;s virtual hard disks on the path <code>E:\VMmount\VM1\letters\C</code>, <code>E:\VMmount\VM1\letters\D</code>, etc. We could then, of course, manually launch a backup of the files, but instead we continued with our preliminary testing and chose to wait on the Backup Exec testing until we were comfortable with <code>vcbMounter</code>.</p>
<p>This command worked, but in order to back up the virtual machine while it was shut down, we had to change the command slightly (again, this is line-wrapped for readability):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>vcbmounter -h vcenter.example.com -u vcbservice 
</span></span><span style="display:flex;"><span>-p &lt;password&gt; -a name:VM1 -r E:\VMmount\VM1 
</span></span><span style="display:flex;"><span>-t file -m san
</span></span></code></pre></div><p>Here, the &ldquo;name:VM1&rdquo; parameter was the name of the VM that we wanted to back up <em>exactly as it appears in VirtualCenter, including case.</em> (We did try this command using the same name with in different case, but it failed.) We could also have used the BIOS UUID for the VM, which can be retrieved using this command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>vcbvmname -h vcenter.example.com -u vcbservice 
</span></span><span style="display:flex;"><span>-p &lt;password&gt; -s name:VM1
</span></span></code></pre></div><p>Again, the name has to match exactly what is listed in VirtualCenter. One of the parameters returned by this command is the BIOS UUID, which you can then use in a <code>vcbMounter</code> command like this (this would be entered on a single line, not wrapped for readability as it is here):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>vcbmounter -h vcenter.example.com -u vcbservice 
</span></span><span style="display:flex;"><span>-p &lt;password&gt; -a uuid:&lt;BIOS UUID&gt; -r E:\VMmount\VM1 
</span></span><span style="display:flex;"><span>-t file -m san
</span></span></code></pre></div><p>By using the VM name or the VM BIOS UUID, we were able to make <code>vcbMounter</code> work both when the VM was running as well as when the VM was shutdown. Using the VM&rsquo;s IP address or DNS name, on the other hand, only worked when the VM was up and running.</p>
<p>Once we felt comfortable with <code>vcbMounter</code> and <code>vcbVmName</code>, we begain testing of the Backup Exec Integration Module (BEIM), a set of freely downloadable scripts designed to provide some automation between VCB and Backup Exec. Although the syntax of Backup Exec&rsquo;s integration scripts was a bit odd (and I think the documentation was incorrect in spots), the scripts worked well. Using the supplied scripts, we were able to perform both file-level and full-VM backups of selected virtual machines without any manual intervention required (the scripts handled all the mounting/dismounting/etc.). Watch out for spaces in the VCB path or in the VM names, though; they&rsquo;ll cause the supplied scripts to fail. <a href="http://searchservervirtualization.techtarget.com/tip/0,289483,sid94_gci1233940,00.html">This article</a> offers some extensions to the Backup Exec scripts that help address some of the shortcomings, including correcting the problem with spaces in the path or the VM name.</p>
<p>While VCB does have its shortcomings, it&rsquo;s still a very useful tool to have in your backup arsenal. Between VCB full-VM and file-level backups and agent-assisted backups with an agent in the guest OS, there are plenty of ways to protect your virtualized servers.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/storage">Storage</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vcb">VCB</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/virtualization">Virtualization</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/vmware">VMware</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2007/03/05/wordpress-upgrade/">WordPress Upgrade</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2007/03/06/restoring-vcb-full-backups-with-vmware-converter/">Restoring VCB Full Backups with VMware Converter</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2007%2f03%2f05%2fvmware-consolidated-backup%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2007%2f03%2f05%2fvmware-consolidated-backup%2f&text=VMware%20Consolidated%20Backup" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2007%2f03%2f05%2fvmware-consolidated-backup%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2007/02/21/storage-time-bomb/">Storage Time Bomb?</a> <span class="post-date-list">219 May 212121</span></li><li><a href="/2006/12/30/recovering-data-inside-vms-using-netapp-snapshots/">Recovering Data Inside VMs Using NetApp Snapshots</a> <span class="post-date-list">309 May 303030</span></li><li><a href="/2006/12/15/iscsi-from-netapp-to-esx-server/">iSCSI from NetApp to ESX Server</a> <span class="post-date-list">159 May 151515</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
