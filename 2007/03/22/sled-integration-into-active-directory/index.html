<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>SLED Integration into Active Directory - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="SLED Integration into Active Directory - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="SLED Integration into Active Directory - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2007/03/22/sled-integration-into-active-directory/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">SLED Integration into Active Directory</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 229 May 222222 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/tutorial">Tutorial</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;1114 words (estimated 6 minutes to read)</span>
  <p>The information below comes from site reader Shannon VanWagner, who had the time to research this and come back with the information necessary to integrate SuSE Linux Enterprise Desktop (SLED) 10 into Active Directory (on <a href="http://www.microsoft.com/windowsserver/default.mspx">Windows Server 2003 R2</a>) using Kerberos, LDAP, and Samba. I haven&rsquo;t tested these instructions (no copy of SLED with which to test), but I imagine that they should be fine. It&rsquo;s really just the SLED-specific tweaks to the existing AD integration instructions, anyway.</p>
<h2 id="preparing-active-directory-one-time">Preparing Active Directory (One-Time)</h2>
<h3 id="enabling-editingdisplay-of-unix-attributes">Enabling Editing/Display of UNIX Attributes</h3>
<p>On your Windows Server 2003 R2 Domain Controller, enable &ldquo;Identity Management for UNIX&rdquo; via Add/Remove Programs &gt; Add Windows Components &gt; Active Directory Services &gt; Identity Management for UNIX. Note that this will require a reboot and does require Schema Admin privileges. This will add a UNIX Properties tab to each user account in AD Users and Computers that will allow you to control the user UID, primary group GID, NIS Server setting, and user shell setting (e.g. <code>/bin/bash</code>).</p>
<p>(As an aside, I&rsquo;ll refer readers back to <a href="/2006/11/28/unix-attributes-tab-and-nispropdll/">my earlier article</a> on various ways of making the &ldquo;UNIX Attributes&rdquo; tab appear.)</p>
<h3 id="create-an-ldap-bind-account">Create an LDAP Bind Account</h3>
<p>You&rsquo;ll also need to create an account in Active Directory that will be used to bind to Active Directory for LDAP queries. This account does <em>not</em> need any special privileges; in fact, making the account a member of Domain Guests and <em>not</em> a member of Domain Users is perfectly fine. This helps minimize any potential security risks as a result of this account.</p>
<h2 id="prepare-active-directory-each-user">Prepare Active Directory (Each User)</h2>
<p>Each Active Directory account that will authenticate via Linux must be configured with a UID and other UNIX attributes. This is accomplished via the new &ldquo;UNIX Attributes&rdquo; tab on the properties dialog box of a user account. (Installing the &ldquo;Server for NIS&rdquo; component enables this, as mentioned previously.) Be sure to set login shell, home directory, UID, and primary UNIX group ID.</p>
<p>After all the user accounts have been configured, then we are ready to configure the Linux server(s) for authentication against Active Directory.</p>
<h2 id="configure-the-sled-workstation">Configure the SLED Workstation</h2>
<p>On the SLED 10 client setup your config files as illustrated in the following examples. See the file comment headers for the file names and locations (replace items such as &ldquo;domain.com&rdquo; with settings specific to your environment).</p>
<p>We&rsquo;ll start first with the <code>/etc/hosts</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>127.0.0.1 localhost
</span></span><span style="display:flex;"><span>10.10.10.1 WINDOWS-DC-HOSTNAME.DOMAIN.COM WINDOWS-DC-HOSTNAME
</span></span><span style="display:flex;"><span># special IPv6 addresses
</span></span><span style="display:flex;"><span>::1 localhost ipv6-localhost ipv6-loopback
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fe00::0 ipv6-localnet
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ff00::0 ipv6-mcastprefix
</span></span><span style="display:flex;"><span>ff02::1 ipv6-allnodes
</span></span><span style="display:flex;"><span>ff02::2 ipv6-allrouters
</span></span><span style="display:flex;"><span>ff02::3 ipv6-allhosts
</span></span><span style="display:flex;"><span>127.0.0.2 client-hostname.DOMAIN.COM client-hostname
</span></span></code></pre></div><p>Next, we configure the <code>krb5.conf</code> file. In the interest of brevity, I won&rsquo;t paste it into this article; rather, just follow <a href="https://gist.github.com/scottslowe/3eb79dec00dc8e754b6c">this link</a> to view it on GitHub (and have the option to download it).</p>
<p>Once Kerberos is configured, we configure LDAP via <code>ldap.conf</code>. Again, just follow <a href="https://gist.github.com/scottslowe/29aed4672a012946f1cb">this link</a> to view the full file.</p>
<p>And then configure the Name Switch Service to use LDAP. <a href="https://gist.github.com/scottslowe/55f2ddd14214499a629c">This link</a> will show you a properly-formatted NSS configuration.</p>
<p>Almost there&mdash;next we need to make sure that time synchronization is working, since this is a prerequisite for Kerberos authentication. To make sure time synchronization is working, we&rsquo;ll configure NTP using a configuration similar to <a href="https://gist.github.com/scottslowe/1375d23864c8ad41498a">this configuration</a>.</p>
<p>At this point we have Kerberos authentication configured, LDAP configured, NSS configured to use LDAP, and time synchronization configured and running. Now we need to get Samba configured to help automate the process of integrating into Active Directory. A sample configuration such as <a href="https://gist.github.com/scottslowe/790ffff17a56e2d21189">this one</a> would get the job done.</p>
<p>SLED uses PAM (Pluggable Authentication Mechanism) to control authentication and authorization, so we next need to configure PAM to use Kerberos and LDAP, where necessary. There are a number of files that need to be configured to make this happen; <a href="https://gist.github.com/scottslowe/2f3bb6cd609cc2926178">this GitHub gist</a> shows the various files and how each would need to be configured.</p>
<p>All these files are in turn referenced by a &ldquo;master&rdquo; PAM configuration file, like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#%PAM-1.0
</span></span><span style="display:flex;"><span>###########line above is part of this file#################
</span></span><span style="display:flex;"><span>#/etc/pam.d/su config file
</span></span><span style="display:flex;"><span>###########################################################
</span></span><span style="display:flex;"><span>#auth sufficient pam_rootok.so
</span></span><span style="display:flex;"><span>auth include common-auth
</span></span><span style="display:flex;"><span>account include common-account
</span></span><span style="display:flex;"><span>password include common-password
</span></span><span style="display:flex;"><span>session include common-session
</span></span><span style="display:flex;"><span>session optional pam_xauth.so
</span></span></code></pre></div><p>Once all these configuration files are in place, we can proceed with the following steps:</p>
<ol>
<li>
<p>Run <code>getent passwd</code> (you should only see SLED 10 local users in this listing).</p>
</li>
<li>
<p>Run <code>kdestroy</code> to destroy any cached Kerberos tickets you may currently have.</p>
</li>
<li>
<p>Run <code>kinit domain-admin-user@DOMAIN.COM</code> to create a new Kerberos ticket for the machine with Domain Admin credentials; you can then run <code>klist</code> to verify the Kerberos ticket.</p>
</li>
<li>
<p>Run <code>net ads join -U domain-admin-user@DOMAIN.COM</code> to join the machine to the domain using the Kerberos ticket of the domain administrative user.</p>
</li>
<li>
<p>Restart the smb and winbind services/daemons using <code>/etc/init.d/&lt;service name&gt; stop</code> followed by <code>/etc/init.d/&lt;service name&gt; start</code>.</p>
</li>
<li>
<p>Run <code>getent passwd</code>; the output should now list domain users and their associated UIDs.  Likewise, <code>getent group</code> should output domain groups and GIDs.</p>
</li>
<li>
<p>The <code>wbinfo -u</code> and <code>wbinfo -g</code> commands should list domain users and domain groups, respectively.</p>
</li>
<li>
<p>Finally, run <code>su &lt;domain-username&gt;</code>. It should prompt you for the users password, create a home directory for that user if necessary, and then switch you to the user.</p>
</li>
</ol>
<p>We&rsquo;re not really sure if it&rsquo;s necessary, but you can add the LDAP bind account (used to bind to LDAP for queries) to the list of SMB users with the <code>smbpasswd -w</code> command. It may prove over time that this command isn&rsquo;t necessary. (Anyone want to double-check this for us?)</p>
<p>Finally, using YaST (System &gt; RunLevel Editor), enable the NTP, SMB, and Winbind daemons (I&rsquo;m fairly sure that Winbind isn&rsquo;t necessary). Also, disable the nscd daemon to avoid caching problems and unwanted interaction with Winbind.</p>
<p>At this point, if you were successful in using <code>su</code> to switch to a Windows user, you should be able to reboot the machine and login to the machine as a Windows user (be sure to use an account that has UNIX attributes assigned in Active Directory).</p>
<p>NOTE: If you happen to get yourself locked out of the system, it will be likely an <code>/etc/nsswitch.conf</code> file problem. Simply boot to the SLED 10 installation disc using the &ldquo;Recover System&rdquo; option, then issue these commands to change the <code>/etc/nsswitch.conf</code> file:</p>
<pre><code>mount -w /dev/hda1 /mnt  
vi /mnt/etc/nsswitch.conf
</code></pre>
<p>Replace &ldquo;/dev/hda1&rdquo; with the correct notation for your system partition, and when editing <code>/etc/nsswitch.conf</code> remove &ldquo;ldap&rdquo; from the passwd, group, and shadow lines; only &ldquo;files&rdquo; or &ldquo;compat&rdquo; should remain. Once that&rsquo;s done, you can now reboot and login as root so you can troubleshoot the problem.</p>
<p>Some additional resources and information:</p>
<p><a href="http://forums.suselinuxsupport.de/index.php?showtopic=53004">http://forums.suselinuxsupport.de/index.php?showtopic=53004</a></p>
<p><a href="http://forums.fedoraforum.org/archive/index.php/t-29825.html">http://forums.fedoraforum.org/archive/index.php/t-29825.html</a></p>
<p>Thanks again to Shannon VanWagner for sharing this information with me so that I could post it here. As always, feel free to post any questions, clarifications, or corrections in the comments below.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/activedirectory">ActiveDirectory</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/interoperability">Interoperability</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/kerberos">Kerberos</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/ldap">LDAP</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/linux">Linux</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/microsoft">Microsoft</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/samba">Samba</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/windows">Windows</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2007/03/18/various-vmware-links/">Various VMware Links</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2007/03/23/vdi-and-leostream-connection-broker/">VDI and Leostream Connection Broker</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2007%2f03%2f22%2fsled-integration-into-active-directory%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2007%2f03%2f22%2fsled-integration-into-active-directory%2f&text=SLED%20Integration%20into%20Active%20Directory" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2007%2f03%2f22%2fsled-integration-into-active-directory%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2007/01/15/linux-ad-integration-version-4/">Linux-AD Integration, Version 4</a> <span class="post-date-list">159 May 151515</span></li><li><a href="/2007/01/15/active-directory-integration-index/">Active Directory Integration Index</a> <span class="post-date-list">159 May 151515</span></li><li><a href="/2006/10/23/event-logging-in-ad-integration-scenarios/">Event Logging in AD Integration Scenarios</a> <span class="post-date-list">239 May 232323</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
