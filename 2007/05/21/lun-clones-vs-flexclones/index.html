<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>LUN Clones vs. FlexClones - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</title>

  
  <meta name="author" content="Howell Yang">
  <meta property="og:site_name" content="Scott&#39;s Weblog">
  
  <meta property="og:description" content="LUN Clones vs. FlexClones - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  <meta property="og:title" content="LUN Clones vs. FlexClones - Howell Yang&#39;s Weblog - 我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。">
  
  <meta property="og:type" content="article">
  <meta name="keywords" content="Cloud, Containers, Kubernetes, K8s, Docker, CNI, CRI-O, OCI, Linux, CLI, Networking, AWS, Security, DevOps">

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/font-awesome/css/font-awesome.min.css">

  
  <link rel="canonical" href="https://www.howellyang.com/2007/05/21/lun-clones-vs-flexclones/">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  </head>
<body class="theme-base-0d">
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><img src="/public/img/orbits-thumb.gif" alt="Orbits" width="128" height="128" /></p>
    <p>Original, technical content centered around cloud computing, Kubernetes, Linux, and networking</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item" href="/about/">About</a>
    <a class="sidebar-nav-item" href="/archives/">Site Archives</a>
    <a class="sidebar-nav-item" href="/categories/">Post Categories</a>
    <a class="sidebar-nav-item" href="/tags/">Content Tags</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="https://github.com/howellyang"><i class="fa fa-github fa-3x"></i></a>
      <a href="https://twitter.com/None"><i class="fa fa-twitter fa-3x"></i></a>
      <a href="https://www.linkedin.com/in/None"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="http://feeds.scottlowe.org/slowe/content/feed/"><i class="fa fa-rss fa-3x"></i></a>
    </p>
  </div>

  <div class="sidebar-item">
    <p>&copy; 2005-2022. All rights reserved.</p>
  </div>
</div>

    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Howell Yang&#39;s Weblog</a>
            <small>我是杨豪，专注于深度学习模型的训练、剪枝、量化、部署以及工程效率优化。欢迎来到我的博客。</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="post">
  <h1 class="post-title">LUN Clones vs. FlexClones</h1>
  <span class="post-date"><i class="fa fa-calendar" aria-hidden="true"></i>&#160;Published on 219 May 212121 &middot;
    <i class="fa fa-folder-open-o" aria-hidden="true"></i>&#160;Filed in <a href="/categories/explanation">Explanation</a> &middot;
    <i class="fa fa-pencil" aria-hidden="true"></i>&#160;592 words (estimated 3 minutes to read)</span>
  <p>My recent article on <a href="/2007/05/11/how-to-provision-vms-using-netapp-flexclones/">how to provision VMs using FlexClones</a> prompted a reader to ask the question, &ldquo;What about using LUN clones?&rdquo; That&rsquo;s an excellent question, and one that I myself asked when I first started using some of the advanced functionality of <a href="http://www.netapp.com/">Network Appliance</a> storage systems. I had expected that this question would come up, and so I&rsquo;d already begun preparing an article discussing LUN clones vs. FlexClones. My thanks go to Aaron for prompting the discussion!</p>
<p>LUN clones and <a href="http://www.netapp.com/products/enterprise-software/storage-system-software/provisioning-volume-management/flexclone.html">FlexClones</a> share a lot of similarities:</p>
<ul>
<li>
<p>Both LUN clones and FlexClones are built on top of the <a href="http://www.netapp.com/products/enterprise-software/storage-system-software/resiliency/snapshot.html">Snapshot</a> functionality resident within <a href="http://www.netapp.com/products/enterprise-software/storage-system-software/storage-operating-systems/ontap-7g.html">Data ONTAP</a>, the OS that runs on Network Appliance storage systems.</p>
</li>
<li>
<p>Both LUN clones and FlexClones are <em>space conservative</em>, meaning the clones only take up as much space as required to store changes from the original.</p>
</li>
<li>
<p>Both LUN clones and FlexClones can be created in seconds, and the size of the LUN (or FlexVol) does not significantly impact the time required to create the clone.</p>
</li>
</ul>
<p>The key disadvantage to using LUN clones comes as a result of an interaction between how WAFL (the file system used by Data ONTAP) handles LUNs, and how Snapshots are performed and managed.</p>
<p>From WAFL&rsquo;s perspective, a LUN is really nothing more than a single file on the file system. You can see this by browsing via CIFS or NFS to a FlexVol that contains a LUN:</p>
<pre><code>[macosx:/Volumes/vol02$] slowe% ls -la
total 25165856
drwx------   1 slowe  admin        16384 Dec 31  1969 .
drwxrwxrwt   8 root   admin          272 May 21 11:47 ..
-rwx------   1 slowe  admin  12884901888 May 21 11:48 vswex02_vmfs
</code></pre>
<p>If I were to enable the <code>.snapshot</code> (or <code>~snapshot</code>) directory, we&rsquo;d actually be able to see Snapshots of the LUN within that directory. In fact, this <a href="http://now.netapp.com/Knowledgebase/solutionarea.asp?id=kb2130">NOW (NetApp on the Web; login required) article</a> describes mounting LUN snapshots inside the <code>.snapshot</code> (or <code>~snapshot</code>) as a way of recovering files or folders inside a snapshot. This technique is also applicable to recovering VMs from a LUN snapshot.</p>
<p>&ldquo;OK,&rdquo; you may be saying, &ldquo;so LUNs are implemented and managed as files. What&rsquo;s your point?&rdquo;</p>
<p>My point is that Snapshots are handled <em>per volume</em>, and capture all the data in the active filesystem. A LUN exists as a file in the filesystem, so a Snapshot will capture that. When you create a LUN clone, you will then create another file in the active filesystem, which subsequent Snapshots will then capture. The end result is that you can end up with Snapshots that cannot be deleted because they reference a LUN clone which is, in turn, backed by another Snapshot. In these cases, you won&rsquo;t be able to delete Snapshots until you delete the LUN clone and all the Snapshots that reference that LUN clone. This <a href="http://www.oneandonemakesthree.com/?q=node/50">blog posting discusses</a> this very problem and provides a Data ONTAP command to help track down the dependencies. (I&rsquo;m also told that there is a NOW article on this problem as well, but I was unable to locate it.)</p>
<p>For short-term scenarios, LUN cloning works well and is, as some have pointed out, free (FlexClone requires a separate, paid license). For longer-term storage scenarios, however, LUN clones and the dependencies introduced by subsequent Snapshots of those LUN clones mean that FlexClones are a better solution. Since FlexClones are entire volumes stored within an aggregate, they aren&rsquo;t subject to the same problems as LUN clones (which are stored within a volume).</p>
<p>I hope this helps clear up some of the differences between using LUN clones and using FlexClones. Add your comments or questions below.</p>


  <h3>Metadata and Navigation</h3>
  <span class="post-meta">
  <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/netapp">NetApp</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/snapshots">Snapshots</a> <i class="fa fa-tag" aria-hidden="true"></i>&#160;<a href="/tags/storage">Storage</a> 

  <br />
  <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous Post: <a href="https://www.howellyang.com/2007/05/17/netapp-flexclones-with-vmware-part-2/">NetApp FlexClones with VMware, Part 2</a>
  
  <br />
   <i class="fa fa-arrow-circle-right" aria-hidden="true"></i> Next Post: <a href="https://www.howellyang.com/2007/05/23/openbsd-41-on-esx-server-301/">OpenBSD 4.1 on ESX Server 3.0.1</a>
  </span>

  <span class="post-sharing">
  <p>Be social and share this post!<br />

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.howellyang.com%2f2007%2f05%2f21%2flun-clones-vs-flexclones%2f" title="Share on Facebook"><i class="fa fa-facebook-square fa-2x"></i></a>
  <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fwww.howellyang.com%2f2007%2f05%2f21%2flun-clones-vs-flexclones%2f&text=LUN%20Clones%20vs.%20FlexClones" title="Share on Twitter"><i class="fa fa-twitter-square fa-2x"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2fwww.howellyang.com%2f2007%2f05%2f21%2flun-clones-vs-flexclones%2f" title="Share on Google Plus"><i class="fa fa-google-plus-square fa-2x"></i></a></p>
  </span>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
  <li><a href="/2006/12/30/recovering-data-inside-vms-using-netapp-snapshots/">Recovering Data Inside VMs Using NetApp Snapshots</a> <span class="post-date-list">309 May 303030</span></li><li><a href="/2007/05/17/netapp-flexclones-with-vmware-part-2/">NetApp FlexClones with VMware, Part 2</a> <span class="post-date-list">179 May 171717</span></li><li><a href="/2007/05/15/netapp-flexclones-with-vmware-part-1/">NetApp FlexClones with VMware, Part 1</a> <span class="post-date-list">159 May 151515</span></li>
  </ul>
</div>      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
